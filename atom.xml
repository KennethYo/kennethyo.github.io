<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>敲键盘的呼伦贝尔人</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.kennethyo.me/"/>
  <updated>2017-07-30T11:51:39.000Z</updated>
  <id>http://www.kennethyo.me/</id>
  
  <author>
    <name>鸿雁</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Android 的复制和粘贴功能</title>
    <link href="http://www.kennethyo.me/2017/07/30/untitled-1501415073699/"/>
    <id>http://www.kennethyo.me/2017/07/30/untitled-1501415073699/</id>
    <published>2017-07-30T11:44:33.000Z</published>
    <updated>2017-07-30T11:51:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>Android 复制和粘贴功能，需要调用系统服务<code>ClipboardManager</code>来实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ClipboardManager mClipboardManager = (ClipboardManager) getSystemService(CLIPBOARD_SERVICE);</div></pre></td></tr></table></figure></p>
<p>复制功能，首先要构造一个<code>ClipData</code>对象，并且把要复制的数据和 MIME type 赋值给<code>ClipData</code>，然后在把<code>ClipData</code>传入<code>mClipboardManager.setPrimaryClip()</code>方法，此时，我们完成了一个复制。</p>
<p>粘贴功能，调用<code>mClipboardManager.hasPrimaryClip()</code>来判断粘贴板是否有数据，然后通过<code>mClipboardManager.getPrimaryClipDescription().hasMimeType()</code>判断当前粘贴板的数据 MIME type是不是APP支持的，如果是APP支持的，获取数据<code>mClipboardManager.getPrimaryClip()</code>。</p>
<p>下面就文本，URI，Intent的复制粘贴，分别提供一个demo。</p>
<h1 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h1><p>复制：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一个参数，是描述复制的内容，也可以和内容一样。</span></div><div class="line">ClipData clipData = ClipData.newPlainText(<span class="string">"copy from demo"</span>, mEtCopy.getText());</div><div class="line">mClipboardManager.setPrimaryClip(clipData);</div></pre></td></tr></table></figure></p>
<p>粘贴：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 粘贴板有数据，并且是文本</span></div><div class="line"><span class="keyword">if</span> (mClipboardManager.hasPrimaryClip()</div><div class="line">        &amp;&amp; mClipboardManager.getPrimaryClipDescription().hasMimeType(ClipDescription.MIMETYPE_TEXT_PLAIN)) &#123;</div><div class="line">    ClipData.Item item = mClipboardManager.getPrimaryClip().getItemAt(<span class="number">0</span>);</div><div class="line">    CharSequence text = item.getText();</div><div class="line">    <span class="keyword">if</span> (text == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    mEtPaste.setText(text);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="URI-复制"><a href="#URI-复制" class="headerlink" title="URI 复制"></a>URI 复制</h1><p>复制：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Uri uri = Uri.parse(uriStr);</div><div class="line">ClipData clipData = ClipData.newUri(getContentResolver(), <span class="string">"copy from demo"</span>, uri);</div><div class="line">mClipboardManager.setPrimaryClip(clipData);</div></pre></td></tr></table></figure></p>
<p>粘贴：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (mClipboardManager.hasPrimaryClip()</div><div class="line">        &amp;&amp; mClipboardManager.getPrimaryClipDescription().hasMimeType(ClipDescription.MIMETYPE_TEXT_URILIST)) &#123;</div><div class="line">    ClipData.Item item = mClipboardManager.getPrimaryClip().getItemAt(<span class="number">0</span>);</div><div class="line">    Uri uri = item.getUri();</div><div class="line">    <span class="keyword">if</span> (uri == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    mTvScheme.setText(uri.getScheme());</div><div class="line">    mTvUri.setText(uri.toString());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="Intent-复制"><a href="#Intent-复制" class="headerlink" title="Intent 复制"></a>Intent 复制</h1><p>复制：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, TextActivity.class);</div><div class="line">ClipData clipData = ClipData.newIntent(<span class="string">"copy from demo"</span>, intent);</div><div class="line">mClipboardManager.setPrimaryClip(clipData);</div></pre></td></tr></table></figure></p>
<p>粘贴：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (mClipboardManager.hasPrimaryClip()</div><div class="line">        &amp;&amp; mClipboardManager.getPrimaryClipDescription().hasMimeType(ClipDescription.MIMETYPE_TEXT_INTENT)) &#123;</div><div class="line">    ClipData.Item item = mClipboardManager.getPrimaryClip().getItemAt(<span class="number">0</span>);</div><div class="line">    Intent intent = item.getIntent();</div><div class="line">    <span class="keyword">if</span> (intent == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    startActivity(intent);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>复制粘贴功能的API并不难理解，如果想了解更多的功能，可以看<a href="https://developer.android.google.cn/guide/topics/text/copy-paste.html" target="_blank" rel="external">官方API指南</a>。<br><a href="https://github.com/KennethYo/CopyAndPasteDemo" target="_blank" rel="external">Demo地址</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Android 复制和粘贴功能，需要调用系统服务&lt;code&gt;ClipboardManager&lt;/code&gt;来实现。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="copy" scheme="http://www.kennethyo.me/tags/copy/"/>
    
      <category term="paste" scheme="http://www.kennethyo.me/tags/paste/"/>
    
  </entry>
  
  <entry>
    <title>把编译信息放在 Launch Icon 上</title>
    <link href="http://www.kennethyo.me/2017/04/05/untitled-1491391624769/"/>
    <id>http://www.kennethyo.me/2017/04/05/untitled-1491391624769/</id>
    <published>2017-04-05T11:27:04.000Z</published>
    <updated>2017-04-05T11:28:53.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1fec0ms62mnj3053052wew.jpg" alt="enter image description here|center"><br>首先上一张效果吧！这是我们CI集成测试包后 icon。在icon上分别显示了版本号、build 时间、git id。</p>
<p>如何实现的呢？看下面。</p>
<p>首先，我们要有 <code>ghostscript</code> 和 <code>imagemagick</code> 两个环境。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install ghostscript</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install imagemagick</div></pre></td></tr></table></figure>
<p>其次，在编译 apk 之前，执行下面的 shell，就会主动替换为新icon。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env bash</div><div class="line">#引入环境变量</div><div class="line">export PATH=$PATH:/usr/local/bin</div><div class="line">#读取版本name</div><div class="line">source $WORKSPACE/gradle.properties</div><div class="line">shortVersion=$&#123;VERSION_NAME&#125;</div><div class="line">#编译时间</div><div class="line">createDate=`date +%m%d_%H:%M`</div><div class="line">#获取git id</div><div class="line">commit=`git rev-parse --short HEAD`</div><div class="line">bundleVersion=`git rev-list HEAD | wc -l | awk &apos;&#123;print $1&#125;&apos;`</div><div class="line">#获取icon路径数组</div><div class="line">resPath=&quot;$WORKSPACE/android-autoEasy/src/main/res&quot;</div><div class="line"></div><div class="line">mdpiPath=&quot;$&#123;resPath&#125;/drawable-mdpi/icon.png&quot;</div><div class="line">hdpiPath=&quot;$&#123;resPath&#125;/drawable-hdpi/icon.png&quot;</div><div class="line">xhdpiPath=&quot;$&#123;resPath&#125;/drawable-xhdpi/icon.png&quot;</div><div class="line">xxhdpiPath=&quot;$&#123;resPath&#125;/drawable-xxhdpi/icon.png&quot;</div><div class="line">iconPaths=($&#123;mdpiPath&#125; $&#123;hdpiPath&#125; $&#123;xhdpiPath&#125; $&#123;xxhdpiPath&#125;)</div><div class="line"></div><div class="line">echo</div><div class="line">echo &quot;*********************************************&quot;</div><div class="line">echo &quot;* $&#123;shortVersion&#125;_$&#123;bundleVersion&#125;_$&#123;commit&#125;&quot;</div><div class="line">echo &quot;*********************************************&quot;</div><div class="line">echo</div><div class="line">#把信息写到icon上</div><div class="line">function processIcon() &#123;</div><div class="line">    pngPath=$1</div><div class="line"></div><div class="line">    echo</div><div class="line">    echo &quot;*********************************************&quot;</div><div class="line">    echo &quot;* start ---&gt; $&#123;pngPath&#125;&quot;</div><div class="line">    echo &quot;*********************************************&quot;</div><div class="line">    echo</div><div class="line"></div><div class="line">    echo &quot;from -&gt; $&#123;pngPath&#125;&quot;</div><div class="line"></div><div class="line">    if [[ ! -f $&#123;pngPath&#125; ]]; then</div><div class="line">    echo &quot;can&apos;t find $&#123;pngPath&#125; &quot;</div><div class="line">    return;</div><div class="line">    fi</div><div class="line"></div><div class="line">    target_path=$&#123;pngPath&#125;</div><div class="line"></div><div class="line">    echo &quot;to -&gt; $&#123;target_path&#125;&quot;</div><div class="line"></div><div class="line">    width=`identify -format %w $&#123;pngPath&#125;`</div><div class="line">    echo &quot;width = $width&quot;</div><div class="line"></div><div class="line">    string=$&quot;\n&quot;</div><div class="line">    `echo convert -background &apos;#0008&apos; -fill white -gravity center -size $&#123;width&#125;x$&#123;width&#125; \</div><div class="line">    caption:&quot;$&#123;shortVersion&#125;$&#123;string&#125;$&#123;createDate&#125;$&#123;string&#125;$&#123;commit&#125;&quot; \</div><div class="line">    $&#123;pngPath&#125; +swap -gravity south -composite $&#123;target_path&#125;`</div><div class="line"></div><div class="line">    echo &quot;name = $&#123;shortVersion&#125;$&#123;string&#125;$&#123;createDate&#125;$&#123;string&#125;$&#123;commit&#125;&quot;</div><div class="line"></div><div class="line">    echo</div><div class="line">    echo &quot;*********************************************&quot;</div><div class="line">    echo &quot;* end &lt;--- $&#123;pngPath&#125;&quot;</div><div class="line">    echo &quot;*********************************************&quot;</div><div class="line">    echo</div><div class="line">&#125;</div><div class="line"></div><div class="line">#判断是否已经安装了必须工具 imagemagick ghostscript</div><div class="line">echo `brew ls` |grep -q &quot;imagemagick&quot;</div><div class="line">if [ $? -eq 0 ]; then</div><div class="line">    echo &quot;imagemagick installed &quot;</div><div class="line"></div><div class="line">    echo `brew ls` |grep -q &quot;ghostscript&quot;</div><div class="line">    if [ $? -eq 0 ]; then</div><div class="line">        echo &quot;ghostscript installed &quot;</div><div class="line"></div><div class="line">        for paths in $&#123;iconPaths[@]&#125;</div><div class="line">        do</div><div class="line">            processIcon $&#123;paths&#125;</div><div class="line">        done</div><div class="line"></div><div class="line">    fi</div><div class="line">fi</div><div class="line">echo</div><div class="line">echo &quot;*********************************************&quot;</div><div class="line">echo &quot;* run script end&quot;</div><div class="line">echo &quot;*********************************************&quot;</div><div class="line">echo</div></pre></td></tr></table></figure></p>
<p>最后，就是编译 apk 啦！</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://ww3.sinaimg.cn/large/006tNc79ly1fec0ms62mnj3053052wew.jpg&quot; alt=&quot;enter image description here|center&quot;&gt;&lt;br&gt;首先上一张效果吧！这是我们C
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Jenkins" scheme="http://www.kennethyo.me/tags/Jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Git-flow 学习总结</title>
    <link href="http://www.kennethyo.me/2017/03/06/untitled-1488794629968/"/>
    <id>http://www.kennethyo.me/2017/03/06/untitled-1488794629968/</id>
    <published>2017-03-06T10:03:49.000Z</published>
    <updated>2017-03-06T10:37:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>git 作为现在最为主流的版本管理工具，优点有很多，其中最为显著的一点就是分支管理。</p>
<p>作为一款优秀的版本管理工具，我在日常开发中也在使用，固定分支有两个，分别是 <code>master</code> 和 <code>develop</code> ，日常开发和测试都是针对 <code>develop</code>进行，这造成一个问题就是，每当上线版本发现bug的时候，<code>develop</code> 分支已经有下个版本正在开发的代码，从 tag 创建出来的分支合并到<br><code>master</code> 后，难以合并到 <code>develop</code> 。</p>
<p>基于上面的问题，上网搜索了 git 的工作流，其中讲的最多的就是 <code>git flow</code> ，下面就将 <code>git flow</code> 的学习结果总结如下。</p>
<h1 id="发图镇楼"><a href="#发图镇楼" class="headerlink" title="发图镇楼"></a>发图镇楼</h1><p><img src="https://ww4.sinaimg.cn/large/006tKfTcly1fdd9shg2uoj30yg1cpn9p.jpg" alt="enter image description here|center"></p>
<h1 id="Branch"><a href="#Branch" class="headerlink" title="Branch"></a>Branch</h1><p>主分支：<br><code>master</code>  发布到线上的代码应该和这个分支一致。<br><code>develop</code> 日常开发分支，其他分支基本围绕这个分支。</p>
<p>临时性分支：<br><code>feature/*</code> 新功能研发分支，从 <code>develop</code> 创建，研发完成，合并到 <code>develop</code>。<br><code>release/*</code> 预发布分支，从 <code>develop</code> 创建，进行测试，并修复 bugs。最终会合并到 <code>develop</code> 和 <code>master</code>分支。<br><code>hotfix/*</code>  紧急修复分支，从 <code>master</code> 创建，最终会合并到 <code>develop</code> 和 <code>master</code>分支。</p>
<h1 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h1><p>tag 永远只在 <code>master</code> 分支创建。</p>
<p><code>release/*</code> 分支合并到 <code>master</code> 之后，推送 <code>master</code> 到远端，然后创建 <code>tag</code> , 推送 <code>tag</code>到远端。<br><code>hotfix/*</code> 分支合并到 <code>master</code> 之后，推送 <code>master</code> 到远端，然后创建 <code>tag</code> , 推送 <code>tag</code>到远端。</p>
<h1 id="操作流"><a href="#操作流" class="headerlink" title="操作流"></a>操作流</h1><p>我们根据上面的理论，进行一次完整操作。</p>
<h2 id="创建-develop-分支"><a href="#创建-develop-分支" class="headerlink" title="创建 develop 分支"></a>创建 develop 分支</h2><p>新仓库默认是 <code>master</code> 分支，<code>master</code> 分支只作为发布版本，日常开发都要基于开发分支 <code>develop</code>。从 <code>master</code> 分支创建 <code>develop</code> 分支：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout -b develop master</div></pre></td></tr></table></figure></p>
<p>推送 <code>develop</code>分支，到远端：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push origin develop</div></pre></td></tr></table></figure></p>
<h2 id="v0-1-0-开始开发"><a href="#v0-1-0-开始开发" class="headerlink" title="v0.1.0 开始开发"></a>v0.1.0 开始开发</h2><p>现在来开发第一个版本 <code>v0.1.0</code>，首先从 <code>develop</code> 创建分支 <code>feature/v0.1.0</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout -b feature/v0.1.0 develop</div></pre></td></tr></table></figure></p>
<p>推送到远端：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push origin feature/v0.1.0</div></pre></td></tr></table></figure></p>
<p>各种 <code>v0.1.0</code>版本功能代码的提交…<br>…….</p>
<h2 id="v0-1-0-完成开发"><a href="#v0-1-0-完成开发" class="headerlink" title="v0.1.0 完成开发"></a>v0.1.0 完成开发</h2><p>开发完成后，将 <code>feature/v0.1.0</code> 合并到 <code>develop</code>  分支：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git checkout develop</div><div class="line">git merge --no-ff feature/v0.1.0</div></pre></td></tr></table></figure></p>
<p><code>--no-ff</code> 参数的意思是不进行快速合并，<code>merge</code>命令默认会进行“快进式合并（fast-farward merge）”，直接将 <code>develop</code> 指向 <code>feature/v0.1.0</code>，这里使用<a href="http://www.ruanyifeng.com/" target="_blank" rel="external">阮一峰</a>在<a href="http://www.ruanyifeng.com/blog/2012/07/git.html" target="_blank" rel="external">Git分支管理策略</a>中的图片。<br><img src="https://ww2.sinaimg.cn/large/006tKfTcly1fdcxolq5hvj30dw0gu759.jpg" alt="Alt text|center|300x0"><br>加上<code>--no-ff</code> 参数后，合并的时候会生成一个新节点。可以保证版本演进的清晰。<br><img src="https://ww4.sinaimg.cn/large/006tKfTcly1fdcxrpvc6lj306y0k63yz.jpg" alt="enter image description here|center|0x300"><br>推送到远端：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push origin develop</div></pre></td></tr></table></figure></p>
<p>删除 <code>feature/v0.1.0</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -b feature/v0.1.0</div></pre></td></tr></table></figure></p>
<h2 id="预发布"><a href="#预发布" class="headerlink" title="预发布"></a>预发布</h2><p>开发完成之后，要进行测试，fix bugs。创建预发布分支：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git checkout -b release/v0.1.0 develop</div><div class="line">git push origin release/v0.1.0</div></pre></td></tr></table></figure></p>
<p>各种测试，各种蹂躏，各种 fix bugs ……</p>
<h2 id="发布版本"><a href="#发布版本" class="headerlink" title="发布版本"></a>发布版本</h2><p>经过测试和修复，终于要上线了，合并 <code>release/v0.1.0</code> 到 <code>master</code> 和 <code>develop</code>：<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#合并到master</span></div><div class="line">git checkout master</div><div class="line">git merge --no-ff release/v0.<span class="number">1.0</span></div><div class="line">git push origin master</div><div class="line"><span class="comment">#打上tag</span></div><div class="line">git tag -a v0.<span class="number">1.0</span> -m <span class="string">"publish v0.1.0"</span></div><div class="line">git push origin v0.<span class="number">1.0</span></div><div class="line"><span class="comment">#合并到develop</span></div><div class="line">git checkout develop</div><div class="line">git merge --no-ff release/v0.<span class="number">1.0</span></div><div class="line">git push origin develop</div><div class="line"><span class="comment">#删除 release/v0.1.0</span></div><div class="line">git branch -d release/v0.<span class="number">1.0</span></div></pre></td></tr></table></figure></p>
<h2 id="出-bug-了"><a href="#出-bug-了" class="headerlink" title="出 bug 了"></a>出 bug 了</h2><p>代码上线之后，出 bug 是谁都不愿意看到的，但是难免会出的嘛。下面我们进行修复，下面我们从 <code>master</code> 创建 <code>hotfix/v0.1.0</code> 分支，进行修复工作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git checkout -b hotfix/v0.1.0 master</div><div class="line">git push origin hotfix/v0.1.0</div></pre></td></tr></table></figure></p>
<p>修复完成之后合并到 <code>master</code> 和 <code>develop</code> 分支：<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#合并到master</span></div><div class="line">git checkout master</div><div class="line">git merge --no-ff hotfix/v0.<span class="number">1.0</span></div><div class="line">git push origin master</div><div class="line"><span class="comment">#打上tag</span></div><div class="line">git tag -a v0.<span class="number">1.1</span> -m <span class="string">"publish v0.1.1"</span></div><div class="line">git push origin v0.<span class="number">1.1</span></div><div class="line"><span class="comment">#合并到develop</span></div><div class="line">git checkout develop</div><div class="line">git merge --no-ff hotfix/v0.<span class="number">1.0</span></div><div class="line">git push origin develop</div><div class="line"><span class="comment">#删除 hotfix/v0.1.0</span></div><div class="line">git branch -d hotfix/v0.<span class="number">1.0</span></div></pre></td></tr></table></figure></p>
<h1 id="利与弊"><a href="#利与弊" class="headerlink" title="利与弊"></a>利与弊</h1><p>各个分支，各司其职，清晰可控。</p>
<p>经常切换分支，容易进行误操作（在不对应的分支上进行提交，细心能够解决）。</p>
<h1 id="Git-flow-工具"><a href="#Git-flow-工具" class="headerlink" title="Git-flow 工具"></a>Git-flow 工具</h1><p>由 <code>git flow</code> 提出者 <a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="external">Vincent Driessen</a>开发的 <code>git flow</code>工具。</p>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><h3 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a><a href="http://github.com/mxcl/homebrew" target="_blank" rel="external">Homebrew</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install git-flow</div></pre></td></tr></table></figure>
<h3 id="MacPorts"><a href="#MacPorts" class="headerlink" title="MacPorts"></a><a href="https://www.macports.org/" target="_blank" rel="external">MacPorts</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">port install git-flow</div></pre></td></tr></table></figure>
<h3 id="wget"><a href="#wget" class="headerlink" title="wget"></a><a href="https://zh.wikipedia.org/wiki/Wget" target="_blank" rel="external">wget</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget --no-check-certificate -q -O - https://github.com/nvie/gitflow/raw/develop/contrib/gitflow-installer.sh | sudo bash</div></pre></td></tr></table></figure>
<h3 id="cURL"><a href="#cURL" class="headerlink" title="cURL"></a><a href="https://zh.wikipedia.org/zh-cn/CURL" target="_blank" rel="external">cURL</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -L -O https://raw.github.com/nvie/gitflow/develop/contrib/gitflow-installer.sh</div><div class="line">sudo bash gitflow-installer.sh</div></pre></td></tr></table></figure>
<h2 id="操作流-1"><a href="#操作流-1" class="headerlink" title="操作流"></a>操作流</h2><p>在项目根目录初始化 <code>git flow</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git flow init</div></pre></td></tr></table></figure></p>
<p>会出现如下的一系列问题，都是设置各个分支前缀，直接回车默认值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Which branch should be used for bringing forth production releases?</div><div class="line">   - master</div><div class="line">Branch name for production releases: [master]</div><div class="line">Branch name for &quot;next release&quot; development: [develop]</div><div class="line"></div><div class="line">How to name your supporting branch prefixes?</div><div class="line">Feature branches? [feature/]</div><div class="line">Release branches? [release/]</div><div class="line">Hotfix branches? [hotfix/]</div><div class="line">Support branches? [support/]</div><div class="line">Version tag prefix? []</div></pre></td></tr></table></figure></p>
<p>初始化完成之后，当前分支会变成 <code>develop</code> 分支。</p>
<h3 id="v0-1-0-开始开发-1"><a href="#v0-1-0-开始开发-1" class="headerlink" title="v0.1.0 开始开发"></a>v0.1.0 开始开发</h3><p>输入如下命令，会从 <code>develop</code> 分支创建出 <code>feature/v0.1.0</code> 分支。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git flow feature start v0.1.0</div></pre></td></tr></table></figure></p>
<p>推送分支到远端：<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git flow feature publish v0.<span class="number">1.0</span></div><div class="line"><span class="comment">#或者</span></div><div class="line">git push origin feature/v0.<span class="number">1.0</span></div></pre></td></tr></table></figure></p>
<h3 id="v0-1-0-完成开发-1"><a href="#v0-1-0-完成开发-1" class="headerlink" title="v0.1.0 完成开发"></a>v0.1.0 完成开发</h3><p>输入如下命令，会把 <code>feature/v0.1.0</code> 分支合并到 <code>develop</code> 分支，并删除 <code>feature/v0.1.0</code>分支。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git flow feature finish v0.1.0</div></pre></td></tr></table></figure></p>
<h3 id="预发布-1"><a href="#预发布-1" class="headerlink" title="预发布"></a>预发布</h3><p>输入如下命令，会从 <code>develop</code> 分支创建出 <code>release/v0.1.0</code> 分支：<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git flow release start v0.<span class="number">1.0</span></div><div class="line"><span class="comment">#推送到远端</span></div><div class="line">git flow release publish v0.<span class="number">1.0</span></div><div class="line"><span class="comment">#或者</span></div><div class="line">git push origin release/v0.<span class="number">1.0</span></div></pre></td></tr></table></figure></p>
<h3 id="发布版本-1"><a href="#发布版本-1" class="headerlink" title="发布版本"></a>发布版本</h3><p>输入如下命令，会把 <code>release/v0.1.0</code> 分支合并到 <code>develop</code> 分支和 <code>master</code> 分支，并删除 <code>release/v0.1.0</code>分支。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git flow release finish v0.1.0</div></pre></td></tr></table></figure></p>
<h3 id="出-bug-了-1"><a href="#出-bug-了-1" class="headerlink" title="出 bug 了"></a>出 bug 了</h3><p>输入如下命令，会从 <code>master</code> 创建 <code>hotfix/v0.1.1</code> 分支。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git flow hotfix start v0.1.1</div></pre></td></tr></table></figure></p>
<p>修复完成，输入如下命令，会合分别合并到 <code>master</code> 和 <code>develop</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git flow hotfix finish v0.1.1</div></pre></td></tr></table></figure></p>
<h1 id="抄袭文献"><a href="#抄袭文献" class="headerlink" title="抄袭文献"></a>抄袭文献</h1><p>1，<a href="http://www.ruanyifeng.com/blog/2015/12/git-workflow.html" target="_blank" rel="external">Git 工作流程</a><br>2，<a href="http://www.ruanyifeng.com/blog/2012/07/git.html" target="_blank" rel="external">Git分支管理策略</a><br>3，<a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="external">A successful Git branching model</a><br>4，<a href="https://github.com/nvie/gitflow" target="_blank" rel="external">gitflow</a><br>5，<a href="http://stormzhang.com/git/2014/01/29/git-flow/" target="_blank" rel="external">使用GIT FLOW管理开发流程</a><br>6，<a href="https://www.git-tower.com/learn/git/ebook/cn/command-line/advanced-topics/git-flow" target="_blank" rel="external">git-flow 的工作流程</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;git 作为现在最为主流的版本管理工具，优点有很多，其中最为显著的一点就是分支管理。&lt;/p&gt;
&lt;p&gt;作为一款优秀的版本管理工具，我在日常开发中也在使用，固定分支有两个，分别是 &lt;code&gt;master&lt;/code&gt; 和 &lt;code&gt;develop&lt;/code&gt; ，日常开发和
    
    </summary>
    
      <category term="Git" scheme="http://www.kennethyo.me/categories/Git/"/>
    
    
      <category term="git" scheme="http://www.kennethyo.me/tags/git/"/>
    
      <category term="git-flow" scheme="http://www.kennethyo.me/tags/git-flow/"/>
    
  </entry>
  
  <entry>
    <title>Travis 和 CircleCI 配置文件</title>
    <link href="http://www.kennethyo.me/2016/11/08/untitled-1478588050831/"/>
    <id>http://www.kennethyo.me/2016/11/08/untitled-1478588050831/</id>
    <published>2016-11-08T07:09:56.000Z</published>
    <updated>2016-11-08T07:11:49.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>以下都用 <a href="https://github.com/KennethYo/BrakeLight" target="_blank" rel="external"><code>BrakeLight</code></a> 项目举例。</p>
</blockquote>
<p>#<a href="https://circleci.com/" target="_blank" rel="external">Circleci</a><br>在项目目录中创建 <code>circle.yml</code> 文件，内容如下：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">machine:</span></div><div class="line">  <span class="symbol">java:</span></div><div class="line">      <span class="symbol">version:</span> oraclejdk8</div><div class="line"></div><div class="line"><span class="symbol">dependencies:</span></div><div class="line">  <span class="symbol">pre:</span></div><div class="line">    - <span class="keyword">if</span> [ ! -d <span class="string">"/usr/local/android-sdk-linux/platforms/android-24"</span> ]; <span class="keyword">then</span> echo y <span class="params">| android update sdk --no-ui --all --filter "android-24"; fi</span></div><div class="line"><span class="params">    - <span class="keyword">if</span> [ ! -d "/usr/local/android-sdk-linux/build-tools/24.0.2" ]; <span class="keyword">then</span> echo y |</span> android update sdk --no-ui --all --filter <span class="string">"build-tools-24.0.2"</span>; fi</div><div class="line">    - <span class="keyword">if</span> [ ! -d <span class="string">"/usr/local/android_sdk/extras/android/m2repository/com/android/support/support-core-utils/24.2.1"</span> ]; <span class="keyword">then</span> echo y <span class="params">| android update sdk --no-ui --all --filter "extra-android-m2repository"; fi</span></div><div class="line"><span class="params"></span></div><div class="line"><span class="params">test:</span></div><div class="line"><span class="params">  override:</span></div><div class="line"><span class="params">    - ./gradlew assembleRelease</span></div></pre></td></tr></table></figure></p>
<p>#<a href="https://travis-ci.org" target="_blank" rel="external">Travis</a><br>在项目目录中创建 <code>.travis.yml</code> 文件，内容如下：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">sudo:</span> <span class="literal">false</span></div><div class="line"></div><div class="line"><span class="symbol">language:</span> android</div><div class="line"></div><div class="line"><span class="symbol">jdk:</span></div><div class="line">  - oraclejdk8</div><div class="line"></div><div class="line"><span class="symbol">android:</span></div><div class="line">  <span class="symbol">components:</span></div><div class="line">    - platform-tools</div><div class="line">    - tools</div><div class="line">    - build-tools-<span class="number">24.0</span>.<span class="number">2</span></div><div class="line">    - android-<span class="number">24</span></div><div class="line">    - extra-android-m2repository</div><div class="line">    - extra-android-support</div></pre></td></tr></table></figure></p>
<p>#其实还有<a href="https://app.shippable.com" target="_blank" rel="external">Shippable</a><br>国内访问速度比较慢，Android 支持的不好，放弃了。</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;以下都用 &lt;a href=&quot;https://github.com/KennethYo/BrakeLight&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;BrakeLight&lt;/code&gt;&lt;/a&gt; 项目举例。&lt;/p&gt;

    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="CI" scheme="http://www.kennethyo.me/tags/CI/"/>
    
  </entry>
  
  <entry>
    <title>自建私有 Maven 仓库</title>
    <link href="http://www.kennethyo.me/2016/09/01/untitled-1472722428873/"/>
    <id>http://www.kennethyo.me/2016/09/01/untitled-1472722428873/</id>
    <published>2016-09-01T09:33:48.000Z</published>
    <updated>2017-03-06T11:05:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>项目组从2015年上半年全面切换到 AndroidStudio 进行开发，随着这1年多业务逻辑和代码逻辑的增长，导致项目  LibraryModule 由最初的3个增长到如今的8个。</p>
<p>代码量的增加必然导致编译的变慢，AndroidStudio 在编译项目时会先编译 LibraryModule 生成 aar 包，之后这些 aar 包会和 APPModule 进行集成编译，最终生成 APK。这个编译过程，第一次在5.0及以上手机安装，经常会出现6分钟以上的编译时间，5.0以下手机也有3分钟左右的编译时间，这些时间严重影响了工作效率！</p>
<p>考虑到 LibraryModule 是长期不会修改的代码，如果发布成 aar 加入到项目里，就可以节省下每次 Module 编译的时间。</p>
<p>如果能够像 compile 第三方 Library 那样引用我们的 Library ，岂不是又降低 Module 的耦合，又单独对 Library 增加了版本控制。第三方 Library  基本都是把 aar 发布到中央 Maven 对外提供引用，而我们的 Library 作为公司的商业项目，是不可能发布到中央 Maven 对外提供引用的，这就要求我们需要有自己的 Maven 服务。</p>
<p>私有 Maven 还会产生另一个好处，就是代理中央 Maven 仓库。例如，我们新加入了一个第三方库，导致每个人的 IDE 都需要从中央 Maven pull 库，而中国 GFW 的存在，导致中央 Maven 极其不稳定，经常 time out ，有了代理 Maven，只要代理 maven pull 一次库，每个人就不必从中央 Maven pull库了。</p>
<p>这里我们是用 Docker 作为容器，在里面搭建的 Sonatype Nexus 私有 Maven 仓库。使用 Docker 的好处是可以把环境独立出来不会和服务器其他服务产生冲突，卸载也简单。</p>
<h1 id="安装-Docker-并运行-Nexus"><a href="#安装-Docker-并运行-Nexus" class="headerlink" title="安装 Docker 并运行 Nexus"></a>安装 Docker 并运行 Nexus</h1><p>1，下载 并安装 Docker，<a href="https://www.docker.com/products/docker#/mac" target="_blank" rel="external">传送门</a></p>
<p>2，在 Terminal 中输入<code>docker -v</code>，如果显示版本号，说明安装后环境是没有问题的，如下是我显示的版本号：<br><code>Docker version 1.12.0, build 8eab29e</code></p>
<p>3，在 Terminal 输入<code>docker pull sonatype/nexus</code>进行下载 nexus 镜像。<br>下载过程中，会显示下载进度。如果比较慢或者超时，请在 Docker 里设置 mirror。如下图，我配置了灵雀加速和阿里云加速。</p>
<p><img src="http://ww1.sinaimg.cn/large/72f96cbajw1f7e4dnn8xcj20l40u60w6.jpg" alt="这里写图片描述"><br>灵雀加速：<a href="http://houchaohann.m.alauda.cn" target="_blank" rel="external">http://houchaohann.m.alauda.cn</a><br>阿里云加速：<a href="https://3wky8dz8.mirror.aliyuncs.com" target="_blank" rel="external">https://3wky8dz8.mirror.aliyuncs.com</a> </p>
<p>下载成功后显示如下图：<br><img src="http://ww4.sinaimg.cn/large/72f96cbajw1f7e4gjbjvbj20g306kjs1.jpg" alt=""></p>
<p>4，在 Terminal 中输入<code>docker run -d -p 8081:8081 --name  yiche sonatype/nexus:oss</code>来创建一个名叫 yiche 的容器，占用端口8081。</p>
<p><img src="http://ww3.sinaimg.cn/large/72f96cbajw1f7e4kafrkcj20lw01bdg3.jpg" alt="这里写图片描述"></p>
<p>5，在 Terminal 中输入<code>docker ps -a</code>查看容器</p>
<p><img src="http://ww1.sinaimg.cn/large/72f96cbajw1f7e4quvlv0j20q401sglu.jpg" alt="这里写图片描述"></p>
<p>6，浏览器里输入<a href="http://localhost:8081/" target="_blank" rel="external">http://localhost:8081/</a>，如果显示如下界面，证明 Nexus 搭建成功。</p>
<p><img src="http://ww4.sinaimg.cn/large/72f96cbajw1f7e4x3tmhej21kw0zkk21.jpg" alt="这里写图片描述"></p>
<p>7，一些常用指令：<br><code>docker start yiche</code>开始运行yiche 容器<br><code>docker restart yiche</code>c运 重新行yiche容器<br><code>docker stop yiche</code>停止运行yiche容器<br><code>docker rm yiche</code>删除yiche容器</p>
<h1 id="Nexus-使用"><a href="#Nexus-使用" class="headerlink" title="Nexus 使用"></a>Nexus 使用</h1><p>点击右上角<code>login</code>登录，默认账户<code>admin</code>，默认密码<code>admin123</code> 。</p>
<p>点击左侧栏目的<code>Repositories</code>，显示Nexus 默认已经有的仓库，如下图：</p>
<p><img src="http://ww1.sinaimg.cn/large/72f96cbajw1f7e5tldqexj21kw0zkwrs.jpg" alt="这里写图片描述"></p>
<h2 id="创建一个私有仓库"><a href="#创建一个私有仓库" class="headerlink" title="创建一个私有仓库"></a>创建一个私有仓库</h2><p>1，点击<code>add</code>，选择<code>Hosted Repository</code></p>
<p>2，在下方输入<code>Repository ID</code>和<code>Repository Name</code>，这里我分别输入的是<code>demo</code>和<code>Demo</code>，这里可以换成你自己的。</p>
<p>3，部署策略<code>Deployment Policy</code>选择为<code>Allow Redeploy</code>允许重新部署。</p>
<p>4，点击<code>save</code>保存，在上方列表中就会显示完成的仓库信息，最后一列<code>Repository Path</code>就是仓库的地址。</p>
<p>如下图：<br><img src="http://ww1.sinaimg.cn/large/72f96cbajw1f7e625xn92j21kw0zkdsb.jpg" alt="这里写图片描述"></p>
<p>注：如果在<code>Repository Policy</code>选择<code>snapshot</code>，仓库就是快照版仓库。</p>
<h2 id="代理仓库"><a href="#代理仓库" class="headerlink" title="代理仓库"></a>代理仓库</h2><p>这里我是代理的 jcenter，因为这是 Android  Studio 的默认仓库。</p>
<p>1，点击<code>add</code>，选择<code>Proxy Repository</code></p>
<p>2，在下方输入<code>Repository ID</code>和<code>Repository Name</code>，这里我分别输入的是<code>jcenter</code>和<code>Jcenter</code>，因为代理的就是 jcenter 哈。</p>
<p>3，在<code>Remote Storage Location</code>输入代理仓库的仓库地址<code>http://jcenter.bintray.com/</code>。</p>
<p>4，点击<code>save</code>保存，在上方列表中就会显示完成的仓库信息，最后一列<code>Repository Path</code>就是仓库的地址。</p>
<p>如下图：<br><img src="http://ww3.sinaimg.cn/large/72f96cbajw1f7e6iqpczrj21kw0zktlr.jpg" alt="这里写图片描述"></p>
<p>其实在我们项目里并没有新创建一个仓库，而是直接用的默认<code>Release</code>和<code>Snapshot</code>。</p>
<p><img src="http://ww2.sinaimg.cn/large/72f96cbajw1f7e6n006u5j21ji02sgn0.jpg" alt="这里写图片描述"></p>
<h1 id="Android-Studio-中上传-Library-Module-到私有-maven"><a href="#Android-Studio-中上传-Library-Module-到私有-maven" class="headerlink" title="Android Studio 中上传 Library Module 到私有 maven"></a>Android Studio 中上传 Library Module 到私有 maven</h1><h2 id="上传到-Maven"><a href="#上传到-Maven" class="headerlink" title="上传到 Maven"></a>上传到 Maven</h2><p>因为，Module比较多，我在项目根目录里写了一个 gradle 文件<code>gradle_mvn_push.gradle</code>来上传。代码如下：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">apply <span class="string">plugin:</span> <span class="string">'maven'</span></div><div class="line"><span class="comment">//release 地址</span></div><div class="line"><span class="keyword">def</span> RELEASE_REPOSITORY_URL = <span class="string">"http://192.168.4.53:32770/content/repositories/releases/"</span></div><div class="line"><span class="comment">//snapshots 地址</span></div><div class="line"><span class="keyword">def</span> SNAPSHOT_REPOSITORY_URL = <span class="string">"http://192.168.4.53:32770/content/repositories/snapshots/"</span></div><div class="line"><span class="comment">//判断 VERSION_NAME 如果以`-SHAPSHOT`结尾,则上传地址为 snapshot 地址</span></div><div class="line"><span class="keyword">def</span> REPOSITORY_URL = VERSION_NAME.endsWith(<span class="string">"-SNAPSHOT"</span>) ? SNAPSHOT_REPOSITORY_URL : RELEASE_REPOSITORY_URL;</div><div class="line"></div><div class="line">logger.info(<span class="string">"groupId = %s\t\nartifactId = %s\t\nversion = %s\t\nrepository = %s\t\n"</span>, GROUP, POM_ARTIFACT_ID, VERSION_NAME, REPOSITORY_URL)</div><div class="line"></div><div class="line">afterEvaluate &#123; project -&gt;</div><div class="line">    uploadArchives &#123;</div><div class="line">        repositories.mavenDeployer &#123;</div><div class="line">            pom.groupId = GROUP</div><div class="line">            pom.artifactId = POM_ARTIFACT_ID</div><div class="line">            pom.version = VERSION_NAME</div><div class="line">            repository(<span class="string">url:</span> REPOSITORY_URL) &#123;</div><div class="line">                authentication(<span class="string">userName:</span> NEXUS_USERNAME, <span class="string">password:</span> NEXUS_PASSWORD)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    task androidSourcesJar(<span class="string">type:</span> Jar) &#123;</div><div class="line">        classifier = <span class="string">'sources'</span></div><div class="line">        from android.sourceSets.main.java.sourceFiles</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    artifacts &#123;</div><div class="line">        archives androidSourcesJar</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后在你要上传 module 的<code>build.gradle</code> 文件引入。<br>如下图是我们换肤 Module 的 <code>build.gradle</code>：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.library'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion Integer.valueOf(COMPILE_SDK_VERSION)</div><div class="line">    buildToolsVersion BUILD_TOOLS_VERSION</div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        minSdkVersion MIN_SDK_VERSION</div><div class="line">        targetSdkVersion TARGET_SDK_VERSION</div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            minifyEnabled <span class="literal">false</span></div><div class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    compile fileTree(<span class="string">dir:</span> <span class="string">'libs'</span>, <span class="string">include:</span> [<span class="string">'*.jar'</span>])</div><div class="line">    compile SUPPORT_APPCOMPAT_V7</div><div class="line">    compile SUPPORT_CARDVIEW_V7</div><div class="line">&#125;</div><div class="line"></div><div class="line">ext.GROUP=<span class="string">"com.yiche"</span></div><div class="line">ext.VERSION_NAME=<span class="string">"1.1.0-SNAPSHOT"</span></div><div class="line">ext.POM_ARTIFACT_ID=<span class="string">"changeskin"</span></div><div class="line"></div><div class="line">apply <span class="string">from:</span> <span class="string">"$&#123;project.rootDir&#125;/gradle_mvn_push.gradle"</span></div></pre></td></tr></table></figure></p>
<p>这里请关注下面的代码，<code>GROUP</code>，<code>VERSION_NAME</code>，<code>POM_ARTIFACT_ID</code>和最后一行引入我们前面写的<code>gradle_mvn_push.gradle</code>。</p>
<p><code>GROUP</code>一般代表了你的组织名称，例如我的<code>com.yiche</code><br><code>POM_ARTIFACT_ID</code>Library 的简称。<br><code>VERSION_NAME</code>版本号，如果有<code>-SNAPSHOT</code>表示是快照版。</p>
<p>上面这三个也就组成了我们平常看见的引依赖 <code>com.yiche:changeskin:1.1.0-SNAPSHOT</code></p>
<h2 id="引用私有-Maven"><a href="#引用私有-Maven" class="headerlink" title="引用私有 Maven"></a>引用私有 Maven</h2><p>下面就直接上一段代码吧，这是项目根目录的<code>build.gradle</code>里面修改了 maven 仓库的地址。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></div><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    dependencies &#123;</div><div class="line">        classpath <span class="string">'com.android.tools.build:gradle:2.1.3'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line"></div><div class="line">    repositories &#123;</div><div class="line"><span class="comment">//        jcenter()</span></div><div class="line">        <span class="comment">// 私有 release 地址</span></div><div class="line">        maven&#123;</div><div class="line">            url <span class="string">"http://192.168.4.53:32770/content/repositories/releases/"</span></div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 私有 snapshot 地址</span></div><div class="line">        maven&#123;</div><div class="line">            url <span class="string">"http://192.168.4.53:32770/content/repositories/snapshots/"</span></div><div class="line">        &#125;</div><div class="line">        <span class="comment">//jcenter 代理</span></div><div class="line">        maven&#123;</div><div class="line">            url <span class="string">"http://192.168.4.53:32770/content/repositories/jcenter/"</span></div><div class="line">        &#125;</div><div class="line">        <span class="comment">// maven 代理</span></div><div class="line">        maven&#123;</div><div class="line">            url <span class="string">"http://192.168.4.53:32770/content/repositories/central/"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">task clean(<span class="string">type:</span> Delete) &#123;</div><div class="line">    delete rootProject.buildDir</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>好的，到这里就算结束了，后面这部分写的比较少，有问题留言啦。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;项目组从2015年上半年全面切换到 AndroidStudio 进行开发，随着这1年多业务逻辑和代码逻辑的增长，导致项目  LibraryModule 由最初的3个增长到如今的8个。&lt;/p&gt;
&lt;p&gt;代码量的增加必然导致编译的变慢，AndroidStudio 在编译项目时会先
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Nexus" scheme="http://www.kennethyo.me/tags/Nexus/"/>
    
      <category term="maven" scheme="http://www.kennethyo.me/tags/maven/"/>
    
      <category term="jcenter" scheme="http://www.kennethyo.me/tags/jcenter/"/>
    
      <category term="Docker" scheme="http://www.kennethyo.me/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>TextUtils方法介绍</title>
    <link href="http://www.kennethyo.me/2016/07/06/2016-07-06/"/>
    <id>http://www.kennethyo.me/2016/07/06/2016-07-06/</id>
    <published>2016-07-06T07:50:37.000Z</published>
    <updated>2016-09-01T06:36:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>把一个<code>List&lt;String&gt;</code>输出成<code>a,b,c</code>这种形式，我们项目里面提供了一个这样的工具类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public static String getString(List&lt;String&gt; list) &#123;</div><div class="line">        if (CollectionsWrapper.isEmpty(list)) return null;</div><div class="line"></div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        int size = list.size();</div><div class="line">        for (int i = 0; i &lt; size; i++) &#123;</div><div class="line">            sb.append(list.get(i));</div><div class="line"></div><div class="line">            if (i != size - 1) &#123;</div><div class="line">                sb.append(&quot;,&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return sb.toString();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>方法肯定是多种多样的，但是<code>Android SDK</code>在<code>TextUtils</code>里面就有提供了一个方法<code>join</code>，可以达到效果。</p>
<p>平常我开发用<code>TextUtils</code>中最多的方法分别是<code>isEmpty</code>和<code>equals</code>。其他方法了解并不多，或者不了解，下面我们开始介绍一下<code>TextUtils</code>中的方法（注：方法重载只介绍一种，隐藏和私有方法没有介绍）：</p>
<h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><p>Demo 地址：<a href="https://github.com/KennethYo/TextUtilsDemo" target="_blank" rel="external">传送门</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">private String mWords1 = &quot;这句话很长很长，真的很长很长，长的不得了，长的不要不要的，长...长长...chang...chang................&quot;;</div><div class="line">private String mWords2 = &quot;Andy, Bob, Charles, David, Andy, Bob, Charles, David, Andy, Bob, Charles, David, Andy, Bob, Charles, David, Andy, Bob, Charles, David&quot;;</div><div class="line">//把“很长”设置为红色背景</div><div class="line">mSpanny1 = new Spanny(mWords1).findAndSpan(&quot;很长&quot;, new Spanny.GetSpan() &#123;</div><div class="line">            @Override</div><div class="line">            public Object getSpan() &#123;</div><div class="line">                return new BackgroundColorSpan(Color.RED);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">//把“Bob”设置为红色背景</div><div class="line">mSpanny2 = new Spanny(mWords2).findAndSpan(&quot;Bob&quot;, new Spanny.GetSpan() &#123;</div><div class="line">            @Override</div><div class="line">            public Object getSpan() &#123;</div><div class="line">                return new BackgroundColorSpan(Color.GREEN);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<h1 id="commaEllipsize"><a href="#commaEllipsize" class="headerlink" title="commaEllipsize"></a>commaEllipsize</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public static CharSequence commaEllipsize(CharSequence text,</div><div class="line">                                              TextPaint p, float avail,</div><div class="line">                                              String oneMore,</div><div class="line">                                              String more)</div></pre></td></tr></table></figure>
<p>例如<code>Andy, Bob, Charles, David</code>这样的句子，修改为能够在一行<code>avail</code>宽度显示。发回结果例如<br><code>Andy, Bob, 1 more</code>或<code>Andy, Bob, 2 more</code>。<br>注意：more 中的数字要有<code>%d</code>来format，来显示不同的数字。<code>text</code>中必须用英文逗号分隔。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CharSequence output = TextUtils.commaEllipsize(mWords2, mTextView.getPaint(), mScreenWidth, &quot;1 more&quot;, &quot;%d more&quot;);</div></pre></td></tr></table></figure>
<h1 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static CharSequence concat(CharSequence... text)</div></pre></td></tr></table></figure>
<p>text 为可变参数，可以将传入的<code>CharSequence</code>组成一个<code>CharSequence</code>，并保留原有的<code>Span</code>。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CharSequence charSequence = TextUtils.concat(mSpanny1, mSpanny2);</div><div class="line">                mOutputView.setText(charSequence);</div></pre></td></tr></table></figure>
<h1 id="copySpansFrom"><a href="#copySpansFrom" class="headerlink" title="copySpansFrom"></a>copySpansFrom</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public static void copySpansFrom(Spanned source, int start, int end,</div><div class="line">                                     Class kind,</div><div class="line">                                     Spannable dest, int destoff)</div></pre></td></tr></table></figure>
<p>从<code>source</code>中<code>start</code>到<code>end</code> 中的<code>span</code>复制到<code>dest</code>中，<code>destoff</code>是偏移量。这个方法在<code>concat</code>中有用到。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">String words = mWords1 + mWords2;</div><div class="line">mTextView.setText(words);</div><div class="line">mTextView.append(&quot;\n\n&quot;);</div><div class="line">mTextView.append(mSpanny2);</div><div class="line"></div><div class="line">SpannableString ss = new SpannableString(words);</div><div class="line">TextUtils.copySpansFrom(mSpanny2, 0, mSpanny2.length(), Object.class, ss, mWords1.length());</div><div class="line"></div><div class="line">mOutputView.setText(ss);</div></pre></td></tr></table></figure>
<h1 id="dumpSpans"><a href="#dumpSpans" class="headerlink" title="dumpSpans"></a>dumpSpans</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static void dumpSpans(CharSequence cs, Printer printer, String prefix)</div></pre></td></tr></table></figure>
<p>打印<code>cs</code>中的<code>Span</code>，<code>prefix</code>会在打印每个<code>Span</code>开始出现。<code>printer</code>，可以用<code>LogPrinter</code>，这样就可以打印在 log 里。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TextUtils.dumpSpans(mSpanny1, new LogPrinter(Log.INFO, &quot;kenneth&quot;), &quot;yo&quot;);</div></pre></td></tr></table></figure>
<p>Log日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">07-01 14:53:20.229 9835-9835/me.kenneth.textutildemo I/kenneth: yo很长: 4189d0d0 android.text.style.BackgroundColorSpan (3-5) fl=#33</div><div class="line">07-01 14:53:20.229 9835-9835/me.kenneth.textutildemo I/kenneth: yo很长: 4189d3a8 android.text.style.BackgroundColorSpan (5-7) fl=#33</div><div class="line">07-01 14:53:20.229 9835-9835/me.kenneth.textutildemo I/kenneth: yo很长: 4189d5b8 android.text.style.BackgroundColorSpan (10-12) fl=#33</div><div class="line">07-01 14:53:20.230 9835-9835/me.kenneth.textutildemo I/kenneth: yo很长: 4189d728 android.text.style.BackgroundColorSpan (12-14) fl=#33</div></pre></td></tr></table></figure>
<h1 id="ellipsize"><a href="#ellipsize" class="headerlink" title="ellipsize"></a>ellipsize</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public static CharSequence ellipsize(CharSequence text,</div><div class="line">                                         TextPaint paint,</div><div class="line">                                         float avail, TruncateAt where,</div><div class="line">                                         boolean preserveLength,</div><div class="line">                                         EllipsizeCallback callback)</div></pre></td></tr></table></figure>
<p>相当于 <code>TextView</code> 的 xml 中<code>ellipsize</code>，这里可以回调省略范围的 <code>index</code>，同时也可用通过<code>preserveLength</code>，设置返回的 <code>CharSequence</code> 的长度为原始长度还是省略后的长度，这里利用的”零宽不换行空格符”来占位，<code>where</code>参数可以用<code>TextUtils.TruncateAt.START</code>，<code>TextUtils.TruncateAt.END</code>，<code>TextUtils.TruncateAt.MIDDLE</code>和<code>TextUtils.TruncateAt.MARQUEE</code>，分别是开始，结尾，中间和跑马灯。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">CharSequence ellipsize = TextUtils.ellipsize(mWords2, mTextView.getPaint(), mScreenWidth, TextUtils.TruncateAt.START, true, new TextUtils.EllipsizeCallback() &#123;</div><div class="line">                    @Override</div><div class="line">                    public void ellipsized(int i, int i1) &#123;</div><div class="line">                        Log.i(TAG, &quot;被省略范围 &quot; + i + &quot; &quot; + i1);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure>
<h1 id="equals"><a href="#equals" class="headerlink" title="equals"></a>equals</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static boolean equals(CharSequence a, CharSequence b)</div></pre></td></tr></table></figure>
<p>比较字符串是否相等，可以看一下源码，如果是相同文本内容，但是<code>span</code>不同，也可以比较为相同。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TextUtils.equals(mWords1, mSpanny1)</div></pre></td></tr></table></figure>
<h1 id="expandTemplate"><a href="#expandTemplate" class="headerlink" title="expandTemplate"></a>expandTemplate</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static CharSequence expandTemplate(CharSequence template,</div><div class="line">                                              CharSequence... values)</div></pre></td></tr></table></figure>
<p>替换<code>template</code>当中的<code>^1`` ^2</code> 等为<code>values</code>中相应的值，注意：不能超过9个，9个以上会抛出异常。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">String template = &quot;This is a ^1 of the ^2 broadcast ^3.&quot;;</div><div class="line">                mTextView.setText(template);</div><div class="line"></div><div class="line">                CharSequence expandTemplate = TextUtils.expandTemplate(template, &quot;test&quot;, &quot;emergency&quot;, &quot;system&quot;);</div></pre></td></tr></table></figure>
<h1 id="getCapsMode"><a href="#getCapsMode" class="headerlink" title="getCapsMode"></a>getCapsMode</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static int getCapsMode(CharSequence cs, int off, int reqModes)</div></pre></td></tr></table></figure>
<p>这个方法不知道怎么用，求留言赐教。</p>
<h1 id="getChars"><a href="#getChars" class="headerlink" title="getChars"></a>getChars</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static void getChars(CharSequence s, int start, int end,</div><div class="line">                                char[] dest, int destoff)</div></pre></td></tr></table></figure>
<p>分别各自调用 <code>CharSequence</code>的 <code>getChars</code>实现。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">char[] buffer = new char[5];</div><div class="line">                TextUtils.getChars(mWords1, 2, 4, buffer, 0);</div></pre></td></tr></table></figure>
<h1 id="getLayoutDirectionFromLocale"><a href="#getLayoutDirectionFromLocale" class="headerlink" title="getLayoutDirectionFromLocale"></a>getLayoutDirectionFromLocale</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static int getLayoutDirectionFromLocale(Locale locale)</div></pre></td></tr></table></figure>
<p>根据传入的 <code>local</code>获取当前的阅读习惯（例如，汉语习惯是左到右，希伯来语是右到左），具体可以看这篇文章，<a href="http://droidyue.com/blog/2014/07/07/support-rtl-in-android/index.html" target="_blank" rel="external">http://droidyue.com/blog/2014/07/07/support-rtl-in-android/index.html</a></p>
<h1 id="getOffsetAfter"><a href="#getOffsetAfter" class="headerlink" title="getOffsetAfter"></a>getOffsetAfter</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static int getOffsetAfter(CharSequence text, int offset)</div></pre></td></tr></table></figure>
<p>获取文本之后的偏移量 结合方法里的内容看比较容易,方法里面的<code>Unicode</code>都是我们所谓的非法字符。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mTextView.setText(mWords1);</div><div class="line">mTextView.append(&quot;\n\n&quot;);</div><div class="line">mWords1 = mWords1.replace(&quot;很&quot;, &quot;\uD800&quot;);</div><div class="line">mWords1 = mWords1.replace(&quot;长&quot;, &quot;\uDFFF&quot;);</div><div class="line">mTextView.append(mWords1);</div><div class="line">int offsetAfter = TextUtils.getOffsetAfter(mWords1, 5);</div><div class="line">                mOutputView.setText(String.valueOf(offsetAfter));</div><div class="line">                mOutputView.append(&quot;\n\n&quot;);</div><div class="line">                mOutputView.append(mWords1.substring(offsetAfter));</div></pre></td></tr></table></figure>
<h1 id="getOffsetBefore"><a href="#getOffsetBefore" class="headerlink" title="getOffsetBefore"></a>getOffsetBefore</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static int getOffsetBefore(CharSequence text, int offset)</div></pre></td></tr></table></figure>
<p>获取文本之前的偏移量 结合方法里的内容看比较容易,方法里面的<code>Unicode</code>都是我们所谓的非法字符。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mTextView.setText(mWords1);</div><div class="line">mTextView.append(&quot;\n\n&quot;);</div><div class="line">mWords1 = mWords1.replace(&quot;句&quot;, &quot;\uD800&quot;);</div><div class="line">mWords1 = mWords1.replace(&quot;话&quot;, &quot;\uDFFF&quot;);</div><div class="line">mTextView.setText(mWords1);</div><div class="line">int offsetBefore = TextUtils.getOffsetBefore(mWords1, 5);</div><div class="line">                mOutputView.setText(String.valueOf(offsetBefore));</div><div class="line">mOutputView.append(&quot;\n\n&quot;);</div><div class="line">                mOutputView.append(mWords1.substring(offsetBefore));</div></pre></td></tr></table></figure>
<h1 id="getReverse"><a href="#getReverse" class="headerlink" title="getReverse"></a>getReverse</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static CharSequence getReverse(CharSequence source,</div><div class="line">                                          int start, int end)</div></pre></td></tr></table></figure>
<p>翻转<code>start</code>到<code>end</code>的字符串。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CharSequence reverse = TextUtils.getReverse(mWords1, 0, mWords1.length());</div></pre></td></tr></table></figure>
<h1 id="getTrimmedLength"><a href="#getTrimmedLength" class="headerlink" title="getTrimmedLength"></a>getTrimmedLength</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static int getTrimmedLength(CharSequence s)</div></pre></td></tr></table></figure>
<p>trim 后的字符串长度。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mWords1 = &quot; &quot; + mWords1 + &quot; &quot;;</div><div class="line">mTextView.setText(mWords1);</div><div class="line">mTextView.append(&quot;\n\n&quot;);</div><div class="line">                mTextView.append(String.valueOf(mWords1.length()));</div><div class="line">int trimmedLength = TextUtils.getTrimmedLength(mWords1);</div><div class="line">                mOutputView.setText(String.valueOf(trimmedLength));</div></pre></td></tr></table></figure>
<h1 id="htmlEncode"><a href="#htmlEncode" class="headerlink" title="htmlEncode"></a>htmlEncode</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static String htmlEncode(String s)</div></pre></td></tr></table></figure>
<p>encode html ，注意是 html 。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String code = &quot;&lt;h1&gt;html&lt;/h1&gt; &quot; + mWords1;</div><div class="line">                mTextView.setText(code);</div><div class="line">                mOutputView.setText(TextUtils.htmlEncode(code));</div></pre></td></tr></table></figure>
<h1 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf"></a>indexOf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static int indexOf(CharSequence s, CharSequence needle,</div><div class="line">                              int start, int end)</div></pre></td></tr></table></figure>
<p>获取<code>needle</code>字符的 index。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">int indexOf = TextUtils.indexOf(mWords1, &quot;不要的&quot;, 0, mWords1.length());</div><div class="line">                mOutputView.setText(String.valueOf(indexOf));</div><div class="line">                mOutputView.append(mWords1.substring(indexOf));</div></pre></td></tr></table></figure>
<h1 id="isDigitsOnly"><a href="#isDigitsOnly" class="headerlink" title="isDigitsOnly"></a>isDigitsOnly</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static boolean isDigitsOnly(CharSequence str)</div></pre></td></tr></table></figure>
<p>判断是否仅有数字。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">mTextView.setText(mWords1);</div><div class="line">String digits = &quot;1234&quot;;</div><div class="line">mTextView.append(&quot;\n\n&quot;);</div><div class="line">mTextView.append(digits);</div><div class="line">String digits1 = &quot;123w123&quot;;</div><div class="line">mTextView.append(&quot;\n\n&quot;);</div><div class="line">mTextView.append(digits1);</div><div class="line">boolean digitsOnly = TextUtils.isDigitsOnly(mWords1);</div><div class="line">boolean digitsOnly1 = TextUtils.isDigitsOnly(digits);</div><div class="line">boolean digitsOnly2 = TextUtils.isDigitsOnly(digits1);</div><div class="line">                mOutputView.setText(String.valueOf(digitsOnly));</div><div class="line">mOutputView.append(&quot;\n\n&quot;);</div><div class="line">                mOutputView.append(String.valueOf(digitsOnly1));</div><div class="line">mOutputView.append(&quot;\n\n&quot;);</div><div class="line">                mOutputView.append(String.valueOf(digitsOnly2));</div></pre></td></tr></table></figure>
<h1 id="isEmpty"><a href="#isEmpty" class="headerlink" title="isEmpty"></a>isEmpty</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static boolean isEmpty(CharSequence str)</div></pre></td></tr></table></figure>
<p>判空，这个太常用了。</p>
<h1 id="isGraphic"><a href="#isGraphic" class="headerlink" title="isGraphic"></a>isGraphic</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static boolean isGraphic(CharSequence str)</div></pre></td></tr></table></figure>
<p>判断是否有可以显示出来的字符。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String graphic = &quot;\n \t \b&quot;;</div><div class="line">mTextView.setText(graphic);</div><div class="line">            mOutputView.setText(String.valueOf(TextUtils.isGraphic(graphic)));</div></pre></td></tr></table></figure>
<h1 id="join"><a href="#join" class="headerlink" title="join"></a>join</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static String join(CharSequence delimiter, Iterable tokens)</div></pre></td></tr></table></figure>
<p>连接数组，例如：a b c d 输出 a-b-c-d，这个方法的重载支持了很多类型。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line">list.add(&quot;a&quot;);</div><div class="line">list.add(&quot;b&quot;);</div><div class="line">list.add(&quot;c&quot;);</div><div class="line">list.add(&quot;d&quot;);</div><div class="line">mTextView.setText(list.toString());</div><div class="line">mOutputView.setText(TextUtils.join(&quot;-&quot;, list));</div></pre></td></tr></table></figure>
<h1 id="lastIndexOf"><a href="#lastIndexOf" class="headerlink" title="lastIndexOf"></a>lastIndexOf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static int lastIndexOf(CharSequence s, char ch)</div></pre></td></tr></table></figure>
<p>字符<code>ch</code>最后一次出现的<code>index</code>。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mTextView.setText(mWords1);</div><div class="line">int c = TextUtils.lastIndexOf(mWords1, &apos;c&apos;);               mOutputView.setText(String.valueOf(c));</div><div class="line">mOutputView.append(&quot;\n\n&quot;);                mOutputView.append(mWords1.substring(c));</div></pre></td></tr></table></figure>
<h1 id="regionMatches"><a href="#regionMatches" class="headerlink" title="regionMatches"></a>regionMatches</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public static boolean regionMatches(CharSequence one, int toffset,</div><div class="line">                                        CharSequence two, int ooffset,</div><div class="line">                                        int len) &#123;</div></pre></td></tr></table></figure>
<p>比对两个字符串 <code>offset</code>到 <code>len</code> 的长度的字符串是否相同。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mOutputView.setText(TextUtils.replace(mWords1,new String[]&#123;&quot;很长&quot;,&quot;的&quot;,&quot;.&quot;&#125;,new String[]&#123;&quot;very long&quot;,&quot;of&quot;,&quot;。&quot;&#125;));</div></pre></td></tr></table></figure>
<h1 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public static CharSequence replace(CharSequence template,</div><div class="line">                                       String[] sources,</div><div class="line">                                       CharSequence[] destinations)</div></pre></td></tr></table></figure>
<p>替换功能，注意：只会替换第一个出现的。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mOutputView.setText(TextUtils.replace(mWords1,new String[]&#123;&quot;很长&quot;,&quot;的&quot;,&quot;.&quot;&#125;,new String[]&#123;&quot;very long&quot;,&quot;of&quot;,&quot;。&quot;&#125;));</div></pre></td></tr></table></figure>
<h1 id="split"><a href="#split" class="headerlink" title="split"></a>split</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static String[] split(String text, String expression)</div></pre></td></tr></table></figure>
<p>分割字符串。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mOutputView.setText(TextUtils.join(&quot;--&quot;,TextUtils.split(mWords2,&quot;,&quot;)));</div></pre></td></tr></table></figure>
<h1 id="stringOrSpannedString"><a href="#stringOrSpannedString" class="headerlink" title="stringOrSpannedString"></a>stringOrSpannedString</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static CharSequence stringOrSpannedString(CharSequence source)</div></pre></td></tr></table></figure>
<p>如果是 <code>String</code> 返回 <code>String</code> ，<code>spannedString</code> 或 <code>spanned</code> 返回 <code>spannedString</code>。</p>
<p>例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mOutputView.setText(TextUtils.stringOrSpannedString(mSpanny1));</div></pre></td></tr></table></figure>
<h1 id="substring"><a href="#substring" class="headerlink" title="substring"></a>substring</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static String substring(CharSequence source, int start, int end)</div></pre></td></tr></table></figure>
<p>分割字符串。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mOutputView.setText(TextUtils.substring(mSpanny1,2,16));</div></pre></td></tr></table></figure>
<h1 id="writeToParcel"><a href="#writeToParcel" class="headerlink" title="writeToParcel"></a>writeToParcel</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static void writeToParcel(CharSequence cs, Parcel p,</div><div class="line">            int parcelableFlags)</div></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mTextView.setText(&quot;一般用作序列化 CharSequence 子类&quot;);</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;把一个&lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt;输出成&lt;code&gt;a,b,c&lt;/code&gt;这种形式，我们项目里面提供了一个这样的工具类：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
      <category term="Utils" scheme="http://www.kennethyo.me/tags/Utils/"/>
    
      <category term="TextView" scheme="http://www.kennethyo.me/tags/TextView/"/>
    
      <category term="EditText" scheme="http://www.kennethyo.me/tags/EditText/"/>
    
      <category term="TextUtils" scheme="http://www.kennethyo.me/tags/TextUtils/"/>
    
  </entry>
  
  <entry>
    <title>Mac 下反编译 apk</title>
    <link href="http://www.kennethyo.me/2016/06/21/2016-06-21/"/>
    <id>http://www.kennethyo.me/2016/06/21/2016-06-21/</id>
    <published>2016-06-21T03:34:24.000Z</published>
    <updated>2016-09-01T06:36:58.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1，环境准备"><a href="#1，环境准备" class="headerlink" title="1，环境准备"></a>1，环境准备</h1><p><code>brew install apktool</code><br><code>brew install dex2jar</code><br><code>jd-gui</code></p>
<h1 id="2，反编译-代码"><a href="#2，反编译-代码" class="headerlink" title="2，反编译 代码"></a>2，反编译 代码</h1><p>解压 apk 拿到 dex 文件<br>执行 <code>d2j-dex2jar classes.dex</code> 获取到 jar 文件，拖进 jd-gui 就可以了</p>
<h1 id="3，反编译资源文件"><a href="#3，反编译资源文件" class="headerlink" title="3，反编译资源文件"></a>3，反编译资源文件</h1><p>执行 <code>apktool  d *.apk</code><br>-f  如果目标文件存在，删除存在<br>-o 指定目标文件夹名字<br>-s 不反编译 dex 文件<br>-r 不反编译资源文件</p>
<h1 id="4，重新打包"><a href="#4，重新打包" class="headerlink" title="4，重新打包"></a>4，重新打包</h1><p><code>apktool b *.apk -o new.apk</code></p>
<h1 id="5，签名-需要-java-环境变量"><a href="#5，签名-需要-java-环境变量" class="headerlink" title="5，签名(需要 java 环境变量)"></a>5，签名(需要 java 环境变量)</h1><p><code>jarsigner  -verbose   -sigalg SHA1withRSA -digestalg SHA1 -keystore 签名文件 -storepass 签名密码 待签名 apk 签名的别名</code></p>
<h1 id="6，对齐操作（程序运行的更快）"><a href="#6，对齐操作（程序运行的更快）" class="headerlink" title="6，对齐操作（程序运行的更快）"></a>6，对齐操作（程序运行的更快）</h1><p><code>zipalign 4 *.apk *_aligned.apk</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1，环境准备&quot;&gt;&lt;a href=&quot;#1，环境准备&quot; class=&quot;headerlink&quot; title=&quot;1，环境准备&quot;&gt;&lt;/a&gt;1，环境准备&lt;/h1&gt;&lt;p&gt;&lt;code&gt;brew install apktool&lt;/code&gt;&lt;br&gt;&lt;code&gt;brew instal
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
      <category term="反编译" scheme="http://www.kennethyo.me/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    
      <category term="brew" scheme="http://www.kennethyo.me/tags/brew/"/>
    
  </entry>
  
  <entry>
    <title>CURL常用指令</title>
    <link href="http://www.kennethyo.me/2016/06/17/2016-06-17/"/>
    <id>http://www.kennethyo.me/2016/06/17/2016-06-17/</id>
    <published>2016-06-17T03:48:12.000Z</published>
    <updated>2016-09-01T06:37:11.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一，查看网页源代码"><a href="#一，查看网页源代码" class="headerlink" title="一，查看网页源代码"></a>一，查看网页源代码</h1><p><code>curl www.bitauto.com</code><br>保存网页<br><code>curl -o demo.txt www.bitauto.com</code></p>
<h1 id="二，自动跳转"><a href="#二，自动跳转" class="headerlink" title="二，自动跳转"></a>二，自动跳转</h1><p><code>curl -L www.bitauto.com</code></p>
<h1 id="三，显示头信息"><a href="#三，显示头信息" class="headerlink" title="三，显示头信息"></a>三，显示头信息</h1><p><code>curl -i www.bitauto.com</code></p>
<h1 id="四，显示通信过程"><a href="#四，显示通信过程" class="headerlink" title="四，显示通信过程"></a>四，显示通信过程</h1><p><code>curl -v www.bitauto.com</code><br>更多详细信息<br><code>curl --trace demo.txt www.bitauto.com</code><br><code>curl --trace--ascii demo.txt www.bitauto.com</code></p>
<h1 id="五，发送表单信息"><a href="#五，发送表单信息" class="headerlink" title="五，发送表单信息"></a>五，发送表单信息</h1><p>GET<br><code>curl www.bitauto.com/?data=xxx</code><br>POST<br><code>curl -X POST --data &quot;data=xxx&quot; www.bitauto.com</code><br><code>curl -X POST --data-urlencode &quot;data=hello world&quot; www.bitauto.com</code><br>DELETE<br><code>curl -X DELETE www.bitauto.com</code></p>
<h1 id="六，上传文件"><a href="#六，上传文件" class="headerlink" title="六，上传文件"></a>六，上传文件</h1><p><code>curl --form uplaod=@demo.txt --form press=OK www.bitauto.com</code></p>
<h1 id="七，Referer-字段"><a href="#七，Referer-字段" class="headerlink" title="七，Referer 字段"></a>七，Referer 字段</h1><p><code>curl --referer www.bitauto.com www.bitauto.com</code></p>
<h1 id="九，User-Agent-字段"><a href="#九，User-Agent-字段" class="headerlink" title="九，User Agent 字段"></a>九，User Agent 字段</h1><p><code>curl --user-agent &quot;user-agent&quot; www.bitauto.com</code></p>
<h1 id="十，Cookie"><a href="#十，Cookie" class="headerlink" title="十，Cookie"></a>十，Cookie</h1><p><code>curl --cookie  &quot;name=demo&quot; www.bitauto.com</code><br>保存 cookie 到文件夹<br><code>curl -c filename www.bitauto.com</code><br>使用文件的 cookie<br><code>curl -b filename www.bitauto.com</code></p>
<h1 id="十一，增加头信息"><a href="#十一，增加头信息" class="headerlink" title="十一，增加头信息"></a>十一，增加头信息</h1><p><code>curl --header &quot;Content-Type:application/json&quot; www.bitauto.com</code></p>
<h1 id="十二，HTTP-认证"><a href="#十二，HTTP-认证" class="headerlink" title="十二，HTTP 认证"></a>十二，HTTP 认证</h1><p><code>curl --user name:password www.bitauto.com</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一，查看网页源代码&quot;&gt;&lt;a href=&quot;#一，查看网页源代码&quot; class=&quot;headerlink&quot; title=&quot;一，查看网页源代码&quot;&gt;&lt;/a&gt;一，查看网页源代码&lt;/h1&gt;&lt;p&gt;&lt;code&gt;curl www.bitauto.com&lt;/code&gt;&lt;br&gt;保存网页&lt;
    
    </summary>
    
      <category term="Web" scheme="http://www.kennethyo.me/categories/Web/"/>
    
    
      <category term="Web" scheme="http://www.kennethyo.me/tags/Web/"/>
    
      <category term="CURL" scheme="http://www.kennethyo.me/tags/CURL/"/>
    
  </entry>
  
  <entry>
    <title>[原]React-Native Android 学习笔记——2，自定义 logger</title>
    <link href="http://www.kennethyo.me/2016/03/23/2016-03-23/"/>
    <id>http://www.kennethyo.me/2016/03/23/2016-03-23/</id>
    <published>2016-03-23T08:35:48.000Z</published>
    <updated>2016-09-01T06:37:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>通过上一篇<a href="http://blog.csdn.net/kennethyo/article/details/50923909" target="_blank" rel="external">《 React-Native Android 学习笔记——1，配置环境》</a>下载了AwesomeProject项目并运行了 demo。如下图：<br><img src="http://img.blog.csdn.net/20160322185844293" alt="这里写图片描述"><br>应该和你运行起来的相同，但是除了<code>Welcome to React Native</code>的颜色。</p>
<h2 id="一，index-android-js-文件"><a href="#一，index-android-js-文件" class="headerlink" title="一，index.android.js 文件"></a>一，index.android.js 文件</h2><p>demo 默认展示在我们面前的这个页面其实是我们下载<code>AwesomeProject</code>项目下的<code>index.android.js</code>，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Sample React Native App</span></div><div class="line"><span class="comment"> * https://github.com/facebook/react-native</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"><span class="keyword">import</span> React, &#123;</div><div class="line">  AppRegistry,</div><div class="line">  Component,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AwesomeProject</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</div><div class="line">          Welcome to React Native!</div><div class="line">        &lt;<span class="regexp">/Text&gt;</span></div><div class="line"><span class="regexp">        &lt;Text style=&#123;styles.instructions&#125;&gt;</span></div><div class="line"><span class="regexp">          To get started, edit index.android.js</span></div><div class="line"><span class="regexp">        &lt;/</span>Text&gt;</div><div class="line">        &lt;Text style=&#123;styles.instructions&#125;&gt;</div><div class="line">          Shake or press menu button <span class="keyword">for</span> dev menu</div><div class="line">        &lt;<span class="regexp">/Text&gt;</span></div><div class="line"><span class="regexp">      &lt;/</span>View&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</div><div class="line">  container: &#123;</div><div class="line">    flex: <span class="number">1</span>,</div><div class="line">    justifyContent: <span class="string">'center'</span>,</div><div class="line">    alignItems: <span class="string">'center'</span>,</div><div class="line">    backgroundColor: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line">  welcome: &#123;</div><div class="line">    fontSize: <span class="number">20</span>,</div><div class="line">    textAlign: <span class="string">'center'</span>,</div><div class="line">    margin: <span class="number">10</span>,</div><div class="line">    color:<span class="string">'red'</span></div><div class="line">  &#125;,</div><div class="line">  instructions: &#123;</div><div class="line">    textAlign: <span class="string">'center'</span>,</div><div class="line">    color: <span class="string">'#333333'</span>,</div><div class="line">    marginBottom: <span class="number">5</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line">AppRegistry.registerComponent(<span class="string">'AwesomeProject'</span>, () =&gt; AwesomeProject);</div></pre></td></tr></table></figure></p>
<p>可以看到我在 welcome 的 style 中设置了<code>color:&#39;red&#39;</code>，让我的<code>Welcome to React Native</code>变成红色字体的。如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">welcome: &#123;</div><div class="line">  fontSize: <span class="number">20</span>,</div><div class="line">  textAlign: <span class="string">'center'</span>,</div><div class="line">  margin: <span class="number">10</span>,</div><div class="line">  color:<span class="string">'red'</span></div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p>下面我们来熟悉一下<code>index.android.js</code>这个文件里面的 js 代码都是干什么的。</p>
<p><code>&#39;use strict&#39;</code>是启动当前文件的 js 代码的严格模式，可以使当前的 js 更严格的条件下运行。想了解的可以学习这篇文章<a href="http://www.ruanyifeng.com/blog/2013/01/javascript_strict_mode.html" target="_blank" rel="external">《Javascript 严格模式详解》</a>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123;</div><div class="line">  AppRegistry,</div><div class="line">  Component,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div></pre></td></tr></table></figure></p>
<p>这段代码类似 java 的 import，把需要引用的 module 引入。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AwesomeProject</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</div><div class="line">          Welcome to React Native!</div><div class="line">        &lt;<span class="regexp">/Text&gt;</span></div><div class="line"><span class="regexp">        &lt;Text style=&#123;styles.instructions&#125;&gt;</span></div><div class="line"><span class="regexp">          To get started, edit index.android.js</span></div><div class="line"><span class="regexp">        &lt;/</span>Text&gt;</div><div class="line">        &lt;Text style=&#123;styles.instructions&#125;&gt;</div><div class="line">          Shake or press menu button <span class="keyword">for</span> dev menu</div><div class="line">        &lt;<span class="regexp">/Text&gt;</span></div><div class="line"><span class="regexp">      &lt;/</span>View&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这段代码是渲染当前注册界面的布局，<code>render</code>方法下的return 就是返回的当前布局。标签内的 style 对应下面这段代码，和 css 很像，等于 Android layout 文件下 view 的标签设置属性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</div><div class="line">  container: &#123;</div><div class="line">    flex: <span class="number">1</span>,</div><div class="line">    justifyContent: <span class="string">'center'</span>,</div><div class="line">    alignItems: <span class="string">'center'</span>,</div><div class="line">    backgroundColor: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line">  welcome: &#123;</div><div class="line">    fontSize: <span class="number">20</span>,</div><div class="line">    textAlign: <span class="string">'center'</span>,</div><div class="line">    margin: <span class="number">10</span>,</div><div class="line">    color:<span class="string">'red'</span></div><div class="line">  &#125;,</div><div class="line">  instructions: &#123;</div><div class="line">    textAlign: <span class="string">'center'</span>,</div><div class="line">    color: <span class="string">'#333333'</span>,</div><div class="line">    marginBottom: <span class="number">5</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>标签的具体规范可以看这里<a href="http://facebook.github.io/react-native/docs/text.html#content" target="_blank" rel="external">Text</a>，<a href="http://facebook.github.io/react-native/docs/view.html#content" target="_blank" rel="external">View</a>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AppRegistry.registerComponent(<span class="string">'AwesomeProject'</span>, () =&gt; AwesomeProject);</div></pre></td></tr></table></figure></p>
<p>上面这段代码把我们 js 文件中的 class <code>AwesomeProject</code>和我们 Android 项目中 <code>Activity</code>中<code>getMainComponentName() { return &quot;AwesomeProject&quot;; }</code>的 Activity关联起来。</p>
<h2 id="二，显示一个-Toast"><a href="#二，显示一个-Toast" class="headerlink" title="二，显示一个 Toast"></a>二，显示一个 Toast</h2><p>React-Native 已经把我们常用的模块都已经封装好了，例如 Toast 在<code>../AwesomeProject/node_modules/react-native/Libraries/Components/ToastAndroid/ToastAndroid.android.js</code>中。<br>我们来看 ToastAndroid 的源码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Copyright (c) 2015-present, Facebook, Inc.</span></div><div class="line"><span class="comment"> * All rights reserved.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This source code is licensed under the BSD-style license found in the</span></div><div class="line"><span class="comment"> * LICENSE file in the root directory of this source tree. An additional grant</span></div><div class="line"><span class="comment"> * of patent rights can be found in the PATENTS file in the same directory.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @providesModule ToastAndroid</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> RCTToastAndroid = <span class="built_in">require</span>(<span class="string">'NativeModules'</span>).ToastAndroid;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * This exposes the native ToastAndroid module as a JS module. This has a function 'show'</span></div><div class="line"><span class="comment"> * which takes the following parameters:</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * 1. String message: A string with the text to toast</span></div><div class="line"><span class="comment"> * 2. int duration: The duration of the toast. May be ToastAndroid.SHORT or ToastAndroid.LONG</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> ToastAndroid = &#123;</div><div class="line"></div><div class="line">  SHORT: RCTToastAndroid.SHORT,</div><div class="line">  LONG: RCTToastAndroid.LONG,</div><div class="line"></div><div class="line">  show: <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></div><div class="line"><span class="function"><span class="params">    message: string,</span></span></div><div class="line"><span class="function"><span class="params">    duration: number</span></span></div><div class="line"><span class="function"><span class="params">  </span>): <span class="title">void</span> </span>&#123;</div><div class="line">    RCTToastAndroid.show(message, duration);</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = ToastAndroid;</div></pre></td></tr></table></figure></p>
<p>我们可以直接在引包当中加入ToastAndroid。如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123;</div><div class="line">  AppRegistry,</div><div class="line">  Component,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  ToastAndroid,</div><div class="line">  View,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div></pre></td></tr></table></figure></p>
<p>下面我们来用 ToastAndroid 弹出一个 Toast。在引包后加入代码<code>ToastAndroid.show(&#39;Awesome&#39;, ToastAndroid.SHORT);</code>，下面来摇摆手机调出开发菜单，点击<code>Reload JS</code>。就会弹出Toast。<br>我们来分析一下<code>ToastAndroid.android.js</code>这个 module。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> RCTToastAndroid = <span class="built_in">require</span>(<span class="string">'NativeModules'</span>).ToastAndroid;</div></pre></td></tr></table></figure></p>
<p>这里是<code>require</code>是加载<code>NativeModules</code>模块，并把 <code>ToastAndroid</code> 赋值给 <code>RCTToastAndroid</code>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ToastAndroid = &#123;</div><div class="line"></div><div class="line">  SHORT: RCTToastAndroid.SHORT,</div><div class="line">  LONG: RCTToastAndroid.LONG,</div><div class="line"></div><div class="line">  show: <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></div><div class="line"><span class="function"><span class="params">    message: string,</span></span></div><div class="line"><span class="function"><span class="params">    duration: number</span></span></div><div class="line"><span class="function"><span class="params">  </span>): <span class="title">void</span> </span>&#123;</div><div class="line">    RCTToastAndroid.show(message, duration);</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>这段代码，创建一个对象赋值给<code>ToastAndroid</code>，对象内分别设置了<code>Toast</code>的 <code>SHORT</code>，<code>LONG</code>和<code>show</code>方法。<br><code>module.exports = ToastAndroid;</code>这里把<code>ToastAndroid</code>作为当前这个 Module 导出，提供给外部使用。<br>那么 JS 是如何 Android 代码关联起来的呢？下面我们来看一下Native 的代码。在 Android Studio 中搜索类 <code>ToastModule</code>，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToastModule</span> <span class="keyword">extends</span> <span class="title">ReactContextBaseJavaModule</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DURATION_SHORT_KEY = <span class="string">"SHORT"</span>;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DURATION_LONG_KEY = <span class="string">"LONG"</span>;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ToastModule</span><span class="params">(ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(reactContext);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"ToastAndroid"</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getConstants</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Map&lt;String, Object&gt; constants = MapBuilder.newHashMap();</div><div class="line">    constants.put(DURATION_SHORT_KEY, Toast.LENGTH_SHORT);</div><div class="line">    constants.put(DURATION_LONG_KEY, Toast.LENGTH_LONG);</div><div class="line">    <span class="keyword">return</span> constants;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@ReactMethod</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String message, <span class="keyword">int</span> duration)</span> </span>&#123;</div><div class="line">    Toast.makeText(getReactApplicationContext(), message, duration).show();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里<code>getName()</code>方法的返回值对应 JS 中的<code>var RCTToastAndroid = require(&#39;NativeModules&#39;).ToastAndroid;</code>结尾处的<code>ToastAndroid</code>，正如 js 里的请求手机本地的 modules ，对应到类里的<code>getName()</code>返回值。<br><code>getConstants()</code>方法负责把类中的常量映射到 JS 中去。<br><code>show(String message, int duration)</code>方法正是我们要提供给 JS 的方法，方法的注释代表这个方法提供给 JS 调用。</p>
<h2 id="三，自定义-Logger"><a href="#三，自定义-Logger" class="headerlink" title="三，自定义 Logger"></a>三，自定义 Logger</h2><p>这里我们来自定义一个 LoggerModule 来练练手。这里我先把代码贴出来了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggerModule</span> <span class="keyword">extends</span> <span class="title">ReactContextBaseJavaModule</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MODULE_NAME = <span class="string">"Logger"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG_KEY = <span class="string">"TAG"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG_VALUE = <span class="string">"LoggerModule"</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoggerModule</span><span class="params">(ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(reactContext);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getConstants</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> Map&lt;String, Object&gt; constants = MapBuilder.newHashMap();</div><div class="line">        constants.put(TAG_KEY, TAG_VALUE);</div><div class="line">        <span class="keyword">return</span> constants;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> MODULE_NAME;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@ReactMethod</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">        Log.i(tag, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@ReactMethod</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">        Log.d(tag, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@ReactMethod</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">        Log.w(tag, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@ReactMethod</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">        Log.e(tag, msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里我把常量<code>TAG</code>返回给 JS 调用，Module 命名为<code>Logger</code>，并且把 info，debug，warn，error 等 Log 方法加上<code>@ReactMethod</code>注释，提供给 JS调用。<br>这里还没有结束，我们还需要实现一个类，去注册我们自己写的 <code>LoggerModule</code>。具体代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppReactPackage</span> <span class="keyword">implements</span> <span class="title">ReactPackage</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;NativeModule&gt; <span class="title">createNativeModules</span><span class="params">(ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">        List&lt;NativeModule&gt; modules = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        modules.add(<span class="keyword">new</span> LoggerModule(reactContext));</div><div class="line">        <span class="keyword">return</span> modules;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Class&lt;? extends JavaScriptModule&gt;&gt; createJSModules() &#123;</div><div class="line">        <span class="keyword">return</span> Collections.emptyList();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;ViewManager&gt; <span class="title">createViewManagers</span><span class="params">(ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Collections.emptyList();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后，把这个 AppReactPackage 注册到 Activity。如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ReactActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Returns the name of the main component registered from JavaScript.</span></div><div class="line"><span class="comment">     * This is used to schedule rendering of the component.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getMainComponentName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"AwesomeProject"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Returns whether dev mode should be enabled.</span></div><div class="line"><span class="comment">     * This enables e.g. the dev menu.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">getUseDeveloperSupport</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> BuildConfig.DEBUG;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * A list of packages used by the app. If the app uses additional views</span></div><div class="line"><span class="comment">     * or modules besides the default ones, add more packages here.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> List&lt;ReactPackage&gt; <span class="title">getPackages</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Arrays.&lt;ReactPackage&gt;asList(</div><div class="line">                <span class="keyword">new</span> MainReactPackage(),</div><div class="line">                <span class="keyword">new</span> AppReactPackage()</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>java 代码到这里就结束了。<br>下面，我们在<code>index.android.js</code>的同级目录创建一个 js 文件<code>log.js</code>。里面内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"><span class="keyword">var</span> RCTLogger = <span class="built_in">require</span>(<span class="string">'NativeModules'</span>).Logger;<span class="comment">//加载本地 modules，Module#getName()</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> LogAndroid = &#123;</div><div class="line">  <span class="comment">//添加定义的常量 Module#getConstants()</span></div><div class="line">  TAG: RCTLogger.TAG,</div><div class="line">  <span class="comment">//添加的方法 Module#d()</span></div><div class="line">  d: <span class="function"><span class="keyword">function</span>(<span class="params">tag: string,msg: string</span>):<span class="title">void</span></span>&#123;</div><div class="line">    RCTLogger.d(tag,msg);</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  i: <span class="function"><span class="keyword">function</span>(<span class="params">tag: string,msg: string</span>):<span class="title">void</span></span>&#123;</div><div class="line">    RCTLogger.i(tag,msg);</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  w: <span class="function"><span class="keyword">function</span>(<span class="params">tag: string,msg: string</span>):<span class="title">void</span></span>&#123;</div><div class="line">    RCTLogger.w(tag,msg);</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  e: <span class="function"><span class="keyword">function</span>(<span class="params">tag: string,msg: string</span>):<span class="title">void</span></span>&#123;</div><div class="line">    RCTLogger.e(tag,msg);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = LogAndroid;<span class="comment">//module 导出</span></div></pre></td></tr></table></figure></p>
<p>这里不用多说了，无非就是创建一个 LogAndroid 对象获取 <code>LoggerModule</code>java 类中的常量，方法等，并且导出。<br>下面我贴出完整的<code>index.android.js</code>，里面显示如何引用：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Sample React Native App</span></div><div class="line"><span class="comment"> * https://github.com/facebook/react-native</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"><span class="keyword">import</span> React, &#123;</div><div class="line">  AppRegistry,</div><div class="line">  Component,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  ToastAndroid,</div><div class="line">  View,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div><div class="line"><span class="keyword">var</span> LogAndroid = <span class="built_in">require</span>(<span class="string">'./log'</span>);</div><div class="line"></div><div class="line">LogAndroid.i(LogAndroid.TAG,<span class="string">"Awesome"</span>);</div><div class="line">LogAndroid.d(LogAndroid.TAG,<span class="string">"Awesome"</span>);</div><div class="line">LogAndroid.w(LogAndroid.TAG,<span class="string">"Awesome"</span>);</div><div class="line">LogAndroid.e(LogAndroid.TAG,<span class="string">"Awesome"</span>);</div><div class="line"></div><div class="line">ToastAndroid.show(<span class="string">'Awesome'</span>, ToastAndroid.SHORT);</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AwesomeProject</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</div><div class="line">          Welcome to React Native!</div><div class="line">        &lt;<span class="regexp">/Text&gt;</span></div><div class="line"><span class="regexp">        &lt;Text style=&#123;styles.instructions&#125;&gt;</span></div><div class="line"><span class="regexp">          To get started, edit index.android.js</span></div><div class="line"><span class="regexp">        &lt;/</span>Text&gt;</div><div class="line">        &lt;Text style=&#123;styles.instructions&#125;&gt;</div><div class="line">          Shake or press menu button <span class="keyword">for</span> dev menu</div><div class="line">        &lt;<span class="regexp">/Text&gt;</span></div><div class="line"><span class="regexp">      &lt;/</span>View&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</div><div class="line">  container: &#123;</div><div class="line">    flex: <span class="number">1</span>,</div><div class="line">    justifyContent: <span class="string">'center'</span>,</div><div class="line">    alignItems: <span class="string">'center'</span>,</div><div class="line">    backgroundColor: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line">  welcome: &#123;</div><div class="line">    fontSize: <span class="number">20</span>,</div><div class="line">    textAlign: <span class="string">'center'</span>,</div><div class="line">    margin: <span class="number">10</span>,</div><div class="line">    color:<span class="string">'red'</span></div><div class="line">  &#125;,</div><div class="line">  instructions: &#123;</div><div class="line">    textAlign: <span class="string">'center'</span>,</div><div class="line">    color: <span class="string">'#333333'</span>,</div><div class="line">    marginBottom: <span class="number">5</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line">AppRegistry.registerComponent(<span class="string">'AwesomeProject'</span>, () =&gt; AwesomeProject);</div></pre></td></tr></table></figure></p>
<p>重新编译并运行你的 app，看看 logcat 打印出了日志吗？</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;通过上一篇&lt;a href=&quot;http://blog.csdn.net/kennethyo/article/details/50923909&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;《 React-Native Android 学习笔记——1，配置环境
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
      <category term="React-Native" scheme="http://www.kennethyo.me/tags/React-Native/"/>
    
  </entry>
  
  <entry>
    <title>[原]React-Native Android 学习笔记——1，配置环境</title>
    <link href="http://www.kennethyo.me/2016/03/18/2016-03-18/"/>
    <id>http://www.kennethyo.me/2016/03/18/2016-03-18/</id>
    <published>2016-03-18T07:30:43.000Z</published>
    <updated>2016-09-01T06:37:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一，设备与环境"><a href="#一，设备与环境" class="headerlink" title="一，设备与环境"></a>一，设备与环境</h2><h3 id="1，一台-mac"><a href="#1，一台-mac" class="headerlink" title="1，一台 mac"></a>1，一台 mac</h3><h3 id="2，安装软件包管理器-Homebrew-中文"><a href="#2，安装软件包管理器-Homebrew-中文" class="headerlink" title="2，安装软件包管理器 Homebrew(中文)"></a>2，安装软件包管理器 <a href="http://brew.sh/index_zh-cn.html" target="_blank" rel="external">Homebrew(中文)</a></h3><p>终端里输入<code>/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code>进行安装。</p>
<h3 id="3，安装-wget-或者-curl"><a href="#3，安装-wget-或者-curl" class="headerlink" title="3，安装 wget 或者 curl"></a>3，安装 <a href="https://zh.wikipedia.org/wiki/Wget" target="_blank" rel="external">wget</a> 或者 <a href="https://zh.wikipedia.org/wiki/CURL" target="_blank" rel="external">curl</a></h3><p>wget，终端里输入<code>brew install wget</code>进行安装。<br>curl，终端里输入<code>brew install curl</code>进行安装。</p>
<h3 id="4，安装-nvm-node版本管理器"><a href="#4，安装-nvm-node版本管理器" class="headerlink" title="4，安装 nvm (node版本管理器)"></a>4，安装 <a href="https://github.com/creationix/nvm#installation" target="_blank" rel="external">nvm</a> (node版本管理器)</h3><p>如果安装了 wget，终端输入<code>wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.31.0/install.sh | bash</code>进行安装 nvm。</p>
<p>如果安装了 curl，终端输入<code>curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.0/install.sh | bashÂ</code>进行安装 nvm。</p>
<h3 id="5，Android-SDK"><a href="#5，Android-SDK" class="headerlink" title="5，Android SDK"></a>5，Android SDK</h3><p>这个不用多说了，相信大家都会的。顺便把 Android SDK 配置到环境变量。</p>
<p>如果你没有 Android SDK，也可以通过终端输入<code>brew install android-sdk</code>。</p>
<h2 id="二，安装和初始react-native-demo"><a href="#二，安装和初始react-native-demo" class="headerlink" title="二，安装和初始react-native demo"></a>二，安装和初始react-native demo</h2><p>终端输入<code>npm install -g react-native-cli</code>安装 react-native。</p>
<p>如果显示<code>EACCES: permission denied</code>，用超级权限再次执行一下上面的指令。反正我是没遇到。</p>
<p>进入到你要创建 demo 的目录，终端输入<code>cd 你得文件路径</code>.<br>终端输入<code>react-native init AwesomeProject</code>，初始 AwesomeProject 。</p>
<p>终端输入<code>cd AwesomeProject</code>。</p>
<p>终端输入<code>react-native run-android</code>可以直接运行 node 服务并编译运行 Android 项目，直至安装到手机。</p>
<p>如果界面报错提示如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Unable to download JS bundle</div><div class="line">com.facebook.react.devsupport.DebugServerException: Could not connect to development server.</div><div class="line"></div><div class="line">URL: http://localhost:8081/index.android.bundle?platform=android&amp;dev=true&amp;hot=false</div><div class="line"></div><div class="line">Try the following to fix the issue:</div><div class="line">• Ensure that the packager server is running</div><div class="line">• Ensure that your device/emulator is connected to your machine and has USB debugging enabled - run &apos;adb devices&apos; to see a list of connected devices</div><div class="line">• If you&apos;re on a physical device connected to the same machine, run &apos;adb reverse tcp:8081 tcp:8081&apos; to forward requests from your device</div><div class="line">• If your device is on the same Wi-Fi network, set &apos;Debug server host &amp; port for device&apos; in &apos;Dev settings&apos; to your machine&apos;s IP address and the port of the local dev server - e.g. 10.0.1.1:8081</div><div class="line">at com.facebook.react.devsupport.DevServerHelper$1.onFailure(DevServerHelper.java:203)</div><div class="line">at com.squareup.okhttp.Call$AsyncCall.execute(Call.java:175)</div><div class="line">at com.squareup.okhttp.internal.NamedRunnable.run(NamedRunnable.java:33)</div><div class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1113)</div><div class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:588)</div><div class="line">at java.lang.Thread.run(Thread.java:818)</div></pre></td></tr></table></figure></p>
<p>一般在终端输入<code>adb reverse tcp:8081 tcp:8081</code>即可解决，其他请详细看 log。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一，设备与环境&quot;&gt;&lt;a href=&quot;#一，设备与环境&quot; class=&quot;headerlink&quot; title=&quot;一，设备与环境&quot;&gt;&lt;/a&gt;一，设备与环境&lt;/h2&gt;&lt;h3 id=&quot;1，一台-mac&quot;&gt;&lt;a href=&quot;#1，一台-mac&quot; class=&quot;headerli
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
      <category term="React-Native" scheme="http://www.kennethyo.me/tags/React-Native/"/>
    
  </entry>
  
  <entry>
    <title>[原]Android 自定义字体，字替换为图片</title>
    <link href="http://www.kennethyo.me/2015/12/03/2015-12-03/"/>
    <id>http://www.kennethyo.me/2015/12/03/2015-12-03/</id>
    <published>2015-12-03T05:54:59.000Z</published>
    <updated>2016-09-01T06:38:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>不久前开发的版本中有这样一个需求，根据服务器返回的分数，显示分数，各位可能觉得这有什么呢？那么请看下图。<br><img src="http://img.blog.csdn.net/20151203113652497" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20151203113712189" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20151203113725790" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20151203113742294" alt="这里写图片描述"></p>
<p>没错，这就是我们的需求。</p>
<hr>
<p>####思路一，<br>添加字体库，通过设置 TextView，在初始化的时候设置我们的字体。例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">TextView textView = (TextView) findViewById(R.id.custom);</div><div class="line"><span class="comment">// 将字体文件保存在assets/fonts/目录下</span></div><div class="line">Typeface typeFace =  Typeface.createFromAsset(getAssets(),<span class="string">"fonts/your_font_name.ttf"</span>);</div><div class="line"><span class="comment">// 应用字体</span></div><div class="line">textView.setTypeface(typeFace);</div></pre></td></tr></table></figure></p>
<p>####思路二，<br>通过 自定义 View，根据分数算出每个字的位置，通过canvas 画出。通过如下方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawBitmap(<span class="meta">@NonNull</span> Bitmap bitmap, <span class="keyword">float</span> left, <span class="keyword">float</span> top, <span class="meta">@Nullable</span> Paint paint)</div></pre></td></tr></table></figure></p>
<hr>
<p>####解决方案：<br>按照上面的思路，我直接去找设计妹子，说能给我做成字体库吗？然后我就被抓成土豆丝了。回来我自己了解了一下做字体库，通过了解，为这几个字（0，1，2，3，4，5，6，7，8，9，分，@#%作为一个字），做字体库显然成本比较大。</p>
<p>思路一不行，就思路二吧。思路麻烦在于，要分别处理，两个字（0分），三个字（60分），四个字（100分）和@#%，四种情况。</p>
<p>分清了几种状态，就可以开始着手开发了，就在这时，这时，我想到，这个，这个，不就和年初看的 emoji 表情是一个意思吗，只不过换成我自己的表情而已。</p>
<p>年初看的 emoji 表情，是 <a href="https://github.com/rockerhieu/emojicon" target="_blank" rel="external">github 上的一个项目</a>，其主要原理是，通过判断字符来替换相应的字符码为 emoji 图片。</p>
<p>这是自定义的 TextView<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FaceRateTextView</span> <span class="keyword">extends</span> <span class="title">TextView</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FaceRateTextView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FaceRateTextView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FaceRateTextView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(getText())) &#123;</div><div class="line">            setText(getText());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(CharSequence text, BufferType type)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(text)) &#123;</div><div class="line">            SpannableStringBuilder builder = <span class="keyword">new</span> SpannableStringBuilder(text);</div><div class="line">            FontsHandler.addFonts(getContext(), builder, (<span class="keyword">int</span>) getTextSize(), (<span class="keyword">int</span>) getTextSize());</div><div class="line">            text = builder;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">super</span>.setText(text, type);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>FontsHandler，是通过正则判断字符串当中有没有要替换的字符，并且替换为 DynamicDrawableSpan。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FontsHandler</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Integer&gt; mFonts = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">12</span>);</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        mFonts.put(<span class="string">"分"</span>, R.drawable.ic_face_rate);</div><div class="line">        mFonts.put(<span class="string">"0"</span>, R.drawable.ic_face_rate_0);</div><div class="line">        mFonts.put(<span class="string">"1"</span>, R.drawable.ic_face_rate_1);</div><div class="line">        mFonts.put(<span class="string">"2"</span>, R.drawable.ic_face_rate_2);</div><div class="line">        mFonts.put(<span class="string">"3"</span>, R.drawable.ic_face_rate_3);</div><div class="line">        mFonts.put(<span class="string">"4"</span>, R.drawable.ic_face_rate_4);</div><div class="line">        mFonts.put(<span class="string">"5"</span>, R.drawable.ic_face_rate_5);</div><div class="line">        mFonts.put(<span class="string">"6"</span>, R.drawable.ic_face_rate_6);</div><div class="line">        mFonts.put(<span class="string">"7"</span>, R.drawable.ic_face_rate_7);</div><div class="line">        mFonts.put(<span class="string">"8"</span>, R.drawable.ic_face_rate_8);</div><div class="line">        mFonts.put(<span class="string">"9"</span>, R.drawable.ic_face_rate_9);</div><div class="line">        mFonts.put(<span class="string">"balala"</span>, R.drawable.ic_face_rate_balala);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">addFonts</span><span class="params">(Context context, Spannable spannable, <span class="keyword">int</span> size, <span class="keyword">int</span> textSize)</span> </span>&#123;</div><div class="line">        <span class="keyword">boolean</span> hasChanges = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : mFonts.entrySet()) &#123;</div><div class="line">            String key = entry.getKey();</div><div class="line">            Matcher matcher = Pattern.compile(Pattern.quote(key)).matcher(spannable);</div><div class="line">            <span class="keyword">while</span> (matcher.find()) &#123;</div><div class="line">                <span class="keyword">boolean</span> set = <span class="keyword">true</span>;</div><div class="line">                <span class="keyword">for</span> (FontsSpan span : spannable.getSpans(matcher.start(),</div><div class="line">                        matcher.end(), FontsSpan.class))</div><div class="line">                    <span class="keyword">if</span> (spannable.getSpanStart(span) &gt;= matcher.start()</div><div class="line">                            &amp;&amp; spannable.getSpanEnd(span) &lt;= matcher.end())</div><div class="line">                        spannable.removeSpan(span);</div><div class="line">                    <span class="keyword">else</span> &#123;</div><div class="line">                        set = <span class="keyword">false</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                <span class="keyword">if</span> (set) &#123;</div><div class="line">                    hasChanges = <span class="keyword">true</span>;</div><div class="line">                    spannable.setSpan(<span class="keyword">new</span> FontsSpan(context, entry.getValue(), size, textSize),</div><div class="line">                            matcher.start(), matcher.end(),</div><div class="line">                            Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> hasChanges;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>FontsSpan 继承于DynamicDrawableSpan，主要实现替换字符为 drawable。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FontsSpan</span> <span class="keyword">extends</span> <span class="title">DynamicDrawableSpan</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Context mContext;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mResourceId;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mSize;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mTextSize;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mHeight;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mWidth;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTop;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Drawable mDrawable;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> WeakReference&lt;Drawable&gt; mDrawableRef;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FontsSpan</span><span class="params">(Context context, <span class="keyword">int</span> resourceId, <span class="keyword">int</span> size, <span class="keyword">int</span> textSize)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(DynamicDrawableSpan.ALIGN_BASELINE);</div><div class="line">        mContext = context;</div><div class="line">        mResourceId = resourceId;</div><div class="line">        mWidth = mHeight = mSize = size;</div><div class="line">        mTextSize = textSize;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Drawable <span class="title">getDrawable</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mDrawable == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                mDrawable = mContext.getResources().getDrawable(mResourceId);</div><div class="line">                mHeight = mSize;</div><div class="line">                mWidth = mHeight * mDrawable.getIntrinsicWidth() / mDrawable.getIntrinsicHeight();</div><div class="line">                mTop = (mTextSize - mHeight) / <span class="number">2</span>;</div><div class="line">                mDrawable.setBounds(<span class="number">0</span>, mTop, mWidth, mTop + mHeight);</div><div class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                <span class="comment">// swallow</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> mDrawable;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas, CharSequence text, <span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">float</span> x, <span class="keyword">int</span> top, <span class="keyword">int</span> y, <span class="keyword">int</span> bottom, Paint paint)</span> </span>&#123;</div><div class="line">        <span class="comment">//super.draw(canvas, text, start, end, x, top, y, bottom, paint);</span></div><div class="line">        Drawable b = getCachedDrawable();</div><div class="line">        canvas.save();</div><div class="line"></div><div class="line">        <span class="keyword">int</span> transY = bottom - b.getBounds().bottom;</div><div class="line">        <span class="keyword">if</span> (mVerticalAlignment == ALIGN_BASELINE) &#123;</div><div class="line">            transY = top + ((bottom - top) / <span class="number">2</span>) - ((b.getBounds().bottom - b.getBounds().top) / <span class="number">2</span>) - mTop;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        canvas.translate(x, transY);</div><div class="line">        b.draw(canvas);</div><div class="line">        canvas.restore();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> Drawable <span class="title">getCachedDrawable</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mDrawableRef == <span class="keyword">null</span> || mDrawableRef.get() == <span class="keyword">null</span>) &#123;</div><div class="line">            mDrawableRef = <span class="keyword">new</span> WeakReference&lt;Drawable&gt;(getDrawable());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> mDrawableRef.get();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其实原理很简单，并不复杂。<br><a href="https://github.com/KennethYo/ScanNeedleDemo" target="_blank" rel="external">demo代码地址</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;不久前开发的版本中有这样一个需求，根据服务器返回的分数，显示分数，各位可能觉得这有什么呢？那么请看下图。&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20151203113652497&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;br&gt;&lt;img src=
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
      <category term="View" scheme="http://www.kennethyo.me/tags/View/"/>
    
  </entry>
  
  <entry>
    <title>[原]Android 翻转动画 Rotate3dAnimation 效果</title>
    <link href="http://www.kennethyo.me/2015/10/16/2015-10-16/"/>
    <id>http://www.kennethyo.me/2015/10/16/2015-10-16/</id>
    <published>2015-10-16T09:05:57.000Z</published>
    <updated>2016-09-01T06:38:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>十一前请了一天假，后面请了三天假，串起来一共休息了十二天，这期间见了女朋友的家长，也领女朋友见了我家长，好消息是各方家长反馈不错，坏消息是涨了五斤肉，毕竟是吃了12天的呼伦贝儿牛羊肉哈。玩了这么多天，回来要收收心好好工作了，毕竟要攒钱娶媳妇哈~</p>
<hr>
<p>上班回来，按照产品的需求做了这样一个效果，如下图：</p>
<p><img src="http://img.blog.csdn.net/20151016162517318" alt="这里写图片描述"></p>
<p>这其中包含了3个动画，分别是移动动画、放大动画、旋转动画。</p>
<p>前两个动画比较好完成，可以用 TranslateAnimation 和 ScaleAnimation来完成，但是第三个就比较麻烦了，因为这个旋转动画是根据 Y 轴来旋转的，而 RotateAnimation 是根据垂直屏幕的 Z 轴旋转的，所以 RotateAnimation 并不能够完成我们需要的效果，这里就需要我们去继承 Animation 去自定义动画了。</p>
<p>但是！！！<br>但是 APIdemo 里面已经实现了这个动画，so，我们拿来用就好了，下面是我贴出来的Rotate3dAnimation，其中我添加了一个构造，添加了相对自己位置的 type。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.kenneth.rotate3danimation;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Camera;</div><div class="line"><span class="keyword">import</span> android.graphics.Matrix;</div><div class="line"><span class="keyword">import</span> android.view.animation.Animation;</div><div class="line"><span class="keyword">import</span> android.view.animation.Transformation;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rotate3dAnimation</span> <span class="keyword">extends</span> <span class="title">Animation</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCenterXType = ABSOLUTE;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCenterYType = ABSOLUTE;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span> mFromDegrees;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span> mToDegrees;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mCenterX;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mCenterY;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span> mDepthZ;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> mReverse;</div><div class="line">    <span class="keyword">private</span> Camera mCamera;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Creates a new 3D rotation on the Y axis. The rotation is defined by its</span></div><div class="line"><span class="comment">     * start angle and its end angle. Both angles are in degrees. The rotation</span></div><div class="line"><span class="comment">     * is performed around a center point on the 2D space, definied by a pair</span></div><div class="line"><span class="comment">     * of X and Y coordinates, called centerX and centerY. When the animation</span></div><div class="line"><span class="comment">     * starts, a translation on the Z axis (depth) is performed. The length</span></div><div class="line"><span class="comment">     * of the translation can be specified, as well as whether the translation</span></div><div class="line"><span class="comment">     * should be reversed in time.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> fromDegrees the start angle of the 3D rotation</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> toDegrees   the end angle of the 3D rotation</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> centerX     the X center of the 3D rotation</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> centerY     the Y center of the 3D rotation</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> reverse     true if the translation should be reversed, false otherwise</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rotate3dAnimation</span><span class="params">(<span class="keyword">float</span> fromDegrees, <span class="keyword">float</span> toDegrees,</span></span></div><div class="line"><span class="function"><span class="params">                             <span class="keyword">float</span> centerX, <span class="keyword">float</span> centerY, <span class="keyword">float</span> depthZ, <span class="keyword">boolean</span> reverse)</span> </span>&#123;</div><div class="line">        mFromDegrees = fromDegrees;</div><div class="line">        mToDegrees = toDegrees;</div><div class="line">        mCenterX = centerX;</div><div class="line">        mCenterY = centerY;</div><div class="line">        mDepthZ = depthZ;</div><div class="line">        mReverse = reverse;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rotate3dAnimation</span><span class="params">(<span class="keyword">float</span> fromDegrees, <span class="keyword">float</span> toDegrees,</span></span></div><div class="line"><span class="function"><span class="params">                             <span class="keyword">int</span> centerXType, <span class="keyword">float</span> centerX, <span class="keyword">int</span> centerYType, <span class="keyword">float</span> centerY, <span class="keyword">float</span> depthZ, <span class="keyword">boolean</span> reverse)</span> </span>&#123;</div><div class="line">        mFromDegrees = fromDegrees;</div><div class="line">        mToDegrees = toDegrees;</div><div class="line">        mCenterXType = centerXType;</div><div class="line">        mCenterX = centerX;</div><div class="line">        mCenterYType = centerYType;</div><div class="line">        mCenterY = centerY;</div><div class="line">        mDepthZ = depthZ;</div><div class="line">        mReverse = reverse;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">int</span> parentWidth, <span class="keyword">int</span> parentHeight)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.initialize(width, height, parentWidth, parentHeight);</div><div class="line">        mCamera = <span class="keyword">new</span> Camera();</div><div class="line">        mCenterX = resolveSize(mCenterXType, mCenterX, width, parentWidth);</div><div class="line">        mCenterY = resolveSize(mCenterYType, mCenterY, height, parentHeight);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyTransformation</span><span class="params">(<span class="keyword">float</span> interpolatedTime, Transformation t)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> fromDegrees = mFromDegrees;</div><div class="line">        <span class="keyword">float</span> degrees = fromDegrees + ((mToDegrees - fromDegrees) * interpolatedTime);</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> centerX = mCenterX;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> centerY = mCenterY;</div><div class="line">        <span class="keyword">final</span> Camera camera = mCamera;</div><div class="line"></div><div class="line">        <span class="keyword">final</span> Matrix matrix = t.getMatrix();</div><div class="line"></div><div class="line">        camera.save();</div><div class="line">        <span class="keyword">if</span> (mReverse) &#123;</div><div class="line">            camera.translate(<span class="number">0.0f</span>, <span class="number">0.0f</span>, mDepthZ * interpolatedTime);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            camera.translate(<span class="number">0.0f</span>, <span class="number">0.0f</span>, mDepthZ * (<span class="number">1.0f</span> - interpolatedTime));</div><div class="line">        &#125;</div><div class="line">        camera.rotateY(degrees);</div><div class="line">        camera.getMatrix(matrix);</div><div class="line">        camera.restore();</div><div class="line"></div><div class="line">        matrix.preTranslate(-centerX, -centerY);</div><div class="line">        matrix.postTranslate(centerX, centerY);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>移动动画也比较好做，点击的时候记录点击 icon 在 window 上的位置，然后传到下一个界面，计算一下偏移量。</p>
<p>这里面要注意，里面的 weibo 等 icon，我用的并不是图片，用的是FontAwesome，具体用法看下面博客：<br>中文地址：<a href="http://mp.weixin.qq.com/s?__biz=MjM5NDAxNTY4MA==&amp;mid=208795106&amp;idx=1&amp;sn=7745289b193dc8ff20ba81ff9bb23b21&amp;scene=1&amp;srcid=1016s8Satc5ZO0gDrVLqVIBM&amp;key=b410d3164f5f798e7ec8a5a17847eeddc1247303cf5fe40ac8a564295602dd6161bb83fa346de7cd9878b60274b20e77&amp;ascene=0&amp;uin=MTAxNzk0OTM1&amp;devicetype=iMac+MacBookPro11%2C1+OSX+OSX+10.11+build(15A284" target="_blank" rel="external">传送门</a>&amp;version=11020201&amp;pass_ticket=WHgV251%2BEh%2Bkh7UMBqQp034b8MGYzxeoJ7l9Ncwz3iE%3D)<br>项目网站：<a href="http://fortawesome.github.io/Font-Awesome/" target="_blank" rel="external">传送门</a></p>
<p>demo 代码地址：<a href="https://github.com/KennethYo/Rotate3dAnimation" target="_blank" rel="external">传送门</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;十一前请了一天假，后面请了三天假，串起来一共休息了十二天，这期间见了女朋友的家长，也领女朋友见了我家长，好消息是各方家长反馈不错，坏消息是涨了五斤肉，毕竟是吃了12天的呼伦贝儿牛羊肉哈。玩了这么多天，回来要收收心好好工作了，毕竟要攒钱娶媳妇哈~&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;上班
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
      <category term="Animation" scheme="http://www.kennethyo.me/tags/Animation/"/>
    
  </entry>
  
  <entry>
    <title>[原]Android 可拖拽 GridView 并且实时切换和拖动到下部删除</title>
    <link href="http://www.kennethyo.me/2015/09/29/2015-09-29/"/>
    <id>http://www.kennethyo.me/2015/09/29/2015-09-29/</id>
    <published>2015-09-29T07:22:08.000Z</published>
    <updated>2016-09-01T06:39:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近在公司做了一个这样的需求，拖动GridView 中的 item 到指定区域删除，具体效果，请看下面的动图。<br><img src="http://img.blog.csdn.net/20150929150020321" alt="这里写图片描述"></p>
<p>拖动效果是通过隐藏 GridView中被选中的 item，并且同时在 Window 上注册一个 View 来实现，具体逻辑和代码，请参照这篇博客<a href="http://blog.csdn.net/xiaanming/article/details/17718579。" target="_blank" rel="external">http://blog.csdn.net/xiaanming/article/details/17718579。</a></p>
<p>我的需求当中，多了一个拖动到底部区域缩小并且删除。</p>
<p>考虑到从 GridView 中拖动一个 item 到另一个 View 中，并且删除，只在 GridView 当中进行绘制被拖动的 item 肯定是达不到进入另一个 view 的效果，即使做起来也是相当麻烦的。</p>
<p>我们可以在 GridView 和删除区域的上一层 View 当中进行绘制，但是看到<a href="http://blog.csdn.net/xiaanming/article/details/17718579" target="_blank" rel="external">拖动效果博客</a>当中是直接注册在了 Window 上，这更加减少了工作量，直接在 GridView 当中判断如果用户拖动的坐标y 轴大于了 GridView 的高度，就可以进行缩小动画了。</p>
<p>但是这里要注意的是，注册在 window 上的 View 不能直接在其最外层的  Layout 上进行动画，所以我对ImageView 进行了包裹，并且是对 ImageView 进行动画。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mDragImageView = <span class="keyword">new</span> ImageView(getContext());</div><div class="line">      mDragImageView.setImageBitmap(bitmap);</div><div class="line">mDragImageView.setBackgroundResource(R.drawable.bg_shadow);</div><div class="line"></div><div class="line">      mDragLayout = <span class="keyword">new</span> FrameLayout(getContext());</div><div class="line">      mDragLayout.addView(mDragImageView);</div><div class="line"></div><div class="line">      mWindowManager.addView(mDragLayout, mWindowLayoutParams);</div></pre></td></tr></table></figure></p>
<p>有了拖动效果实现的代码，其他都很简单，具体请参照代码，<br><a href="https://github.com/KennethYo/DragViewAndDelete" target="_blank" rel="external">代码地址</a>，其中里面的一些自定义标签都是我需求中自定义的，可以自行修改。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在公司做了一个这样的需求，拖动GridView 中的 item 到指定区域删除，具体效果，请看下面的动图。&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150929150020321&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;/p&gt;
&lt;p&gt;拖动
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
      <category term="View" scheme="http://www.kennethyo.me/tags/View/"/>
    
  </entry>
  
  <entry>
    <title>[原]高仿SinaWeibo新浪微博发布页面话题效果</title>
    <link href="http://www.kennethyo.me/2015/08/10/2015-08-10/"/>
    <id>http://www.kennethyo.me/2015/08/10/2015-08-10/</id>
    <published>2015-08-09T16:06:33.000Z</published>
    <updated>2016-09-01T06:38:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近做了一个仿新浪微博话题效果的功能,网上搜索了几个效果,都存在一定问题,最终借鉴别人的思路,完成这一套效果.</p>
<p>首先,我们拆分逻辑以及开发顺序.</p>
<blockquote>
<h6 id="1-实现话题变色效果"><a href="#1-实现话题变色效果" class="headerlink" title="1,实现话题变色效果"></a>1,实现话题变色效果</h6><h6 id="2-实现插入话题效果"><a href="#2-实现插入话题效果" class="headerlink" title="2,实现插入话题效果"></a>2,实现插入话题效果</h6><h6 id="3-实现话题选中删除效果"><a href="#3-实现话题选中删除效果" class="headerlink" title="3,实现话题选中删除效果"></a>3,实现话题选中删除效果</h6><h6 id="4-实现点击话题-光标在话题之后"><a href="#4-实现点击话题-光标在话题之后" class="headerlink" title="4,实现点击话题,光标在话题之后"></a>4,实现点击话题,光标在话题之后</h6></blockquote>
<p><img src="http://img.blog.csdn.net/20150809173121271" alt="这里写图片描述"></p>
<p>下面我们就一步一步实现效果.</p>
<hr>
<h2 id="一-实现话题变色"><a href="#一-实现话题变色" class="headerlink" title="一,实现话题变色"></a>一,实现话题变色</h2><p>实现逻辑主要是通过<code>EditText</code>的<code>addTextChangedListener()</code>来进行监听文本变动,通过正则表达式来匹配出文本中的话题.</p>
<h5 id="利用正则表达式获取全部话题"><a href="#利用正则表达式获取全部话题" class="headerlink" title="利用正则表达式获取全部话题:"></a>利用正则表达式获取全部话题:</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正则表达式,一定要和服务器以及 iOS 端统一</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String topicRegex = <span class="string">"#([^#]+?)#"</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title">findTopic</span><span class="params">(String s)</span> </span>&#123;</div><div class="line"></div><div class="line">        Pattern p = Pattern.compile(topicRegex);</div><div class="line">        Matcher m = p.matcher(s);</div><div class="line"></div><div class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">while</span> (m.find()) &#123;</div><div class="line">            list.add(m.group());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> list;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="通过正则表达式匹配出的话题集合-遍历出每个话题的-startIndex-位置-后来发现Matcher方法是有获取-index-的方法-并且通过EditText-getText-方法获取的Editable直接对文本进行操作"><a href="#通过正则表达式匹配出的话题集合-遍历出每个话题的-startIndex-位置-后来发现Matcher方法是有获取-index-的方法-并且通过EditText-getText-方法获取的Editable直接对文本进行操作" class="headerlink" title="通过正则表达式匹配出的话题集合,遍历出每个话题的 startIndex 位置(后来发现Matcher方法是有获取 index 的方法),并且通过EditText.getText()方法获取的Editable直接对文本进行操作:"></a>通过正则表达式匹配出的话题集合,遍历出每个话题的 startIndex 位置(后来发现<code>Matcher</code>方法是有获取 index 的方法),并且通过<code>EditText.getText()</code>方法获取的<code>Editable</code>直接对文本进行操作:</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">        Log.i(<span class="string">"MainActivity"</span>, <span class="string">"onTextChanged"</span>);</div><div class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(s)) <span class="keyword">return</span>;</div><div class="line">        <span class="comment">//1,查找话题</span></div><div class="line">        String content = s.toString();</div><div class="line">        mTopicList.clear();</div><div class="line">        mTopicList.addAll(findTopic(s.toString()));</div><div class="line"></div><div class="line">        <span class="comment">//2,为查找出的变色</span></div><div class="line">        <span class="comment">//首先要为editable,去除之前设置的colorSpan</span></div><div class="line">        Editable editable = mEditText.getText();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mColorSpans.size(); i++) &#123;</div><div class="line">            editable.removeSpan(mColorSpans.get(i));</div><div class="line">        &#125;</div><div class="line">        mColorSpans.clear();</div><div class="line">        <span class="comment">//为editable,中的话题加入colorSpan</span></div><div class="line">        <span class="keyword">int</span> findPos = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> size = mTopicList.size();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;<span class="comment">//便利话题</span></div><div class="line">            String topic = mTopicList.get(i);</div><div class="line">            findPos = content.indexOf(topic, findPos);</div><div class="line">            <span class="keyword">if</span> (findPos != -<span class="number">1</span>) &#123;</div><div class="line">                ForegroundColorSpan colorSpan = <span class="keyword">new</span> ForegroundColorSpan(Color.BLUE);</div><div class="line">                editable.setSpan(colorSpan, findPos, findPos = findPos + topic.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</div><div class="line">                mColorSpans.add(colorSpan);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="二-实现插入话题效果"><a href="#二-实现插入话题效果" class="headerlink" title="二,实现插入话题效果"></a>二,实现插入话题效果</h2><p>新浪微博的插入话题效果,是开启一个新的页面,点击一个话题后,插入光标所在的位置.这里我用一个按钮模仿了这个动作.要注意的是,要记录插入之前光标的位置,并且在插入话题后,把光标放置在话题之后:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (v.getId() == R.id.button) &#123;</div><div class="line">            <span class="comment">//插入话题</span></div><div class="line">            <span class="keyword">int</span> selectionStart = mEditText.getSelectionStart();</div><div class="line">			<span class="comment">//下面这些操作也可以直接替换为操作 EditText 的Editable实现,下面的代码 review 后看起来由点蠢,直接调用 insert 方法比较巧妙</span></div><div class="line">            String content = mEditText.getText().toString();</div><div class="line"></div><div class="line">            String firstStr = content.substring(<span class="number">0</span>, selectionStart);</div><div class="line">            String secondStr = content.substring(selectionStart, content.length());</div><div class="line"></div><div class="line">            String insertTopic = <span class="string">"#这是一个插入的话题#"</span>;</div><div class="line">            mEditText.setText(firstStr + insertTopic + secondStr);</div><div class="line">            mEditText.setSelection(selectionStart + insertTopic.length());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="三-实现话题选中删除效果"><a href="#三-实现话题选中删除效果" class="headerlink" title="三,实现话题选中删除效果"></a>三,实现话题选中删除效果</h2><p>这里也是要时时判断光标所在的位置,当光标出现在话题之后,再次点击删除,就截获为选中话题效果,实现起来也是很简单的.</p>
<p>但是要注意的是,我们不能利用 activity 里面的<code>onKeyDown()</code>和<code>onKeyUp()</code>两个回调,通过 log 发现文本变动和按键点击的回调顺序为<code>beforeTextChanged-&gt;onTextChanged-&gt;afterTextChanged-&gt;onKeyDown-&gt;onKeyUp</code>.</p>
<p>这也说明了如果通过 拦截<code>onKeyDown()</code>和<code>onKeyUp()</code>两个回调时,文本是已经删除之后的文本,并能有效的达到我们要实现的目的,那么有没有是文本改变之前就能截取到按键的方法呢?</p>
<p>其实我们可以通过监听<code>EditText</code>的<code>setOnKeyListener()</code>方法来监听按键(<code>onKey-&gt;beforeTextChanged-&gt;onTextChanged-&gt;afterTextChanged-&gt;onKeyDown-&gt;onKeyUp</code>):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKey</span><span class="params">(View v, <span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</div><div class="line">        Log.i(<span class="string">"MainActivity"</span>, <span class="string">"onKey"</span>);</div><div class="line">        <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_DEL &amp;&amp; event.getAction() == KeyEvent.ACTION_DOWN &amp;&amp; mCheckBox2.isChecked()) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">int</span> selectionStart = mEditText.getSelectionStart();</div><div class="line">            <span class="keyword">int</span> selectionEnd = mEditText.getSelectionEnd();</div><div class="line">			<span class="comment">//如果光标起始和结束在同一位置,说明是选中效果,直接返回 false 交给系统执行删除动作</span></div><div class="line">            <span class="keyword">if</span> (selectionStart != selectionEnd) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            Editable editable = mEditText.getText();</div><div class="line">            String content = editable.toString();</div><div class="line">            <span class="keyword">int</span> lastPos = <span class="number">0</span>;</div><div class="line">            <span class="keyword">int</span> size = mTopicList.size();</div><div class="line">            <span class="comment">//遍历判断光标的位置</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">                String topic = mTopicList.get(i);</div><div class="line">                lastPos = content.indexOf(topic, lastPos);</div><div class="line">                <span class="keyword">if</span> (lastPos != -<span class="number">1</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (selectionStart != <span class="number">0</span> &amp;&amp; selectionStart &gt;= lastPos &amp;&amp; selectionStart &lt;= (lastPos + topic.length())) &#123;</div><div class="line">                        <span class="comment">//选中话题</span></div><div class="line">                        mEditText.setSelection(lastPos, lastPos + topic.length());</div><div class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                lastPos += topic.length();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="四-实现点击话题-光标在话题之后"><a href="#四-实现点击话题-光标在话题之后" class="headerlink" title="四,实现点击话题,光标在话题之后"></a>四,实现点击话题,光标在话题之后</h2><p>逻辑处理就是监听<code>EditText</code>的点击事件,处理光标所在位置,如果在位置在话题内,立即放置在话题的后面,逻辑比较简单,直接上代码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (v.getId() == R.id.editText &amp;&amp; mCheckBox1.isChecked()) &#123;</div><div class="line">            <span class="keyword">int</span> selectionStart = mEditText.getSelectionStart();</div><div class="line"></div><div class="line">            <span class="keyword">int</span> lastPos = <span class="number">0</span>;</div><div class="line">            <span class="keyword">int</span> size = mTopicList.size();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">                String topic = mTopicList.get(i);</div><div class="line">                lastPos = mEditText.getText().toString().indexOf(topic, lastPos);</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (lastPos != -<span class="number">1</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (selectionStart &gt;= lastPos &amp;&amp; selectionStart &lt;= (lastPos + topic.length())) &#123;</div><div class="line">                        <span class="comment">//在这position 区间就移动光标</span></div><div class="line">                        mEditText.setSelection(lastPos + topic.length());</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                lastPos = lastPos + topic.length();</div><div class="line">            &#125;</div><div class="line">        &#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>最终还是有点小遗憾没有完成.当拷贝一段已经变色的话题,再粘贴到文本后,无法删除掉拷贝进来文本的变色效果,尝试调用<code>Editable.clearSpans()</code>去除全部 span 也无法实现,并且这个方法会导致直接卡死.后来直接使用<code>EditText.setText()</code>控制文本,确实达到了效果,但是当输入法是类似 mx4默认输入法效果时(效果大概是,输入的拼音直接显示在 EditText 里面,点击被选汉字,替换掉拼音),会把输入的拼音放入到文本里,所以上面的代码,我一般是直接操作 Editable.</p>
<p>如果有更好的方法或者修复了上面的小遗憾,请留言指教.</p>
<p>Demo 地址：<a href="https://github.com/KennethYo/SinaTopic" target="_blank" rel="external">https://github.com/KennethYo/SinaTopic</a></p>
<p>转载请注明出处:<a href="http://www.kennethyo.me">http://www.kennethyo.me</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近做了一个仿新浪微博话题效果的功能,网上搜索了几个效果,都存在一定问题,最终借鉴别人的思路,完成这一套效果.&lt;/p&gt;
&lt;p&gt;首先,我们拆分逻辑以及开发顺序.&lt;/p&gt;
&lt;blockquote&gt;
&lt;h6 id=&quot;1-实现话题变色效果&quot;&gt;&lt;a href=&quot;#1-实现话题变色效果
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>[译]介绍MVP Model-View-Presenter在Android中的应用</title>
    <link href="http://www.kennethyo.me/2015/05/25/2015-05-25/"/>
    <id>http://www.kennethyo.me/2015/05/25/2015-05-25/</id>
    <published>2015-05-25T05:47:35.000Z</published>
    <updated>2016-09-01T06:39:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>这篇文章是我学习MVP模式时翻译的，原文是<a href="http://konmik.github.io/author/konstantin-mikheev.html" target="_blank" rel="external">Konstantin Mikheev</a>所写，<a href="http://konmik.github.io/introduction-to-model-view-presenter-on-android.html?utm_source=Android+Weekly&amp;utm_campaign=5589504b56-Android_Weekly_148&amp;utm_medium=email&amp;utm_term=0_4eb677ad19-5589504b56-337835113" target="_blank" rel="external">传送门</a>。<br>因英语水平有限，翻译的很生硬，基本靠Google，请见谅。以下是译文。<br>转载请注明出处:<a href="http://blog.csdn.net/kennethyo" target="_blank" rel="external">http://blog.csdn.net/kennethyo</a></p>
<hr>
<p>这篇文章我会通过一个最简单的例子去一步步介绍MVP模式在Android中的最佳实践。同时我也会介绍一个使MVP模式在Android开发中变简单的library。</p>
<h1 id="简单？怎么才能从中获益呢？"><a href="#简单？怎么才能从中获益呢？" class="headerlink" title="简单？怎么才能从中获益呢？"></a>简单？怎么才能从中获益呢？</h1><h2 id="什么是MVP"><a href="#什么是MVP" class="headerlink" title="什么是MVP"></a>什么是MVP</h2><p><strong>View</strong>层是用来显示数据和相应数据操作的。在Android中，它可能是Activity，Fragment，View或者Dialog。</p>
<p><strong>Model</strong>层是数据访问层，例如数据库API或者远程服务器访问API。</p>
<p><strong>Presenter</strong>层提供View层和Model层的数据进行联系。Presenter层也可以控制后台Task。</p>
<p>在Android中，MVP模式可以把后台线程从Activitys/Views/Fragments中脱离出来，使它们在大部分生命周期事件中更加独立。这样的应用变得更加简单，整个程序的稳定性提升了10倍不止，应用代码变得更加少，代码可维护性变得更加友善，开发者的生命变得更加开心。</p>
<h2 id="在Android中，为什么是MVP"><a href="#在Android中，为什么是MVP" class="headerlink" title="在Android中，为什么是MVP"></a>在Android中，为什么是MVP</h2><h3 id="原因1：保持简单傻瓜"><a href="#原因1：保持简单傻瓜" class="headerlink" title="原因1：保持简单傻瓜"></a>原因1：保持简单傻瓜</h3><p>如果你还没读过这篇文章，请读一遍：<a href="https://people.apache.org/~fhanik/kiss.html" target="_blank" rel="external">The Kiss Principle</a></p>
<pre><code>·大多数Android程序仅仅使用了View-Model模式。
·程序员需要参与View的复杂性，而不是解决业务。
</code></pre><p>在应用中你仅仅使用Model-View，最后会落得“一切连接这一切”的状态。</p>
<p><img src="http://img.blog.csdn.net/20150525132155795" alt="这里写图片描述"></p>
<p>如果这个示例图看起来不是那么复杂，那么想想每个View可能随时消失和随时出现。别忘了保存和恢复view的状态。为临时View attache 几个后台任务，蛋糕准备好了！</p>
<p>另一种“一切连接着一切”就是上帝对象。</p>
<p><img src="http://img.blog.csdn.net/20150525132227292" alt="这里写图片描述"></p>
<p>上地对象太过于复杂；代码块不能被重复利用，测试或方便的debug和重构。</p>
<h4 id="使用MVP模式"><a href="#使用MVP模式" class="headerlink" title="使用MVP模式"></a>使用MVP模式</h4><p><img src="http://img.blog.csdn.net/20150525132427577" alt="这里写图片描述"></p>
<pre><code>·复杂的任务被分解成简单的任务，并且容易解决。
·更小的对象，更少的bug，更简单debug。
·可测试。
</code></pre><h3 id="原因2：后台任务"><a href="#原因2：后台任务" class="headerlink" title="原因2：后台任务"></a>原因2：后台任务</h3><p>无论何时，你写Activity，Fragment或者自定义View，你可以把所有方法与后台任务的外部或者静态类联系起来。这样，你的后台任务将不会和一个Activity联系，不会造成内存泄露和不用Activity来消费。我叫这样的对象为“Presenter”。</p>
<p>有那么几种处理后台线程的方法，但都是不可靠的，不过MVP是可靠的。</p>
<h4 id="为什么MVP可以"><a href="#为什么MVP可以" class="headerlink" title="为什么MVP可以"></a>为什么MVP可以</h4><p>通过这个视图，显示了不同的应用控件，在发生configuration发生改变或者内存溢出的时候发生了什么。每一个Android开发者都应该知道这个视图，然而这样一个视图并不是每个开发都知道。</p>
<p><img src="http://img.blog.csdn.net/20150525133414325" alt="这里写图片描述"></p>
<p><strong>Case 1:</strong>当用户旋转屏幕，改变语言设置， attache 一个外部显示器，等情况，通常Configuration会发生变化。更多关于[Configuration]<br>(<a href="http://developer.android.com/reference/android/R.attr.html#configChanges)请阅读链接。" target="_blank" rel="external">http://developer.android.com/reference/android/R.attr.html#configChanges)请阅读链接。</a></p>
<p><strong>Case 2:</strong>当用户在开发者设置里面选择了“Don’t keep activities”或者其他Activity到最顶层，Activity会发生restart。</p>
<p><strong>Case 3:</strong>没有足够的内存和应用进入后台，process会restart。</p>
<p><strong>最后</strong><br>现在你可以看到，Fragment当中设置setRetainInstance(true)在这里是没用帮助的，我们只需要设置save/restore就可以。因此，我们可以简单的去除Fragment的setRetainInstance方法，来限制问题的数量。</p>
<p><img src="http://img.blog.csdn.net/20150525133504401" alt="这里写图片描述"></p>
<p>|Activity, View, Fragment, DialogFragment Static variables and threads | save/restore no change | save/restore reset |<br>现在看起来爽多了。我们在应用任何情况下，只需要写两段代码就可以完成restore：</p>
<pre><code>·Activity，View，Fragment，DialogFragment的save/restore。
·线程restart，restart后台请求。
</code></pre><p>第一部分，是Android API提供的方法。第二部分是Presenter层的工作。Presenter只要记住那些请求需要被执行，如果一个进程执行期间restart，Presenter将会重新执行它们。</p>
<h2 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h2><p>这个例子将加载服务器上得数据来显示一些items。如果出现错误将显示一个toast。</p>
<p>我推荐使用<a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">RxJava</a>来构建Presenter，因为这个Library控制数据流很简单。</p>
<p>我也要感谢创建<a href="http://www.icndb.com/" target="_blank" rel="external">The Internet Chuck Norris Database</a>的人，我把它用在了我例子当中。</p>
<h2 id="没用MVP的例子00："><a href="#没用MVP的例子00：" class="headerlink" title="没用MVP的例子00："></a>没用MVP的<a href="https://github.com/konmik/MVPExamples/tree/master/example00" target="_blank" rel="external">例子00</a>：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_NAME = <span class="string">"Chuck Norris"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayAdapter&lt;ServerAPI.Item&gt; adapter;</div><div class="line">    <span class="keyword">private</span> Subscription subscription;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        ListView listView = (ListView)findViewById(R.id.listView);</div><div class="line">        listView.setAdapter(adapter = <span class="keyword">new</span> ArrayAdapter&lt;&gt;(<span class="keyword">this</span>, R.layout.item));</div><div class="line">        requestItems(DEFAULT_NAME);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        unsubscribe();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestItems</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        unsubscribe();</div><div class="line">        subscription = App.getServerAPI()</div><div class="line">            .getItems(name.split(<span class="string">"\\s+"</span>)[<span class="number">0</span>], name.split(<span class="string">"\\s+"</span>)[<span class="number">1</span>])</div><div class="line">            .delay(<span class="number">1</span>, TimeUnit.SECONDS)</div><div class="line">            .observeOn(AndroidSchedulers.mainThread())</div><div class="line">            .subscribe(<span class="keyword">new</span> Action1&lt;ServerAPI.Response&gt;() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(ServerAPI.Response response)</span> </span>&#123;</div><div class="line">                    onItemsNext(response.items);</div><div class="line">                &#125;</div><div class="line">            &#125;, <span class="keyword">new</span> Action1&lt;Throwable&gt;() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Throwable error)</span> </span>&#123;</div><div class="line">                    onItemsError(error);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemsNext</span><span class="params">(ServerAPI.Item[] items)</span> </span>&#123;</div><div class="line">        adapter.clear();</div><div class="line">        adapter.addAll(items);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemsError</span><span class="params">(Throwable throwable)</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, throwable.getMessage(), Toast.LENGTH_LONG).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unsubscribe</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (subscription != <span class="keyword">null</span>) &#123;</div><div class="line">            subscription.unsubscribe();</div><div class="line">            subscription = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一个有经验的开发会发现这个例子是有一些缺陷的：</p>
<pre><code>·每次翻转屏幕都会重新请求一次——每次翻转屏幕用户都会看一会儿空白界面。
·如果用户经常翻转屏幕，就会导致内存泄露——每个回调都会保持对MainActivity的引用，并且request运行的时候会把MainActivity保持在内存中。这绝对有可能导致因为内存溢出而应用crash，或者应用运行明显缓慢。
</code></pre><h2 id="使用MVP的例子01"><a href="#使用MVP的例子01" class="headerlink" title="使用MVP的例子01"></a>使用MVP的<a href="https://github.com/konmik/MVPExamples/tree/master/example01" target="_blank" rel="external">例子01</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainPresenter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_NAME = <span class="string">"Chuck Norris"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ServerAPI.Item[] items;</div><div class="line">    <span class="keyword">private</span> Throwable error;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> MainActivity view;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainPresenter</span><span class="params">()</span> </span>&#123;</div><div class="line">        App.getServerAPI()</div><div class="line">            .getItems(DEFAULT_NAME.split(<span class="string">"\\s+"</span>)[<span class="number">0</span>], DEFAULT_NAME.split(<span class="string">"\\s+"</span>)[<span class="number">1</span>])</div><div class="line">            .delay(<span class="number">1</span>, TimeUnit.SECONDS)</div><div class="line">            .observeOn(AndroidSchedulers.mainThread())</div><div class="line">            .subscribe(<span class="keyword">new</span> Action1&lt;ServerAPI.Response&gt;() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(ServerAPI.Response response)</span> </span>&#123;</div><div class="line">                    items = response.items;</div><div class="line">                    publish();<span class="comment">//onNext</span></div><div class="line">                &#125;</div><div class="line">            &#125;, <span class="keyword">new</span> Action1&lt;Throwable&gt;() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Throwable throwable)</span> </span>&#123;</div><div class="line">                    error = throwable;</div><div class="line">                    publish();<span class="comment">//onError</span></div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">    &#125;</div><div class="line">     </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTakeView</span><span class="params">(MainActivity view)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.view = view;</div><div class="line">        publish();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">publish</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (items != <span class="keyword">null</span>)</div><div class="line">                view.onItemsNext(items);</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (error != <span class="keyword">null</span>)</div><div class="line">                view.onItemsError(error);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从技术角度讲：MainPresenter有三个线程事件：onNext，onError，onTakeview。通过<code>publish()</code>方法，onNext或者onError事件会发布到MainActivity实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayAdapter&lt;ServerAPI.Item&gt; adapter;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MainPresenter presenter;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        ListView listView = (ListView)findViewById(R.id.listView);</div><div class="line">        listView.setAdapter(adapter = <span class="keyword">new</span> ArrayAdapter&lt;&gt;(<span class="keyword">this</span>, R.layout.item));</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (presenter == <span class="keyword">null</span>)</div><div class="line">            presenter = <span class="keyword">new</span> MainPresenter();</div><div class="line">        presenter.onTakeView(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        presenter.onTakeView(<span class="keyword">null</span>);</div><div class="line">        <span class="keyword">if</span> (isFinishing())</div><div class="line">            presenter = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemsNext</span><span class="params">(ServerAPI.Item[] items)</span> </span>&#123;</div><div class="line">        adapter.clear();</div><div class="line">        adapter.addAll(items);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemsError</span><span class="params">(Throwable throwable)</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, throwable.getMessage(), Toast.LENGTH_LONG).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainActivity 创建 MainPresenter，并且保持MainPresenter在onCreate和onDestory周期之外。MainActivity用一个静态变量引用MainPresenter，当由于OOM导致线程重启，MainActivity会检查MainPresenter是否还存在，如果不存在就去创建它。</p>
<p>是的，检查和使用静态变量起来有那么点臃肿，但是稍后我会给大家看如何写的更加优雅。：）</p>
<p>主要思想：</p>
<pre><code>·例子应用不会在每次用户翻转屏幕的时候重新请求。
·如果线程被重启，再次加载数据。
·当MainActivity被销毁后，MainPresenter不会保持应用
</code></pre><p>MainActivity实例，这样当旋转屏幕的时候就不会内存泄露，而且也没有取消请求。</p>
<p>##Nucleus</p>
<p>Nuleus 是我创建的一个library，灵感来自于<a href="https://github.com/square/mortar" target="_blank" rel="external">Mortar</a>library和<a href="https://people.apache.org/~fhanik/kiss.html" target="_blank" rel="external">Keep It Stupid Simple</a>这篇文章。</p>
<p>下面是功能列表：</p>
<pre><code>·支持在View/Fragment/Activity状态Bundle中save/restore Presenter的状态。Presenter能够存储请求参数到重新启动。

·提供一个工具，通过一行代码可以把请求结果和错误放到正确的view当中去，因此无需再写`！=null`来检查。

·一个Presenter可以被多个view实例引用。如果Presenter实例使用[Dagger]，就不能被多个view引用。

·通过一行代码就可以把Presenter和view进行绑定。

·提供view的基类：NucleusView, NucleusFragment, NucleusSupportFragment, NucleusActivity。你也可以从他们当中copy代码到任何类当中来利用Nucleus的Presenters。

·Presenter在线程重启之后能够自动restart。在`onDestroy`自动取消注册RxJava。

·最后，要保持简单明了，让每一个开发者都能够看懂。这里通过大约180行代码来驱动Presenter，230行RxJava代码来支持。
</code></pre><h2 id="使用Nuleus的例子02"><a href="#使用Nuleus的例子02" class="headerlink" title="使用Nuleus的例子02"></a>使用<a href="https://github.com/konmik/nucleus" target="_blank" rel="external">Nuleus</a>的<a href="https://github.com/konmik/MVPExamples/tree/master/example02" target="_blank" rel="external">例子02</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainPresenter</span> <span class="keyword">extends</span> <span class="title">RxPresenter</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_NAME = <span class="string">"Chuck Norris"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedState);</div><div class="line"></div><div class="line">        App.getServerAPI()</div><div class="line">            .getItems(DEFAULT_NAME.split(<span class="string">"\\s+"</span>)[<span class="number">0</span>], DEFAULT_NAME.split(<span class="string">"\\s+"</span>)[<span class="number">1</span>])</div><div class="line">            .delay(<span class="number">1</span>, TimeUnit.SECONDS)</div><div class="line">            .observeOn(AndroidSchedulers.mainThread())</div><div class="line">            .compose(<span class="keyword">this</span>.&lt;ServerAPI.Response&gt;deliverLatestCache())</div><div class="line">            .subscribe(<span class="keyword">new</span> Action1&lt;ServerAPI.Response&gt;() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(ServerAPI.Response response)</span> </span>&#123;</div><div class="line">                    getView().onItemsNext(response.items);</div><div class="line">                &#125;</div><div class="line">            &#125;, <span class="keyword">new</span> Action1&lt;Throwable&gt;() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Throwable throwable)</span> </span>&#123;</div><div class="line">                    getView().onItemsError(throwable);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@RequiresPresenter</span>(MainPresenter.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">NucleusActivity</span>&lt;<span class="title">MainPresenter</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayAdapter&lt;ServerAPI.Item&gt; adapter;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        ListView listView = (ListView)findViewById(R.id.listView);</div><div class="line">        listView.setAdapter(adapter = <span class="keyword">new</span> ArrayAdapter&lt;&gt;(<span class="keyword">this</span>, R.layout.item));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemsNext</span><span class="params">(ServerAPI.Item[] items)</span> </span>&#123;</div><div class="line">        adapter.clear();</div><div class="line">        adapter.addAll(items);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemsError</span><span class="params">(Throwable throwable)</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, throwable.getMessage(), Toast.LENGTH_LONG).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>正如你看到的，这个例子明显比前一个例子短，并且简洁。Nucleus用来创建，销毁，保存Presenter， attache 或 detached一个view到Presenter，并且把请求结果自动发送到被 attache 的View当中。</p>
<p><code>MainPresenter</code>的代码比较少是因为通过<code>deliverLatestCache()</code>操作，期延迟了数据和错误，直到view是可用的，才会把数据和错误送到view里。它把数据缓存到内存中，这样当configuration改变的时候，数据还是可用的。</p>
<p><code>MainActivity</code>的代码比较少是因为Presenter的创建由<code>NucleusActivity</code>来管理。所有你需要绑定presenter的类，只需要在类上声明<code>@RequiresPresenter(MainPresenter.class)</code>注释。</p>
<p>警告！注释！在Android世界中，如果你使用注释，这是一个很好的做法，这不会降低性能。我已Galaxy S（2010的设备）作为基准测试，处理注释只会花去0.3ms。这种注视只会发生在view中，所以我认为注释是对系统性能没有消耗的。</p>
<p>##更多例子</p>
<p>这是一个参数持久性的<a href="https://github.com/konmik/nucleus/tree/master/nucleus-example" target="_blank" rel="external">例子</a>。<a href="https://github.com/konmik/nucleus/tree/master/nucleus-example-with-tests" target="_blank" rel="external">测试列子</a>。</p>
<h2 id="deliverLatestCache-方法"><a href="#deliverLatestCache-方法" class="headerlink" title="deliverLatestCache()方法"></a><code>deliverLatestCache()</code>方法</h2><p>这是RxPresenter的一个方法，它有三种版本：</p>
<p>·<code>deliver()</code>延迟onNext，onError和onComplete到view变成可用的才会释放。当你做一次请求的时候可以使用它，例如登录到web service。<a href="http://konmik.github.io/nucleus/nucleus/presenter/RxPresenter.html#deliver(" target="_blank" rel="external">Javadoc</a>)</p>
<p>·<code>deliverLatest()</code>如果有一个新的onNext可用，将会抛弃老的onNext。如果你有数据需要更新，这将不会积累没有必要的数据。<a href="http://konmik.github.io/nucleus/nucleus/presenter/RxPresenter.html#deliverLatest(" target="_blank" rel="external">Javadoc</a>)</p>
<p>·<code>deliverLastestCache()</code>和<code>deliverLatest()</code>比较相似，它保存最后一次数据在内存中，当另一个view变成可用的（例如：configuration 改变），它将重新发送数据到view。如果你不想save/restore请求结果到你的view中（返回结果比较大或者不方便存储到Bundle中），这个方法将允许你去做出更好的用户体验。<a href="http://konmik.github.io/nucleus/nucleus/presenter/RxPresenter.html#deliverLatestCache(" target="_blank" rel="external">Javadoc</a>)</p>
<h2 id="Presenter的生命周期"><a href="#Presenter的生命周期" class="headerlink" title="Presenter的生命周期"></a>Presenter的生命周期</h2><p>Presenter的生命周期与Android的控件相比，明显少一些。</p>
<p>·<code>void onCreate(Bundle savedState)</code> - 当Presenter被创建的时候会被调用。<a href="http://konmik.github.io/nucleus/nucleus/presenter/Presenter.html#onCreate(android.os.Bundle" target="_blank" rel="external">Javadoc</a>)</p>
<p>·<code>void onDestroy()</code> - 离开view的时候会被调用。<a href="http://konmik.github.io/nucleus/nucleus/presenter/Presenter.html#onDestroy(" target="_blank" rel="external">Javadoc</a>)</p>
<p>·<code>void onSave(Bundle state)</code> - 当View的<code>onSaveInstanceState</code>被调用时会调用，保持Presenter的状态。<a href="http://konmik.github.io/nucleus/nucleus/presenter/Presenter.html#onTakeView(ViewType" target="_blank" rel="external">Javadoc</a>)</p>
<p>·<code>void onTakeView(ViewType view)</code> -在Activity或者Fragment调用<code>onResume()</code>，或者在<code>android.view.View#onAttachedToWindow()</code>期间。 <a href="http://konmik.github.io/attachenucleus/nucleus/presenter/Presenter.html#onTakeView(ViewType" target="_blank" rel="external">Javadoc</a>)</p>
<p>·<code>void onDropView()</code> - Activity或者Fragment调用<code>onPause()</code>，或者在<code>android.view.View#onDetachedFromWindow()</code>期间。<a href="http://konmik.github.io/nucleus/nucleus/presenter/Presenter.html#onDropView(" target="_blank" rel="external">Javadoc</a>)</p>
<h2 id="View回收和View栈"><a href="#View回收和View栈" class="headerlink" title="View回收和View栈"></a>View回收和View栈</h2><p>通常你的view（Fragment和自定义view）在与用户的交互下随机 attache 和 detached。每次view被 detached的时候不去销毁Presenter，这可能是一个好主意。你可以任何时间 detached和 attache view，presenter会比这些动作活的更持久，继续后台的工作。</p>
<p>联想到view的回收，有个问题：fragment无法知道是否因为配置改变或者被弹出栈被 detached。</p>
<p>Nucleus的意见是：销毁presenter只能发生在view的<code>onDetachedFromWindow()/onDestroy()</code>并且activity是finish的。所以，如果你销毁view是在正常的activity生命周期，你可发出信号来通知presenter也应该被销毁。这里有两个方法可以用<code>NucleusLayout.destroyPresenter()</code>和<code>NucleusFragment.destroyPresenter()</code>。</p>
<p>举个例子，下面是我在我的项目里面如何管理Fragment <code>pop()</code>操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">fragment = fragmentManager.findFragmentById(R.id.fragmentStackContainer);</div><div class="line">   fragmentManager.popBackStackImmediate();</div><div class="line">   <span class="keyword">if</span> (fragment <span class="keyword">instanceof</span> NucleusFragment)</div><div class="line">       ((NucleusFragment)fragment).destroyPresenter();</div></pre></td></tr></table></figure>
<p>你可以对replace Fragment做类似的操作。压栈操作的时候也可以。</p>
<p>每次view从Activity detached的时候，你可以决定去销毁presenter来避免这个问题，但是你也将在view被detach的时候失去后台任务。</p>
<p>因此，view回收这部分，完全取决于你。也许，我会找到更好的解决方案，如果你知道，请告诉我。</p>
<h1 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h1><h2 id="把你的请求参数放在Presenter里"><a href="#把你的请求参数放在Presenter里" class="headerlink" title="把你的请求参数放在Presenter里"></a>把你的请求参数放在Presenter里</h2><p>这个规则很简单：主要是为了管理请求。所以view自己不应该掌控和重启请求。从View的角度来看，后台任务，永远不会消失，不需要任何回调也会返回一个结果或错误。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainPresenter</span> <span class="keyword">extends</span> <span class="title">RxPresenter</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String name = DEFAULT_NAME;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedState);</div><div class="line">        <span class="keyword">if</span> (savedState != <span class="keyword">null</span>)</div><div class="line">            name = savedState.getString(NAME_KEY);</div><div class="line">        ...</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSave</span><span class="params">(@NonNull Bundle state)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onSave(state);</div><div class="line">        state.putString(NAME_KEY, name);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>我建议使用<a href="https://github.com/frankiesardo/icepick" target="_blank" rel="external">Icepick</a>library。无需使用注解，就可以减少代码量，并且简化应用逻辑——这一切都发生在编译过程中。可以配合<a href="http://jakewharton.github.io/butterknife" target="_blank" rel="external">ButterKnife</a>使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainPresenter</span> <span class="keyword">extends</span> <span class="title">RxPresenter</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Icicle</span> String name = DEFAULT_NAME;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedState);</div><div class="line">        Icepick.restoreInstanceState(<span class="keyword">this</span>, savedState);</div><div class="line">        ...</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSave</span><span class="params">(@NonNull Bundle state)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onSave(state);</div><div class="line">        Icepick.saveInstanceState(<span class="keyword">this</span>, state);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>如果你有超过2个的请求参数，这个library会存储它们。你可以创建一个<code>BasePresenter</code>，并且把Icepick放在类里，这样所有的子类将会获得<code>@Icicle</code>，无需再次实现<code>onSave</code>。这也工作在activity，Fragment和view。</p>
<h2 id="在onTakeView主线程中，执行一个即时查询Javadoc"><a href="#在onTakeView主线程中，执行一个即时查询Javadoc" class="headerlink" title="在onTakeView主线程中，执行一个即时查询Javadoc)"></a>在onTakeView主线程中，执行一个即时查询<a href="http://konmik.github.io/nucleus/nucleus/presenter/Presenter.html#onTakeView(ViewType" target="_blank" rel="external">Javadoc</a>)</h2><p>有时候，你要查询一段小数据，例如从数据库中读取一小段数据。虽然你可以用Nucleus简单的创建一个请求，但是你不必到处使用Nucleus。如果在一个Fragment创建的过程中创建一个后台请求，用户会看到一个空白屏幕一小会儿，尽管这个请求就几毫秒。因此，为了是代码更简短，更友善，使用主线程吧。</p>
<h2 id="不要尝试用Presenter控制你的View"><a href="#不要尝试用Presenter控制你的View" class="headerlink" title="不要尝试用Presenter控制你的View"></a>不要尝试用Presenter控制你的View</h2><p>这么做不是个好方式——应用的逻辑会变得更复杂，这是不正常的方式。</p>
<p>正常的方式是，控制流应该是从用户，通过View，到Presenter，再到Model。用户是控制应用程序的一个来源。因此我们的控制流应该是从用户开始，而不是从应用的内部的结构。</p>
<p>当控制流是从View到Presenter，然后Presenter到Model，这是一个线性流，这样很好写代码。这样你得到了一个简单的序列，user-&gt;view-&gt;presenter-&gt;model-&gt;data。但是，当控制流是这个样子的：user-&gt;view-&gt;presenter-&gt;view-&gt;presenter-&gt;model-&gt;data，这只是违反了KISS原则。</p>
<p>Fragment？是的，Fragment有时候会违反正常的控制流。他们太复杂了。这里有一篇不错的文章，关于思考Fragment：<a href="http://corner.squareup.com/2014/10/advocating-against-android-fragments.html" target="_blank" rel="external">Advocating Against Android Fragments</a>。但是<a href="https://github.com/square/flow" target="_blank" rel="external">Flow</a>也没有简化太多。</p>
<h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><p>如果你熟悉MVC，别用了。MVC完全不同于MVP，MVC并没有解决开发面临的问题。</p>
<p>什么是MVC？</p>
<pre><code>·Model应用内部的逻辑部分。负责数据存储。
·View唯一和MVP共同的部分，应用中呈现到屏幕的部分。
·Controller输入设备，例如键盘，鼠标，操纵杆。
</code></pre><p>当你有一台电脑和一个用键盘简单驱动的游戏的时候，MVC出现有很长一段时间了。没有windows，没有图形交互界面，应用程序接收输入（Controller），维持一些状态（Model），产生输出（View）。控制流是这样的：Controller-&gt;Model-&gt;View。这种模式绝对不能用在Android中。</p>
<p>有很多混淆的MVC模式。人们相信他们使用的是MVC，实际上他们可能用的是MVP（Web开发）。很多Android开发，认为Controller就是控制View，因此他们尝试抽取View的逻辑代码来减少View的代码，用Controller来控制View。我个人没看到这种方式有任何好处。</p>
<h2 id="使用不可变数据结构的复杂关系数据库项目"><a href="#使用不可变数据结构的复杂关系数据库项目" class="headerlink" title="使用不可变数据结构的复杂关系数据库项目"></a>使用不可变数据结构的复杂关系数据库项目</h2><p><a href="https://github.com/google/auto/tree/master/value" target="_blank" rel="external">AutoValue</a>是一个这样的library，在它的描述中写了一堆好处，我推荐看看它。<a href="https://github.com/frankiesardo/auto-parcel" target="_blank" rel="external">AutoParcel</a>是AutoValue一个Android项目。使用的主要原因是，不用改变对象，通过AutoParcel转换，而不用关心其影响了应用程序的其他部分。他们都是线程安全的。</p>
<h1 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h1><p>尝试MVP，并且分享给你的朋友。：）</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这篇文章是我学习MVP模式时翻译的，原文是&lt;a href=&quot;http://konmik.github.io/author/konstantin-mikheev.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Konstantin Mikheev&lt;/
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
      <category term="MVP" scheme="http://www.kennethyo.me/tags/MVP/"/>
    
  </entry>
  
  <entry>
    <title>[原]Android获取运营商</title>
    <link href="http://www.kennethyo.me/2015/05/08/2015-05-08/"/>
    <id>http://www.kennethyo.me/2015/05/08/2015-05-08/</id>
    <published>2015-05-08T08:40:08.000Z</published>
    <updated>2016-09-01T06:39:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>今天接到一个新需求，要给服务器上送设备运营商名称，之后我的第一反应是，umeng都无法精确统计运营商，我如何判断上送具体的运营商呢？如下图：</p>
<p><img src="http://img.blog.csdn.net/20150508163804803" alt="这里写图片描述"></p>
<p>这张图里反映了友盟统计到用户手机的运营商名称，这些名称什么样子的都有。有什么办法精确判断具体是什么运营商呢？比如，只返回“中国移动”，“中国联通”，“中国电信”。</p>
<p>我这里解决的方案是通过设备的MCC/MNC代码来判断。</p>
<p>首先，我们要了解MCC/MNC是什么，请看<a href="http://zh.wikipedia.org/wiki/%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%A0%81" target="_blank" rel="external">WIKI百科</a>。通过阅读，我们能够知道，只要对比MCC/MNC编码，就能知道具体是什么运营商了。</p>
<p>其次，就是具体代码了，如下：</p>
<pre><code>&lt;span class=&quot;hljs-javadoc&quot;&gt;/**
     * 返回运营商 需要加入权限 &amp;lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot;/&amp;gt; &amp;lt;BR&amp;gt;
     *
     *&lt;span class=&quot;hljs-javadoctag&quot;&gt; @return&lt;/span&gt; 1,代表中国移动，2，代表中国联通，3，代表中国电信，0，代表未知
     *&lt;span class=&quot;hljs-javadoctag&quot;&gt; @author&lt;/span&gt; youzc@yiche.com
     */&lt;/span&gt;
 &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;getOperators&lt;/span&gt;(Context context) {
        &lt;span class=&quot;hljs-comment&quot;&gt;// 移动设备网络代码（英语：Mobile Network Code，MNC）是与移动设备国家代码（Mobile Country Code，MCC）（也称为“MCC /&lt;/span&gt;
        &lt;span class=&quot;hljs-comment&quot;&gt;// MNC”）相结合, 例如46000，前三位是MCC，后两位是MNC 获取手机服务商信息&lt;/span&gt;
        &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; OperatorsName = &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;
        String IMSI =  (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE).getSubscriberId();
        &lt;span class=&quot;hljs-comment&quot;&gt;// IMSI号前面3位460是国家，紧接着后面2位00 运营商代码&lt;/span&gt;
        System.out.println(IMSI);
        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (IMSI.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;46000&quot;&lt;/span&gt;) || IMSI.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;46002&quot;&lt;/span&gt;) || IMSI.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;46007&quot;&lt;/span&gt;)) {
            OperatorsName = &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;
        } &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (IMSI.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;46001&quot;&lt;/span&gt;) || IMSI.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;46006&quot;&lt;/span&gt;)) {
            OperatorsName = &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;;
        } &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (IMSI.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;46003&quot;&lt;/span&gt;) || IMSI.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;46005&quot;&lt;/span&gt;)) {
            OperatorsName = &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;
        }
        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; OperatorsName;
    }
</code></pre><p>通过客户端本地比对MCC/MNC确定运营商这种方式，本身我是不赞同的，我认为把MCC/MNC上送到服务器，由服务器判断这才是最优方案。因为应用打好包分发出去，代码就是死的，未来不可以扩展比对，但是服务器是可以动态的，随时配置比对的MCC/MNC编码。</p>
<pre><code>&lt;div&gt;
    作者：zh08070005 发表于2015/5/8 16:40:08 [原文链接](http://blog.csdn.net/kennethyo/article/details/45582153)
&lt;/div&gt;
&lt;div&gt;
阅读：814 评论：0 [查看评论](http://blog.csdn.net/kennethyo/article/details/45582153#comments)
&lt;/div&gt;
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天接到一个新需求，要给服务器上送设备运营商名称，之后我的第一反应是，umeng都无法精确统计运营商，我如何判断上送具体的运营商呢？如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150508163804803&quot; alt=&quot;
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>[原]WebView填坑——小功能篇</title>
    <link href="http://www.kennethyo.me/2015/04/22/2015-04-22-16-31-06/"/>
    <id>http://www.kennethyo.me/2015/04/22/2015-04-22-16-31-06/</id>
    <published>2015-04-22T08:31:06.000Z</published>
    <updated>2017-03-06T11:06:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>这两天负责修改了几个关于在webview中打开公司移动站的bug。本身不是很难解，网上查查都有，但是也有必要记录下来作为备忘。</p>
<h3 id="Webview中上传文件"><a href="#Webview中上传文件" class="headerlink" title="Webview中上传文件"></a>Webview中上传文件</h3><p>这里的效果类似在pc端上传文件效果，点击打开一个文件选择器，上传文件图片之类的。</p>
<p><code>openFileChooser（）</code>方法的重载是因为在不同系统中调用的方法参数不一样，具体看注释。</p>
<p><code>ValueCallback&amp;lt;Uri&amp;gt; mUploadMessage</code>作为成员变量的目的是我们要在打开的系统文件选择器<code>finish()</code>后在<code>onActivityResult()</code>时调用。</p>
<p>具体实现代码如下：</p>
<pre><code>&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;initWebView&lt;/span&gt;(){
    webView.setWebChromeClient(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; MyWebChromeClient());
}

 &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; ValueCallback&amp;lt;Uri&amp;gt; mUploadMessage;
&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyWebChromeClient&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WebChromeClient&lt;/span&gt; {&lt;/span&gt;

    &lt;span class=&quot;hljs-comment&quot;&gt;// js上传文件的&amp;lt;input type=&quot;file&quot; /&amp;gt;事件捕获&lt;/span&gt;
    &lt;span class=&quot;hljs-comment&quot;&gt;// Android &amp;gt; 4.1.1 调用这个方法&lt;/span&gt;
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;openFileChooser&lt;/span&gt;(ValueCallback&amp;lt;Uri&amp;gt; uploadMsg, String acceptType, String capture) {
      mUploadMessage = uploadMsg;

      Intent intent = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Intent(Intent.ACTION_GET_CONTENT);
      intent.addCategory(Intent.CATEGORY_OPENABLE);
      intent.setType(TextUtils.isEmpty(acceptType) ? &lt;span class=&quot;hljs-string&quot;&gt;&quot;image/*&quot;&lt;/span&gt; : acceptType);

      MobileSiteActivity.&lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;.startActivityForResult(
          Intent.createChooser(intent, ToolBox.getString(R.string.web_activity_please_chooser)),
          MobileSiteActivity.FILECHOOSER_RESULTCODE);

    }

    &lt;span class=&quot;hljs-comment&quot;&gt;// 3.0 + 调用这个方法&lt;/span&gt;
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;openFileChooser&lt;/span&gt;(ValueCallback&amp;lt;Uri&amp;gt; uploadMsg, String acceptType) {
      openFileChooser(uploadMsg, acceptType, &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);
    }

    &lt;span class=&quot;hljs-comment&quot;&gt;// Android &amp;lt; 3.0 调用这个方法&lt;/span&gt;
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;openFileChooser&lt;/span&gt;(ValueCallback&amp;lt;Uri&amp;gt; uploadMsg) {
      openFileChooser(uploadMsg, &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;);
    }
  }
  &lt;span class=&quot;hljs-annotation&quot;&gt;@Override&lt;/span&gt;
  &lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;onActivityResult&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; requestCode, &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; resultCode, Intent data) {
    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (FILECHOOSER_RESULTCODE == requestCode) {
      &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt; == mUploadMessage) &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;;
      Uri result = data == &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt; || resultCode != RESULT_OK ? &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt; : data.getData();
      mUploadMessage.onReceiveValue(result);
      mUploadMessage = &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;;
    }
  }
`&lt;/pre&gt;

### WebView当中网页中的地图为白色，不显示地图

这个问题其实就是你没有打开Javascript支持。打开就好啦~

&lt;pre class=&quot;prettyprint&quot;&gt;`webView.setJavaScriptEnabled(&lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;);&lt;span class=&quot;hljs-comment&quot;&gt;// 设置支持javascript脚本&lt;/span&gt;`&lt;/pre&gt;

### WebView中跳转系统拨号键盘

举一反三，既然要打开系统拨号键盘，那邮箱，地图也可以支持。

&lt;pre class=&quot;prettyprint&quot;&gt;`webView.setWebViewClient(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; WebViewClient() {
      &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;shouldOverrideUrlLoading&lt;/span&gt;(WebView view, String url) {

        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (url.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;mailto:&quot;&lt;/span&gt;) || url.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;geo:&quot;&lt;/span&gt;) || url.startsWith(&lt;span class=&quot;hljs-string&quot;&gt;&quot;tel:&quot;&lt;/span&gt;)) {
          Intent intent = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Intent(Intent.ACTION_VIEW, Uri.parse(url));
          startActivity(intent);
          &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;;
        }
        view.loadUrl(url);
        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;;
      }
    });`&lt;/pre&gt;

### WebView中支持下载

这里要给WebView设置一个下载监听，监听会回调给你下载地址，这里可以打开系统浏览器去激活下载，用DownloadManger直接去下载也可以，我选择的是第一种方式，这种方式我认为比较符合用户习惯哈。

&lt;pre class=&quot;prettyprint&quot;&gt;` webView.setDownloadListener(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; MyWebViewDownLoadListener());`&lt;/pre&gt;

&lt;pre class=&quot;prettyprint&quot;&gt;`
 &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyWebViewDownLoadListener&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;DownloadListener&lt;/span&gt; {&lt;/span&gt;

    &lt;span class=&quot;hljs-annotation&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;onDownloadStart&lt;/span&gt;(String url, String userAgent, String contentDisposition,
        String mimetype, &lt;span class=&quot;hljs-keyword&quot;&gt;long&lt;/span&gt; contentLength) {

      &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt; != url) {
        Uri uri = Uri.parse(url);
        Intent intent = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Intent(Intent.ACTION_VIEW, uri);
        startActivity(intent);
      }
    }

  }

        &lt;div&gt;
            作者：zh08070005 发表于2015/4/22 16:31:06 [原文链接](http://blog.csdn.net/kennethyo/article/details/45196891)
        &lt;/div&gt;
        &lt;div&gt;
        阅读：521 评论：0 [查看评论](http://blog.csdn.net/kennethyo/article/details/45196891#comments)
        &lt;/div&gt;
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这两天负责修改了几个关于在webview中打开公司移动站的bug。本身不是很难解，网上查查都有，但是也有必要记录下来作为备忘。&lt;/p&gt;
&lt;h3 id=&quot;Webview中上传文件&quot;&gt;&lt;a href=&quot;#Webview中上传文件&quot; class=&quot;headerlink&quot; titl
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>[原]Android程序猿如何泡设计妹之快速掌握dp和px才可以</title>
    <link href="http://www.kennethyo.me/2015/01/25/2015-01-25/"/>
    <id>http://www.kennethyo.me/2015/01/25/2015-01-25/</id>
    <published>2015-01-25T14:44:22.000Z</published>
    <updated>2016-09-01T06:35:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>相信很多Android程序猿已经对身边的设计妹垂涎三尺了，那么如何博得设计妹的好感呢，学好这篇文章就可以了。</p>
<p>程序猿与UI设计妹讨论设计稿和切图的时候，经常会因为dp和px的问题搞的不愉快，这里可以分析出两个原因：</p>
<p>1，程序猿原因，不懂dp和px的换算关系。包括我，以及我见到的大多数开发，更多的时候其实不是很关心dp和px是如何来的，以及如何转换的，只知道掌握一般情况用dp，字体大小用sp，画线用px。</p>
<p>2，设计妹原因，设计不出dp标注，或者甚至就不懂dp是什么东东。大多数公司并不会为Android专门做一套设计稿，只会出一版iOS设计稿，而iOS的设计稿都是用px去标注的，又因为上面的第一个原因，Android程序猿也搞不明白标注的px应该用多少dp。</p>
<p>下面我们就用简单的方式去增进程序猿和设计妹感情吧！</p>
<p>首先，我们要了解这张图：</p>
<p><img src="http://img.blog.csdn.net/20150125224509843?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VubmV0aHlv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>这里面列举了目前Android开发常见的5种dpi，dpi是指每英寸的像素（例如：一个宽是1.5英寸240像素，高是2英寸320像素的手机的dpi是：240px/1.5in=320px/2in=160dpi，既对角线上的每英寸的像素），上面这张表里还少一种，就是LDPI，是MDPI的0.75倍，也就是120DPI。</p>
<p>下面这张图是各种dpi对应的主流手机屏幕：</p>
<p><img src="http://img.blog.csdn.net/20150125224550469?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VubmV0aHlv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>请按照图中下方的公式，分别计算一下屏幕dpi。在mdpi中，dp/pixel = DPI/160，即1dip等价于DPI为160的设备中的1个像素点。那么在xhdpi 320dpi中，就是1dp等价于2像素（再次强调，一定用计算器算一算啊，还有dpi是对角线上的像素密度）。</p>
<p>一般情况设计妹出的图会是xhdpi，既能照顾iOS，又会照顾到Android。既然是xhdpi，我们就可以用1dp=2px来应对设计妹的标注。如果不是xhdpi的图，你也可以按照这个0.75:1:1.5:2:3:4这个比例去换算一下。</p>
<p>帮到这里了，剩下的还得看你的修为了。</p>
<p>下面我再给出几个常用的&#20540;：</p>
<p>Launcher icon：48dp*48dp</p>
<p>Action bar icons：32dp*32dp</p>
<p>Small icons：16dp*16dp</p>
<p>Notification icons：24dp*24dp</p>
<p>如果这些你还不满意，再给你来张图，包你满意：</p>
<p><img src="http://img.blog.csdn.net/20150125224602388?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VubmV0aHlv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>内容参考与网络和<a href="http://developer.android.com/guide/practices/screens_support.html#range" target="_blank" rel="external">Android.com</a></p>
<p>如果打不开的话请看这里<a href="http://www.kennethyo.me/post/category/cheng-xu-yuan-de-wu-qi-zhi-vpn">《程序员的武器之一VPN》</a></p>
<pre><code>&lt;div&gt;
    作者：zh08070005 发表于2015/1/25 22:44:22 [原文链接](http://blog.csdn.net/kennethyo/article/details/43123731)
&lt;/div&gt;
&lt;div&gt;
阅读：1117 评论：0 [查看评论](http://blog.csdn.net/kennethyo/article/details/43123731#comments)
&lt;/div&gt;
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;相信很多Android程序猿已经对身边的设计妹垂涎三尺了，那么如何博得设计妹的好感呢，学好这篇文章就可以了。&lt;/p&gt;
&lt;p&gt;程序猿与UI设计妹讨论设计稿和切图的时候，经常会因为dp和px的问题搞的不愉快，这里可以分析出两个原因：&lt;/p&gt;
&lt;p&gt;1，程序猿原因，不懂dp和px
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>[原]CardView初级使用</title>
    <link href="http://www.kennethyo.me/2014/12/28/2014-12-28/"/>
    <id>http://www.kennethyo.me/2014/12/28/2014-12-28/</id>
    <published>2014-12-28T06:08:54.000Z</published>
    <updated>2016-09-01T06:35:27.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>CardView</code>发布于android sdk v7的支持包中，具体如何将项目加入v7包，请看这里<a href="http://kennethyo.farbox.com/post/android/recyclerviewchu-ji-shi-yong#main" target="_blank" rel="external">传送门</a>。</p>
<p>卡片化是全新的Material风&#26684;设计中重要的组成部分之一，卡片设计适合重要信息的展示，以及在list中作为一个包含有复杂操作的item使用。</p>
<p><code>CardView</code>继承于<code>Framelayout</code>，比<code>FrameLayout</code>多了3个重要的属性，<code>card_view:cardElevation</code>，<code>card_view:cardCornerRadius</code>，<code>card_view:cardBackgroundColor</code>。</p>
<p><code>card_view:cardElevation</code>，可以设置卡片的阴影，可以使<code>CardView</code>在z轴方向上有一种抬升的视觉效果，能给用户一种这里是重要信息的视觉感受。对应代码里的方法<code>public
 void setCardElevation (float radius)</code>。</p>
<p><code>card_view:cardCornerRadius</code>，显然就是设置<code>CardView</code>的圆角了。对应代码里的方法<code>public
 void setRadius (float radius)</code>。</p>
<p><code>card_view:cardBackgroundColor</code>，设置<code>CardView</code>的背景颜色，这个属性是不会影响阴影<code>card_view:cardElevation</code>的效果的。对应代码里的方法<code>public
 void setCardBackgroundColor (int color)</code>。</p>
<div class="codehilite" style="color:rgb(102,102,102); font-family:Helvetica,arial,'Hiragino Sans GB','Microsoft Yahei',Verdana,Arial,sans-serif; font-size:15px; line-height:30px; background-color:rgb(253,253,253)"><br><pre style="margin-top:1.6em; margin-bottom:1.6em; border:1px solid rgb(227,237,243); width:910px; padding:10px; font-family:Inconsolata,monospace,sans-serif; font-size:0.9em; overflow:auto; word-break:break-word; color:rgb(253,206,147); background:rgb(63,63,63)"><span class="nt" style="color:rgb(154,195,159)">&lt;android.support.v7.widget.CardView</span><br><span class="na" style="color:rgb(154,195,159)">android:id=</span><span class="s" style="color:rgb(204,147,147)">&quot;@&#43;id/cardview&quot;</span><br><span class="na" style="color:rgb(154,195,159)">android:layout_width=</span><span class="s" style="color:rgb(204,147,147)">&quot;fill_parent&quot;</span><br><span class="na" style="color:rgb(154,195,159)">android:layout_height=</span><span class="s" style="color:rgb(204,147,147)">&quot;wrap_content&quot;</span><br><span class="na" style="color:rgb(154,195,159)">card_view:cardElevation=</span><span class="s" style="color:rgb(204,147,147)">&quot;100dp&quot;</span><br><span class="na" style="color:rgb(154,195,159)">card_view:cardBackgroundColor=</span><span class="s" style="color:rgb(204,147,147)">&quot;@color/grey&quot;</span><br><span class="na" style="color:rgb(154,195,159)">card_view:cardCornerRadius=</span><span class="s" style="color:rgb(204,147,147)">&quot;8dp&quot;</span><br><span class="na" style="color:rgb(154,195,159)">android:layout_marginLeft=</span><span class="s" style="color:rgb(204,147,147)">&quot;@dimen/margin&quot;</span><br><span class="na" style="color:rgb(154,195,159)">android:layout_marginRight=</span><span class="s" style="color:rgb(204,147,147)">&quot;@dimen/margin&quot;</span><br><span class="nt" style="color:rgb(154,195,159)">&gt;</span><br>                <span class="nt" style="color:rgb(154,195,159)">&lt;TextView</span><br>                <span class="na" style="color:rgb(154,195,159)">android:layout_width=</span><span class="s" style="color:rgb(204,147,147)">&quot;wrap_content&quot;</span><br>                <span class="na" style="color:rgb(154,195,159)">android:layout_height=</span><span class="s" style="color:rgb(204,147,147)">&quot;wrap_content&quot;</span><br>                <span class="na" style="color:rgb(154,195,159)">android:layout_margin=</span><span class="s" style="color:rgb(204,147,147)">&quot;@dimen/margin&quot;</span><br>                <span class="na" style="color:rgb(154,195,159)">android:text=</span><span class="s" style="color:rgb(204,147,147)">&quot;这里是CardView&quot;</span><br>                <span class="nt" style="color:rgb(154,195,159)">/&gt;</span><br><span class="nt" style="color:rgb(154,195,159)">&lt;/android.support.v7.widget.CardView&gt;</span><br></pre><br></div>

<p>这里贴一个Android官方给的<a href="https://github.com/googlesamples/android-CardView" target="_blank" rel="external">sample</a>吧!</p>
<p>—————————————</p>
<p>从11月19日开始一直在加班，把大把的时间都用于了我们岁末版本的开发上，这期间规划了好几篇想要写的博文，慢慢会发出来的，主要还是偏于介绍新控件的使用，以及如何兼容lollipop以下版本进行material风&#26684;的设计，material风&#26684;设计也将会是我所在项目组15年第一季度android的全新设计方案。</p>
<p><span style="color:rgb(221,17,68); font-family:Inconsolata,monospace,sans-serif; line-height:30px; white-space:pre-wrap; background-color:rgb(247,247,249)">（转载请注明出处：<a href="http://kennethyo.farbox.com/post/android/2014-12-28）" target="_blank" rel="external">http://kennethyo.farbox.com/post/android/2014-12-28）</a></span></p>
<pre><code>&lt;div&gt;
    作者：zh08070005 发表于2014/12/28 14:08:54 [原文链接](http://blog.csdn.net/kennethyo/article/details/42213525)
&lt;/div&gt;
&lt;div&gt;
阅读：2090 评论：0 [查看评论](http://blog.csdn.net/kennethyo/article/details/42213525#comments)
&lt;/div&gt;
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;CardView&lt;/code&gt;发布于android sdk v7的支持包中，具体如何将项目加入v7包，请看这里&lt;a href=&quot;http://kennethyo.farbox.com/post/android/recyclerviewchu-ji-shi-yon
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
      <category term="View" scheme="http://www.kennethyo.me/tags/View/"/>
    
  </entry>
  
  <entry>
    <title>[原]RecyclerView初级使用</title>
    <link href="http://www.kennethyo.me/2014/11/10/2014-11-10/"/>
    <id>http://www.kennethyo.me/2014/11/10/2014-11-10/</id>
    <published>2014-11-10T07:18:15.000Z</published>
    <updated>2016-09-01T06:35:08.000Z</updated>
    
    <content type="html"><![CDATA[<p><span style="font-family:Inconsolata,monospace,sans-serif; font-size:12px; color:#dd1144"><span style="white-space:pre-wrap; background-color:rgb(247,247,249)">（转载请注明出处：<a href="http://www.kennethyo.me/post/android/recyclerviewchu-ji-shi-yong）">http://www.kennethyo.me/post/android/recyclerviewchu-ji-shi-yong）</a></span></span></p>
<p><code>RecyclerView</code>是Android在v7包中包含了一个新的widget，<code>RecyclerView</code>是一个<code>ListView</code>进阶版，但不继承与<code>AdapterView</code>，相比<code>ListView</code>，<code>RecyclerView</code>更加灵活和先进。</p>
<p>##<br>1，导入RecyclerView</p>
<p>首先要保证<code>SDK Tools</code>和<code>Android
 Support Repository</code>为最新版。如下图：</p>
<p><img src="http://img.blog.csdn.net/20141110151947150?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VubmV0aHlv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p><img src="http://img.blog.csdn.net/20141110152010581?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VubmV0aHlv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>其次，在你的demo工程里选中Project Structure按钮，并且选择app —— Dependencies —— “&#43;” —— Library dependency，去添加支持包，如下图：</p>
<p><img src="http://img.blog.csdn.net/20141110152138031?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VubmV0aHlv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>最后，在新的对话框里选中<code>com.android.support:recyclerview-v7:21.0.0</code>，点击OK。如下图：</p>
<p><img src="http://img.blog.csdn.net/20141110152155781?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VubmV0aHlv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>这里就顺利的导入了<code>RecyclerView</code>。</p>
<p>##<br>2，使用<code>RecyclerView</code></p>
<p>在布局文件中使用<code>RecyclerView</code>，跟其他自定义控件一样，如下：</p>
<div class="codehilite" style="color:rgb(102,102,102); font-family:Helvetica,arial,'Hiragino Sans GB','Microsoft Yahei',Verdana,Arial,sans-serif; font-size:15px; line-height:30px; background-color:rgb(253,253,253)"><br><pre style="margin-top:1.6em; margin-bottom:1.6em; border:1px solid rgb(227,237,243); width:910px; padding:10px; font-family:Inconsolata,monospace,sans-serif; font-size:0.9em; overflow:auto; word-break:break-word; color:rgb(253,206,147); background:rgb(63,63,63)"><span class="nt" style="color:rgb(154,195,159)">&lt;RelativeLayout</span> <span class="na" style="color:rgb(154,195,159)">xmlns:android=</span><span class="s" style="color:rgb(204,147,147)">&quot;<a href="http://schemas.android.com/apk/res/android&amp;quot" target="_blank" rel="external">http://schemas.android.com/apk/res/android&amp;quot</a>;</span><br>    <span class="na" style="color:rgb(154,195,159)">xmlns:tools=</span><span class="s" style="color:rgb(204,147,147)">&quot;<a href="http://schemas.android.com/tools&amp;quot" target="_blank" rel="external">http://schemas.android.com/tools&amp;quot</a>;</span><br>    <span class="na" style="color:rgb(154,195,159)">android:layout_width=</span><span class="s" style="color:rgb(204,147,147)">&quot;match_parent&quot;</span><br>    <span class="na" style="color:rgb(154,195,159)">android:layout_height=</span><span class="s" style="color:rgb(204,147,147)">&quot;match_parent&quot;</span><br>    <span class="na" style="color:rgb(154,195,159)">tools:context=</span><span class="s" style="color:rgb(204,147,147)">&quot;.MainActivity&quot;</span><span class="nt" style="color:rgb(154,195,159)">&gt;</span><br><br>    <span class="nt" style="color:rgb(154,195,159)">&lt;android.support.v7.widget.RecyclerView</span><br>        <span class="na" style="color:rgb(154,195,159)">android:id=</span><span class="s" style="color:rgb(204,147,147)">&quot;@&#43;id/recyclerView&quot;</span><br>        <span class="na" style="color:rgb(154,195,159)">android:layout_width=</span><span class="s" style="color:rgb(204,147,147)">&quot;match_parent&quot;</span><br>        <span class="na" style="color:rgb(154,195,159)">android:layout_height=</span><span class="s" style="color:rgb(204,147,147)">&quot;match_parent&quot;</span> <span class="nt" style="color:rgb(154,195,159)">/&gt;</span><br><span class="nt" style="color:rgb(154,195,159)">&lt;/RelativeLayout&gt;</span><br></pre><br></div>

<p>因为日常开发中，我们大多数都是按照UI去布局每个item，所以这里我没与图省事用Android自带的布局。如下：</p>
<div class="codehilite" style="color:rgb(102,102,102); font-family:Helvetica,arial,'Hiragino Sans GB','Microsoft Yahei',Verdana,Arial,sans-serif; font-size:15px; line-height:30px; background-color:rgb(253,253,253)"><br><pre style="margin-top:1.6em; margin-bottom:1.6em; border:1px solid rgb(227,237,243); width:910px; padding:10px; font-family:Inconsolata,monospace,sans-serif; font-size:0.9em; overflow:auto; word-break:break-word; color:rgb(253,206,147); background:rgb(63,63,63)"><span class="cp" style="color:rgb(127,159,127)">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="nt" style="color:rgb(154,195,159)">&lt;LinearLayout</span> <span class="na" style="color:rgb(154,195,159)">xmlns:android=</span><span class="s" style="color:rgb(204,147,147)">&quot;<a href="http://schemas.android.com/apk/res/android&amp;quot" target="_blank" rel="external">http://schemas.android.com/apk/res/android&amp;quot</a>;</span><br>    <span class="na" style="color:rgb(154,195,159)">android:layout_width=</span><span class="s" style="color:rgb(204,147,147)">&quot;match_parent&quot;</span><br>    <span class="na" style="color:rgb(154,195,159)">android:layout_height=</span><span class="s" style="color:rgb(204,147,147)">&quot;match_parent&quot;</span><span class="nt" style="color:rgb(154,195,159)">&gt;</span><br><br>        <span class="nt" style="color:rgb(154,195,159)">&lt;TextView</span><br>            <span class="na" style="color:rgb(154,195,159)">android:id=</span><span class="s" style="color:rgb(204,147,147)">&quot;@&#43;id/textView&quot;</span><br>            <span class="na" style="color:rgb(154,195,159)">android:layout_width=</span><span class="s" style="color:rgb(204,147,147)">&quot;match_parent&quot;</span><br>            <span class="na" style="color:rgb(154,195,159)">android:layout_height=</span><span class="s" style="color:rgb(204,147,147)">&quot;48dp&quot;</span><br>            <span class="na" style="color:rgb(154,195,159)">android:textStyle=</span><span class="s" style="color:rgb(204,147,147)">&quot;bold&quot;</span><br>            <span class="na" style="color:rgb(154,195,159)">android:background=</span><span class="s" style="color:rgb(204,147,147)">&quot;@android:color/holo_blue_light&quot;</span><br>            <span class="na" style="color:rgb(154,195,159)">android:textColor=</span><span class="s" style="color:rgb(204,147,147)">&quot;@android:color/holo_red_light&quot;</span><br>            <span class="na" style="color:rgb(154,195,159)">android:gravity=</span><span class="s" style="color:rgb(204,147,147)">&quot;center_vertical&quot;</span><br>            <span class="na" style="color:rgb(154,195,159)">android:paddingLeft=</span><span class="s" style="color:rgb(204,147,147)">&quot;@dimen/activity_horizontal_margin&quot;</span><br>            <span class="na" style="color:rgb(154,195,159)">android:text=</span><span class="s" style="color:rgb(204,147,147)">&quot;New Text&quot;</span> <span class="nt" style="color:rgb(154,195,159)">/&gt;</span><br><br><span class="nt" style="color:rgb(154,195,159)">&lt;/LinearLayout&gt;</span><br></pre><br></div>

<p>下面就是代码了：</p>
<div class="codehilite" style="color:rgb(102,102,102); font-family:Helvetica,arial,'Hiragino Sans GB','Microsoft Yahei',Verdana,Arial,sans-serif; font-size:15px; line-height:30px; background-color:rgb(253,253,253)"><br><pre style="margin-top:1.6em; margin-bottom:1.6em; border:1px solid rgb(227,237,243); width:910px; padding:10px; font-family:Inconsolata,monospace,sans-serif; font-size:0.9em; overflow:auto; word-break:break-word; color:rgb(253,206,147); background:rgb(63,63,63)"><span class="nd" style="color:rgb(204,204,204)">@Override</span><br>    <span class="kd" style="color:rgb(255,255,134)">protected</span> <span class="kt" style="color:rgb(0,205,0)">void</span> <span class="nf" style="color:rgb(239,239,143)">onCreate</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">Bundle</span> <span class="n" style="color:rgb(220,220,204)">savedInstanceState</span><span class="o" style="color:rgb(240,239,208)">)</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>        <span class="kd" style="color:rgb(255,255,134)">super</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">onCreate</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">savedInstanceState</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="n" style="color:rgb(220,220,204)">setContentView</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">R</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">layout</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">activity_main</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="n" style="color:rgb(220,220,204)">recyclerView</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">RecyclerView</span><span class="o" style="color:rgb(240,239,208)">)</span> <span class="n" style="color:rgb(220,220,204)">findViewById</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">R</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">id</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">recyclerView</span><span class="o" style="color:rgb(240,239,208)">);</span><br><br>        <span class="c1" style="color:rgb(127,159,127)">//LinearLayoutManager可以自定义实现不同的动画效果和布局效果</span><br>        <span class="c1" style="color:rgb(127,159,127)">//这里设置为LinearLayoutManager.HORIZONTAL变成为了一个可以横向滑动的ListView，赞不赞？</span><br>        <span class="n" style="color:rgb(220,220,204)">LinearLayoutManager</span> <span class="n" style="color:rgb(220,220,204)">layoutManager</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="k" style="color:rgb(240,223,175)">new</span> <span class="nf" style="color:rgb(239,239,143)">LinearLayoutManager</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="k" style="color:rgb(240,223,175)">this</span><span class="o" style="color:rgb(240,239,208)">,</span><span class="n" style="color:rgb(220,220,204)">LinearLayoutManager</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">VERTICAL</span><span class="o" style="color:rgb(240,239,208)">,</span><span class="kc" style="color:rgb(220,163,163)">false</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="n" style="color:rgb(220,220,204)">recyclerView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">setLayoutManager</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">layoutManager</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="n" style="color:rgb(220,220,204)">recyclerView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">setHasFixedSize</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="kc" style="color:rgb(220,163,163)">false</span><span class="o" style="color:rgb(240,239,208)">);</span><span class="c1" style="color:rgb(127,159,127)">//adapter的改变不会改变RecyclerView的大小</span><br><br>        <span class="n" style="color:rgb(220,220,204)">String</span><span class="o" style="color:rgb(240,239,208)">[]</span> <span class="n" style="color:rgb(220,220,204)">strings</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="k" style="color:rgb(240,223,175)">new</span> <span class="n" style="color:rgb(220,220,204)">String</span><span class="o" style="color:rgb(240,239,208)">[</span><span class="mi" style="color:rgb(140,208,211)">50</span><span class="o" style="color:rgb(240,239,208)">];</span><br>        <span class="k" style="color:rgb(240,223,175)">for</span> <span class="o" style="color:rgb(240,239,208)">(</span><span class="kt" style="color:rgb(0,205,0)">int</span> <span class="n" style="color:rgb(220,220,204)">i</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="mi" style="color:rgb(140,208,211)">0</span><span class="o" style="color:rgb(240,239,208)">;</span><span class="n" style="color:rgb(220,220,204)">i</span><span class="o" style="color:rgb(240,239,208)">&lt;</span><span class="mi" style="color:rgb(140,208,211)">50</span><span class="o" style="color:rgb(240,239,208)">;</span><span class="n" style="color:rgb(220,220,204)">i</span><span class="o" style="color:rgb(240,239,208)">&#43;&#43;){</span><br>            <span class="n" style="color:rgb(220,220,204)">strings</span><span class="o" style="color:rgb(240,239,208)">[</span><span class="n" style="color:rgb(220,220,204)">i</span><span class="o" style="color:rgb(240,239,208)">]</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="n" style="color:rgb(220,220,204)">String</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">valueOf</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">i</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="o" style="color:rgb(240,239,208)">}</span><br><br>        <span class="n" style="color:rgb(220,220,204)">StringRecyclerAdapter</span> <span class="n" style="color:rgb(220,220,204)">adapter</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="k" style="color:rgb(240,223,175)">new</span> <span class="nf" style="color:rgb(239,239,143)">StringRecyclerAdapter</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">strings</span><span class="o" style="color:rgb(240,239,208)">);</span><br><br>        <span class="n" style="color:rgb(220,220,204)">recyclerView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">setAdapter</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">adapter</span><span class="o" style="color:rgb(240,239,208)">);</span><br><br>    <span class="o" style="color:rgb(240,239,208)">}</span><br></pre><br></div>

<p>可以明确看到的是，<code>RecyclerView</code>通过<code>(RecyclerView)
 findViewById(R.id.recyclerView)</code>初始化之后，不仅要像<code>ListView</code>一样要放入<code>Adapter</code>进行数据和布局的适配，而且还要额外添加一个<code>LinearLayoutManager</code>。</p>
<p>这个Manager就是我们的布局管理工具类，这里不仅可以用常规的竖直方向布局，还有横向的滑动的布局，以后再也不会因为没有横向滑动的<code>ListView</code>去头疼自定义了。</p>
<p>通过自定义<code>LinearLayoutManager</code>也可以实现不同的动画效果，和移动效果。</p>
<p><code>RecyclerView</code>的Adapter和<code>ListView</code>的Adapter也是不同的，<code>RecyclerView</code>的Adapter要继承<code>RecyclerView.Adapter&amp;lt;VH
 extends ViewHolder&amp;gt;</code>,并且<code>ViewHolder</code>要继承与<code>ViewHolder.RecyclerView</code>，具体代码如下：</p>
<div class="codehilite" style="color:rgb(102,102,102); font-family:Helvetica,arial,'Hiragino Sans GB','Microsoft Yahei',Verdana,Arial,sans-serif; font-size:15px; line-height:30px; background-color:rgb(253,253,253)"><br><pre style="margin-top:1.6em; margin-bottom:1.6em; border:1px solid rgb(227,237,243); width:910px; padding:10px; font-family:Inconsolata,monospace,sans-serif; font-size:0.9em; overflow:auto; word-break:break-word; color:rgb(253,206,147); background:rgb(63,63,63)"><span class="kd" style="color:rgb(255,255,134)">public</span> <span class="kd" style="color:rgb(255,255,134)">class</span> <span class="nc" style="color:rgb(239,239,143)">StringRecyclerAdapter</span> <span class="kd" style="color:rgb(255,255,134)">extends</span> <span class="n" style="color:rgb(220,220,204)">RecyclerView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">Adapter</span><span class="o" style="color:rgb(240,239,208)">&lt;</span><span class="n" style="color:rgb(220,220,204)">StringRecyclerAdapter</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">ViewHolder</span><span class="o" style="color:rgb(240,239,208)">&gt;</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>    <span class="kd" style="color:rgb(255,255,134)">private</span> <span class="n" style="color:rgb(220,220,204)">String</span><span class="o" style="color:rgb(240,239,208)">[]</span> <span class="n" style="color:rgb(220,220,204)">strings</span><span class="o" style="color:rgb(240,239,208)">;</span><br><br>    <span class="kd" style="color:rgb(255,255,134)">public</span> <span class="nf" style="color:rgb(239,239,143)">StringRecyclerAdapter</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">String</span><span class="o" style="color:rgb(240,239,208)">[]</span> <span class="n" style="color:rgb(220,220,204)">strings</span><span class="o" style="color:rgb(240,239,208)">)</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>        <span class="k" style="color:rgb(240,223,175)">this</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">strings</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="n" style="color:rgb(220,220,204)">strings</span><span class="o" style="color:rgb(240,239,208)">;</span><br>    <span class="o" style="color:rgb(240,239,208)">}</span><br><br>    <span class="nd" style="color:rgb(204,204,204)">@Override</span><br>    <span class="kd" style="color:rgb(255,255,134)">public</span> <span class="n" style="color:rgb(220,220,204)">ViewHolder</span> <span class="nf" style="color:rgb(239,239,143)">onCreateViewHolder</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">ViewGroup</span> <span class="n" style="color:rgb(220,220,204)">viewGroup</span><span class="o" style="color:rgb(240,239,208)">,</span> <span class="kt" style="color:rgb(0,205,0)">int</span> <span class="n" style="color:rgb(220,220,204)">i</span><span class="o" style="color:rgb(240,239,208)">)</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>        <span class="n" style="color:rgb(220,220,204)">View</span> <span class="n" style="color:rgb(220,220,204)">view</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="n" style="color:rgb(220,220,204)">View</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">inflate</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">viewGroup</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">getContext</span><span class="o" style="color:rgb(240,239,208)">(),</span> <span class="n" style="color:rgb(220,220,204)">R</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">layout</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">adapter_string_recylcer</span><span class="o" style="color:rgb(240,239,208)">,</span> <span class="kc" style="color:rgb(220,163,163)">null</span><span class="o" style="color:rgb(240,239,208)">);</span><br><br>       <span class="c1" style="color:rgb(127,159,127)">//这里发现不给item布局添加LayoutParams，会直接默认为WRAP_CONTENT，WRAP_CONTENT布局。</span><br>        <span class="n" style="color:rgb(220,220,204)">view</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">setPadding</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="mi" style="color:rgb(140,208,211)">20</span><span class="o" style="color:rgb(240,239,208)">,</span> <span class="mi" style="color:rgb(140,208,211)">0</span><span class="o" style="color:rgb(240,239,208)">,</span><span class="mi" style="color:rgb(140,208,211)">0</span><span class="o" style="color:rgb(240,239,208)">,</span> <span class="mi" style="color:rgb(140,208,211)">0</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="n" style="color:rgb(220,220,204)">view</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">setFocusable</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="kc" style="color:rgb(220,163,163)">true</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="n" style="color:rgb(220,220,204)">RecyclerView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">LayoutParams</span> <span class="n" style="color:rgb(220,220,204)">lp</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="k" style="color:rgb(240,223,175)">new</span> <span class="n" style="color:rgb(220,220,204)">RecyclerView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">LayoutParams</span><span class="o" style="color:rgb(240,239,208)">(</span><br>                <span class="n" style="color:rgb(220,220,204)">ViewGroup</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">LayoutParams</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">MATCH_PARENT</span><span class="o" style="color:rgb(240,239,208)">,</span><br>                <span class="n" style="color:rgb(220,220,204)">ViewGroup</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">LayoutParams</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">WRAP_CONTENT</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="n" style="color:rgb(220,220,204)">lp</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">leftMargin</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="mi" style="color:rgb(140,208,211)">10</span><span class="o" style="color:rgb(240,239,208)">;</span><br>        <span class="n" style="color:rgb(220,220,204)">lp</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">rightMargin</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="mi" style="color:rgb(140,208,211)">5</span><span class="o" style="color:rgb(240,239,208)">;</span><br>        <span class="n" style="color:rgb(220,220,204)">lp</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">topMargin</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="mi" style="color:rgb(140,208,211)">20</span><span class="o" style="color:rgb(240,239,208)">;</span><br>        <span class="n" style="color:rgb(220,220,204)">lp</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">bottomMargin</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="mi" style="color:rgb(140,208,211)">15</span><span class="o" style="color:rgb(240,239,208)">;</span><br>        <span class="n" style="color:rgb(220,220,204)">view</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">setLayoutParams</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">lp</span><span class="o" style="color:rgb(240,239,208)">);</span><br><br>        <span class="n" style="color:rgb(220,220,204)">ViewHolder</span> <span class="n" style="color:rgb(220,220,204)">viewHolder</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="k" style="color:rgb(240,223,175)">new</span> <span class="nf" style="color:rgb(239,239,143)">ViewHolder</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">view</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="k" style="color:rgb(240,223,175)">return</span> <span class="n" style="color:rgb(220,220,204)">viewHolder</span><span class="o" style="color:rgb(240,239,208)">;</span><br>    <span class="o" style="color:rgb(240,239,208)">}</span><br><br>    <span class="nd" style="color:rgb(204,204,204)">@Override</span><br>    <span class="kd" style="color:rgb(255,255,134)">public</span> <span class="kt" style="color:rgb(0,205,0)">void</span> <span class="nf" style="color:rgb(239,239,143)">onBindViewHolder</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">ViewHolder</span> <span class="n" style="color:rgb(220,220,204)">viewHolder</span><span class="o" style="color:rgb(240,239,208)">,</span> <span class="kt" style="color:rgb(0,205,0)">int</span> <span class="n" style="color:rgb(220,220,204)">i</span><span class="o" style="color:rgb(240,239,208)">)</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>        <span class="n" style="color:rgb(220,220,204)">viewHolder</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">textView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">setText</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">StringRecyclerAdapter</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">class</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">getSimpleName</span><span class="o" style="color:rgb(240,239,208)">()</span> <span class="o" style="color:rgb(240,239,208)">&#43;</span> <span class="n" style="color:rgb(220,220,204)">getValueAt</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">i</span><span class="o" style="color:rgb(240,239,208)">));</span><br>    <span class="o" style="color:rgb(240,239,208)">}</span><br><br>    <span class="kd" style="color:rgb(255,255,134)">public</span> <span class="n" style="color:rgb(220,220,204)">String</span> <span class="nf" style="color:rgb(239,239,143)">getValueAt</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="kt" style="color:rgb(0,205,0)">int</span> <span class="n" style="color:rgb(220,220,204)">i</span><span class="o" style="color:rgb(240,239,208)">)</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>        <span class="k" style="color:rgb(240,223,175)">return</span> <span class="n" style="color:rgb(220,220,204)">strings</span><span class="o" style="color:rgb(240,239,208)">[</span><span class="n" style="color:rgb(220,220,204)">i</span><span class="o" style="color:rgb(240,239,208)">];</span><br>    <span class="o" style="color:rgb(240,239,208)">}</span><br><br>    <span class="nd" style="color:rgb(204,204,204)">@Override</span><br>    <span class="kd" style="color:rgb(255,255,134)">public</span> <span class="kt" style="color:rgb(0,205,0)">int</span> <span class="nf" style="color:rgb(239,239,143)">getItemCount</span><span class="o" style="color:rgb(240,239,208)">()</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>        <span class="k" style="color:rgb(240,223,175)">return</span> <span class="k" style="color:rgb(240,223,175)">this</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">strings</span> <span class="o" style="color:rgb(240,239,208)">==</span> <span class="kc" style="color:rgb(220,163,163)">null</span> <span class="o" style="color:rgb(240,239,208)">?</span> <span class="mi" style="color:rgb(140,208,211)">0</span> <span class="o" style="color:rgb(240,239,208)">:</span> <span class="n" style="color:rgb(220,220,204)">strings</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">length</span><span class="o" style="color:rgb(240,239,208)">;</span><br>    <span class="o" style="color:rgb(240,239,208)">}</span><br><br>    <span class="kd" style="color:rgb(255,255,134)">public</span> <span class="kd" style="color:rgb(255,255,134)">static</span> <span class="kd" style="color:rgb(255,255,134)">class</span> <span class="nc" style="color:rgb(239,239,143)">ViewHolder</span> <span class="kd" style="color:rgb(255,255,134)">extends</span> <span class="n" style="color:rgb(220,220,204)">RecyclerView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">ViewHolder</span> <span class="kd" style="color:rgb(255,255,134)">implements</span> <span class="n" style="color:rgb(220,220,204)">View</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">OnClickListener</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>        <span class="kd" style="color:rgb(255,255,134)">public</span> <span class="n" style="color:rgb(220,220,204)">TextView</span> <span class="n" style="color:rgb(220,220,204)">textView</span><span class="o" style="color:rgb(240,239,208)">;</span><br><br>        <span class="kd" style="color:rgb(255,255,134)">public</span> <span class="nf" style="color:rgb(239,239,143)">ViewHolder</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">View</span> <span class="n" style="color:rgb(220,220,204)">itemView</span><span class="o" style="color:rgb(240,239,208)">)</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>            <span class="kd" style="color:rgb(255,255,134)">super</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">itemView</span><span class="o" style="color:rgb(240,239,208)">);</span><br>            <span class="n" style="color:rgb(220,220,204)">textView</span> <span class="o" style="color:rgb(240,239,208)">=</span> <span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">TextView</span><span class="o" style="color:rgb(240,239,208)">)</span> <span class="n" style="color:rgb(220,220,204)">itemView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">findViewById</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">R</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">id</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">textView</span><span class="o" style="color:rgb(240,239,208)">);</span><br>            <span class="c1" style="color:rgb(127,159,127)">//因为RecyclerView没用setOnItemClickListener，所以在这里实现了点击事件</span><br>            <span class="c1" style="color:rgb(127,159,127)">//况且，现在有越来越多的设计，会在每个item点击不同位置，有不同的响应</span><br>            <span class="n" style="color:rgb(220,220,204)">textView</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">setOnClickListener</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="k" style="color:rgb(240,223,175)">this</span><span class="o" style="color:rgb(240,239,208)">);</span><br>        <span class="o" style="color:rgb(240,239,208)">}</span><br><br>        <span class="nd" style="color:rgb(204,204,204)">@Override</span><br>        <span class="kd" style="color:rgb(255,255,134)">public</span> <span class="kt" style="color:rgb(0,205,0)">void</span> <span class="nf" style="color:rgb(239,239,143)">onClick</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">View</span> <span class="n" style="color:rgb(220,220,204)">v</span><span class="o" style="color:rgb(240,239,208)">)</span> <span class="o" style="color:rgb(240,239,208)">{</span><br>            <span class="n" style="color:rgb(220,220,204)">Toast</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">makeText</span><span class="o" style="color:rgb(240,239,208)">(</span><span class="n" style="color:rgb(220,220,204)">v</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">getContext</span><span class="o" style="color:rgb(240,239,208)">(),((</span><span class="n" style="color:rgb(220,220,204)">TextView</span><span class="o" style="color:rgb(240,239,208)">)</span><span class="n" style="color:rgb(220,220,204)">v</span><span class="o" style="color:rgb(240,239,208)">).</span><span class="na" style="color:rgb(154,195,159)">getText</span><span class="o" style="color:rgb(240,239,208)">(),</span><span class="n" style="color:rgb(220,220,204)">Toast</span><span class="o" style="color:rgb(240,239,208)">.</span><span class="na" style="color:rgb(154,195,159)">LENGTH_SHORT</span><span class="o" style="color:rgb(240,239,208)">).</span><span class="na" style="color:rgb(154,195,159)">show</span><span class="o" style="color:rgb(240,239,208)">();</span><br>        <span class="o" style="color:rgb(240,239,208)">}</span><br>    <span class="o" style="color:rgb(240,239,208)">}</span><br><span class="o" style="color:rgb(240,239,208)">}</span><br></pre><br></div>

<p>在<code>onCreateViewHolder</code>方法中，我们需要把加载布局和<code>ViewHolder</code>绑定起来，这里有个问题，不知道是Android的bug，还是故意这么设计的，需要我们主动写代码给item设置<code>LayoutParams</code>。</p>
<p>在<code>onBindViewHolder</code>中负责数据绑定。</p>
<p>这里有一个问题，<code>RecyclerView</code>没有<code>setOnItemClickListener</code>方法，所以我在里面对<code>TextView</code>添加了点击事件，现在有越来越多的设计，会在每个item点击不同位置，有不同的响应。</p>
<p><img src="http://img.blog.csdn.net/20141110152225296?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VubmV0aHlv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p><a href="https://github.com/KennethYo/RecyclerViewDemo" target="_blank" rel="external">Demo链接</a></p>
<pre><code>&lt;div&gt;
    作者：zh08070005 发表于2014/11/10 15:18:15 [原文链接](http://blog.csdn.net/kennethyo/article/details/40981263)
&lt;/div&gt;
&lt;div&gt;
阅读：1221 评论：0 [查看评论](http://blog.csdn.net/kennethyo/article/details/40981263#comments)
&lt;/div&gt;
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;span style=&quot;font-family:Inconsolata,monospace,sans-serif; font-size:12px; color:#dd1144&quot;&gt;&lt;span style=&quot;white-space:pre-wrap; background-c
    
    </summary>
    
      <category term="Android" scheme="http://www.kennethyo.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://www.kennethyo.me/tags/Android/"/>
    
  </entry>
  
</feed>
